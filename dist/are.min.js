/* Alloy Game Engine
 * By AlloyTeam http://www.alloyteam.com/
 * Github: https://github.com/AlloyTeam/AlloyGameEngine
 * MIT Licensed.
 */
(function(n){var i=!1,r=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,t=function(){};t.extend=function(n){function u(){!i&&this.ctor&&this.ctor.apply(this,arguments)}var o=this.prototype,e,f,t;i=!0;e=new this;i=!1;for(t in n)t!="statics"&&(e[t]=typeof n[t]=="function"&&typeof o[t]=="function"&&r.test(n[t])?function(n,t){return function(){var r=this._super,i;return this._super=o[n],i=t.apply(this,arguments),this._super=r,i}}(t,n[t]):n[t]);for(f in this)this.hasOwnProperty(f)&&f!="extend"&&(u[f]=this[f]);if(u.prototype=e,n.statics)for(t in n.statics)n.statics.hasOwnProperty(t)&&(u[t]=n.statics[t],t=="ctor"&&u[t]());return u.prototype.constructor=u,u.extend=arguments.callee,u.implement=function(n){for(var t in n)e[t]=n[t]},u},function(){var i={};i.CanvasRenderer=t.extend({ctor:function(n){n&&(this.stage=n,this.ctx=n.ctx,this.height=n.width,this.width=n.height)},update:function(){this.ctx.clearRect(0,0,this.height,this.width);this.render(this.ctx,this.stage)},render:function(n,t,r){var s,h,e,o,f,c,u;if(t.isVisible()){if(t instanceof i.DomElement){t.element.style.display="block";return}if(r?t._matrix.reinitialize(r.a,r.b,r.c,r.d,r.tx,r.ty,r.alpha,r.shadow,r.compositeOperation):t._matrix.reinitialize(1,0,0,1,0,0),r=t._matrix,t instanceof i.Sprite&&(t.regX=t.rect[2]*t.originX,t.regY=t.rect[3]*t.originY),r.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY,t.filpX,t.flipY),s=n.globalAlpha,h=n.globalCompositeOperation,n.globalAlpha*=t.alpha,n.globalCompositeOperation=t.compositeOperation,e=t.cacheCanvas||t.txtCanvas,e)n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),n.drawImage(e,0,0);else if(t instanceof i.Container||t instanceof i.Stage)for(o=t.children.slice(0),f=0,c=o.length;f<c;f++)n.save(),this.render(n,o[f],r),n.restore();else(t instanceof i.Bitmap||t instanceof i.Sprite)&&(u=t.rect,n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),n.drawImage(t.img,u[0],u[1],u[2],u[3],0,0,u[2],u[3]));n.globalAlpha=s;n.globalCompositeOperation=h}},hitRender:function(n,t,i,r,u,f){var o,h,e,s;for(n.clearRect(0,0,2,2),i?t._matrix.reinitialize(i.a,i.b,i.c,i.d,i.tx,i.ty,i.alpha,i.shadow,i.compositeOperation):t._matrix.reinitialize(1,0,0,1,0,0),i=t._matrix,i.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY,t.filpX,t.flipY),o=t.children.slice(0),h=o.length,e=h-1;e>=0;e--)if(s=o[e],i.reinitialize(1,0,0,1,0,0),i.appendTransform(t.x-r,t.y-u,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY,t.filpX,t.flipY),n.save(),s=o[e],this._hitRender(n,o[e],i,f),n.restore(),n.getImageData(0,0,1,1).data[3]>1)return s.execEvent(f),s},_hitRender:function(n,t,r,u){var h,o,c,e,s,f;if(t.isVisible()){if(r?t._matrix.reinitialize(r.a,r.b,r.c,r.d,r.tx,r.ty,r.alpha,r.shadow,r.compositeOperation):t._matrix.reinitialize(1,0,0,1,0,0),r=t._matrix,r.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY,t.filpX,t.flipY),h=n.globalAlpha,n.globalAlpha*=t.alpha,t.cacheCanvas)n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),n.drawImage(t.cacheCanvas||t.img,0,0);else if(t instanceof i.Container)for(o=t.children.slice(0),c=o.length,e=c-1;e>=0;e--)(s=o[e],this.isbindingEvent(s))&&(n.save(),this._hitRender(n,o[e],r),n.restore(),n.getImageData(0,0,1,1).data[3]>1&&s.execEvent(u));else(t instanceof i.Bitmap||t instanceof i.Sprite)&&(f=t.rect,n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),n.drawImage(t.img,f[0],f[1],f[2],f[3],0,0,f[2],f[3]));n.globalAlpha=h}},isbindingEvent:function(n){var t,u,r;if(Object.keys(n.events).length!==0)return!0;if(n instanceof i.Container)for(t=0,u=n.children.length;t<u;t++){if(r=n.children[t],r instanceof i.Container)return this.isbindingEvent(r);if(Object.keys(r.events).length!==0)return!0}return!1},updateCache:function(n,t,i,r){n.clearRect(0,0,i+1,r+1);this.renderCache(n,t)},renderCache:function(n,t){var f,u,e,r;if(t.isVisible())if(t instanceof i.Container||t instanceof i.Stage)for(f=t.children.slice(0),u=0,e=f.length;u<e;u++)n.save(),this.render(n,f[u]),n.restore();else(t instanceof i.Bitmap||t instanceof i.Sprite)&&(r=t.rect,n.drawImage(t.img,r[0],r[1],r[2],r[3],0,0,r[2],r[3]))}});i.DisplayObject=t.extend({ctor:function(){this.alpha=this.scaleX=this.scaleY=1;this.x=this.y=this.rotation=this.originX=this.originY=this.skewX=this.skewY=this.width=this.height=0;this.flipX=this.flipY=!1;this.visible=!0;this._matrix=new i.Matrix2D;this.events={};this.id=i.UID.get();this.cacheID=0;this.baseInstanceof="DisplayObject";var n=this;this._watch(this,"originX",function(t,i){n.regX=typeof i=="string"?parseInt(i):n.width*i});this._watch(this,"originY",function(t,i){n.regY=typeof i=="string"?parseInt(i):n.height*i})},_watch:function(n,t,i){var r=this,u=n["__"+t]=this[t];Object.defineProperty(n,t,{get:function(){return this["__"+t]},set:function(n){this["__"+t]=n;i(t,n)}})},isVisible:function(){return!!(this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0)},on:function(n,t){"mouseover_mousemove_mouseout_touchstart_touchmove_touchend".match(n)&&(i.Stage.checkMove=!0);this.events[n]||(this.events[n]=[]);this.events[n].push(t)},execEvent:function(n){var t=this.events[n];this._fireFns(t)},hover:function(n,t){this.on("mouseover",n);this.on("mouseout",t)},_fireFns:function(n){if(n)for(var t=0,i=n.length;t<i;t++)n[t].call(this)},clone:function(){var n=new i.DisplayObject;return this.cloneProps(n),n},cloneProps:function(n){n.visible=this.visible;n.alpha=this.alpha;n.originX=this.originX;n.originY=this.originY;n.rotation=this.rotation;n.scaleX=this.scaleX;n.scaleY=this.scaleY;n.skewX=this.skewX;n.skewY=this.skewY;n.x=this.x;n.y=this.y;n.regX=this.regX;n.regY=this.regY},cache:function(){if(!this.cacheCanvas){this.cacheCanvas=document.createElement("canvas");var n=this.getBound();this.cacheCanvas.width=n.width;this.cacheCanvas.height=n.height;this.cacheCtx=this.cacheCanvas.getContext("2d")}this.cacheID=i.UID.getCacheID();i.Stage.renderer.updateCache(this.cacheCtx,this,n.width,n.height)},uncache:function(){this.cacheCanvas=null;this.cacheCtx=null;this.cacheID=null},getBound:function(){return{width:this.width,height:this.height}},toCenter:function(){this.originX=.5;this.originY=.5;this.x=this.parent.width/2;this.y=this.parent.height/2},onClick:function(n){this.on("click",n)},onMouseMove:function(n){this.on("mousemove",n)}});i.CircleShape=i.DisplayObject.extend({ctor:function(n,t,i){this._super();this.r=n||1;this.color=t||"black";this.isHollow=i;this.width=this.height=2*n;this.draw()},draw:function(n){this.cache();var n=this.cacheCtx;n.beginPath();n.arc(this.r,this.r,this.r,0,Math.PI*2);this.originX=this.originY=.5;this.isHollow?(n.strokeStyle=this.color,n.stroke()):(n.fillStyle=this.color,n.fill())}});i.Container=i.DisplayObject.extend({ctor:function(){this._super();this.children=[];this.baseInstanceof="Container"},add:function(n){var r=arguments.length,t,i;if(r>1)for(t=0;t<r;t++)i=arguments[t],i&&(this.children.push(i),i.parent=this);else n&&(this.children.push(n),n.parent=this)},remove:function(n){var f=arguments.length,e=this.children.length,t,u,i,r;if(f>1){for(t=0;t<f;t++)for(u=arguments[t],i=e;--i>=0;)if(this.children[i].id==u.id){u.parent=null;this.children.splice(i,1);break}}else for(r=e;--r>=0;)if(this.children[r].id==n.id){n.parent=null;this.children.splice(r,1);break}},clone:function(){var t=new i.Container,r,n,u;for(this.cloneProps(t),r=t.children=[],n=this.children.length-1;n>-1;n--)u=this.children[n].clone(),r.unshift(u);return t},removeAll:function(){for(var n=this.children;n.length;)n.pop().parent=null}});i.Bitmap=i.DisplayObject.extend({ctor:function(n){(this._super(),arguments.length!==0)&&(typeof n=="string"?this._initWithSrc(n):this._init(n))},_initWithSrc:function(n){var r=i.Bitmap[n],t;r?this._init(r):(t=this,this.visible=!1,this.img=document.createElement("img"),this.img.onload=function(){t.rect||(t.rect=[0,0,t.img.width,t.img.height]);t.width=t.rect[2];t.height=t.rect[3];t.regX=t.width*t.originX;t.regY=t.height*t.originY;t.imgLoaded=!0;i.Bitmap[n]=t.img;t.visible=!0;t.imageLoadHandle&&t.imageLoadHandle();t._watch(t,"filter",function(n,i){t.setFilter.apply(t,i)})},this.img.src=n)},_init:function(n){this.img=n;this.width=n.width;this.height=n.height;this.imgLoaded=!0;var t=this;this._watch(this,"filter",function(n,i){t.setFilter.apply(t,i)});Object.defineProperty(this,"rect",{get:function(){return this.__rect},set:function(n){this.__rect=n;this.width=n[2];this.height=n[3];this.regX=n[2]*this.originX;this.regY=n[3]*this.originY}});this.rect=[0,0,n.width,n.height]},setFilter:function(n,t,i,r){var e,f,u,o;for(this.uncache(),this.cache(),e=this.cacheCtx.getImageData(0,0,this.cacheCanvas.width,this.cacheCanvas.height),f=e.data,u=0,o=f.length;u<o;u+=4)f[u+3]>0&&(f[u]*=n,f[u+1]*=t,f[u+2]*=i,f[u+3]*=r);this.cacheCtx.putImageData(e,0,0)},useImage:function(n){typeof n=="string"?this._initWithSrc(n):(this._init(n),this.imageLoadHandle&&this.imageLoadHandle())},onImageLoad:function(n){this.imageLoadHandle=n},clone:function(){var n=new i.Bitmap(this.img);return n.rect=this.rect.slice(0),this.cloneProps(n),n}});i.Particle=i.Bitmap.extend({ctor:function(n){this._super(n.texture);this.position=n.position;this.x=this.position.x;this.y=this.position.y;this.rotation=n.rotation||0;this.velocity=n.velocity;this.acceleration=n.acceleration||new i.Vector2(0,0);this.rotatingSpeed=n.rotatingSpeed||0;this.rotatingAcceleration=n.rotatingAcceleration||0;this.hideSpeed=n.hideSpeed||.01;this.zoomSpeed=n.hideSpeed||.01;this.isAlive=!0;this.setFilter.apply(this,n.filter)},tick:function(){this.velocity.add(this.acceleration);this.position.add(this.velocity.multiply(.1));this.rotatingSpeed+=this.rotatingAcceleration;this.rotation+=this.rotatingSpeed;this.alpha-=this.hideSpeed;this.x=this.position.x;this.y=this.position.y;this.alpha=this.alpha}});i.DomElement=i.DisplayObject.extend({ctor:function(n){this._super();this.element=typeof n=="string"?document.querySelector(n):n;var u=this.element,r=i.Observable.watch(this,["x","y","scaleX","scaleY","perspective","rotation","skewX","skewY","regX","regY"]),t=this;r.propertyChangedHandler=function(){var n=t._matrix.identity().appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY);t.element.style.transform=t.element.style.msTransform=t.element.style.OTransform=t.element.style.MozTransform=t.element.style.webkitTransform="matrix("+n.a+","+n.b+","+n.c+","+n.d+","+n.tx+","+n.ty+")"};delete this.visible;Object.defineProperty(this,"visible",{set:function(n){this._visible=n;this.element.style.display=this._visible?"block":"none"},get:function(){return this._visible}});delete this.alpha;Object.defineProperty(this,"alpha",{set:function(n){this._opacity=n;this.element.style.opacity=n},get:function(){return this._opacity}});this.visible=!0;this.alpha=1;this.element.style.display="none"},isVisible:function(){return!!(this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0)}});i.ParticleSystem=i.Container.extend({ctor:function(n){if(this._super(),this.speed=n.speed,this.angle=n.angle,this.angleRange=n.angleRange,this.emitArea=n.emitArea,this.gravity=n.gravity,this.filter=n.filter,this.compositeOperation="lighter",this.emitCount=n.emitCount,this.maxCount=n.maxCount||100,this.emitX=n.emitX,this.emitY=n.emitY,this.textureReady=!1,self=this,typeof n.texture=="string"){var t=new Image;t.onload=function(){self.texture=t;self.textureReady=!0};t.src=n.texture}else this.textureReady=!0,this.texture=n.texture;this.tickFPS=60},emit:function(){var n=(this.angle+i.Util.random(-this.angleRange/2,this.angleRange/2))*Math.PI/180,t=new i.Particle({position:new i.Vector2(this.emitX+i.Util.random(0,this.emitArea[0]),this.emitY+i.Util.random(0,this.emitArea[1])),velocity:new i.Vector2(this.speed*Math.cos(n),this.speed*Math.sin(n)),texture:this.texture,acceleration:this.gravity,filter:this.filter});this.add(t)},tick:function(){var t,r,n,i;if(this.textureReady){if(t=this.children.length,t<this.maxCount)for(r=0;r<this.emitCount;r++)this.emit();for(n=0;n<t;n++)i=this.children[n],i.isVisible()?i.tick():(this.remove(i),n--,t--)}}});i.RectAdjust=t.extend({ctor:function(n){this.min=n.min;this.max=n.max;this.value=n.value;this.change=n.change;this.renderTo=n.renderTo;this.fillStyle=n.fillStyle;this.canvas=document.createElement("canvas");this.canvas.width=140;this.canvas.height=16;this.canvas.style.cssText="border:1px solid black;";this.ctx=this.canvas.getContext("2d");this.renderTo.appendChild(this.canvas);this.render(160*(this.value-this.min)/(this.max-this.min));this.offset=this.canvas.getBoundingClientRect();var t=this,i=!1;this.canvas.addEventListener("mousedown",function(n){i=!0;var r=n.pageX-t.offset.left,u=n.pageY-t.offset.top;t.value=t.min+(t.max-t.min)*r/140;t.value>t.max&&(t.value=t.max);t.value<t.min&&(t.value=t.min);t.change(t.value);t.render(r);n.preventDefault();n.stopPropagation()},!1);this.canvas.addEventListener("mousemove",function(n){if(i){var r=n.pageX-t.offset.left,u=n.pageY-t.offset.top;t.value=t.min+(t.max-t.min)*r/140;t.value>t.max&&(t.value=t.max);t.value<t.min&&(t.value=t.min);t.change(t.value);t.render(r);n.preventDefault();n.stopPropagation()}},!1);document.addEventListener("mouseup",function(){i=!1},!1)},render:function(n){this.ctx.fillStyle=this.fillStyle;this.ctx.clearRect(0,0,500,500);this.ctx.beginPath();this.ctx.fillRect(0,0,n,60)}});i.RectShape=i.DisplayObject.extend({ctor:function(n,t,i,r){this._super();this.color=i||"black";this.isHollow=r;this.width=n;this.height=t;this.originX=this.originY=.5;this.draw()},draw:function(n){this.cache();var n=this.cacheCtx;n.beginPath();n.arc(this.r,this.r,this.r,0,Math.PI*2);this.isHollow?(n.strokeStyle=this.color,n.strokeRect(0,0,this.width,this.height)):(n.fillStyle=this.color,n.fillRect(0,0,this.width,this.height))}});i.Shape=i.DisplayObject.extend({ctor:function(n,t,i){this._super();this.cmds=[];this.assMethod=["fillStyle","strokeStyle","lineWidth"];this.width=n;this.height=t;i&&(this.fillStyle("red"),this.fillRect(0,0,n,t));this.cache()},end:function(){for(var n,t=this.cacheCtx,i=0,r=this.cmds.length;i<r;i++)n=this.cmds[i],this.assMethod.join("-").match(new RegExp("\\b"+n[0]+"\\b","g"))?t[n[0]]=n[1][0]:t[n[0]].apply(t,Array.prototype.slice.call(n[1]))},strokeRect:function(){return this.cmds.push(["strokeRect",arguments]),this},fillRect:function(){return this.cmds.push(["fillRect",arguments]),this},beginPath:function(){return this.cmds.push(["beginPath",arguments]),this},arc:function(){return this.cmds.push(["arc",arguments]),this},closePath:function(){return this.cmds.push(["closePath",arguments]),this},fillStyle:function(){return this.cmds.push(["fillStyle",arguments]),this},fill:function(){return this.cmds.push(["fill",arguments]),this},strokeStyle:function(){return this.cmds.push(["strokeStyle",arguments]),this},lineWidth:function(){return this.cmds.push(["lineWidth",arguments]),this},stroke:function(){return this.cmds.push(["stroke",arguments]),this},moveTo:function(){return this.cmds.push(["moveTo",arguments]),this},lineTo:function(){return this.cmds.push(["lineTo",arguments]),this},bezierCurveTo:function(){return this.cmds.push(["bezierCurveTo",arguments]),this},clone:function(){}});i.Sprite=i.DisplayObject.extend({ctor:function(n){var r,u,t;for(this._super(),this.option=n,this.x=n.x||0,this.y=n.y||0,this.currentFrameIndex=0,this.animationFrameIndex=0,this.currentAnimation=n.currentAnimation||null,this.rect=[0,0,10,10],this.visible=!1,this.bitmaps=[],this._loadedCount=0,self=this,r=0,u=this.option.imgs.length;r<u;r++){t=new i.Bitmap;t._sprite=this;t.onImageLoad(function(){t._sprite._loadedCount++;t._sprite._loadedCount===u&&(t._sprite.visible=!0,delete t._sprite)});t.useImage(this.option.imgs[r]);this.bitmaps.push(t)}this.img=this.bitmaps[0].img;this.interval=1e3/n.framerate;this.loop=null;this.paused=!1;this.animationEnd=n.animationEnd||null;this.currentAnimation&&this.gotoAndPlay(this.currentAnimation);this.tickAnimationEnd=n.tickAnimationEnd||null},play:function(){this.paused=!1},stop:function(){this.paused=!0},reset:function(){this.currentFrameIndex=0;this.animationFrameIndex=0},gotoAndPlay:function(n,t){this.paused=!1;this.reset();clearInterval(this.loop);this.currentAnimation=n;var i=this,r=0;this.loop=setInterval(function(){if(!i.paused){var n=i.option,u=n.animations[i.currentAnimation].frames,f=u.length;i.animationFrameIndex++;i.animationFrameIndex>f-1&&(r++,i.animationFrameIndex=0,i.tickAnimationEnd&&i.tickAnimationEnd(),t&&r==t&&(i.animationEnd&&i.animationEnd(),i.paused=!0,clearInterval(i.loop),i.parent.remove(i)));i.rect=n.frames[u[i.animationFrameIndex]];i.rect.length>4&&(i.img=i.bitmaps[i.rect[4]].img)}},this.interval)},gotoAndStop:function(n){var t;this.reset();clearInterval(this.loop);t=this;t.currentAnimation=n;var i=t.option,r=i.animations[t.currentAnimation].frames,u=r.length;t.rect=i.frames[r[t.animationFrameIndex]];t.rect.length>4&&(t.img=t.bitmaps[t.rect[4]].img)}});i.Text=i.DisplayObject.extend({ctor:function(n){this._super();this.txt=n.txt;this.fontSize=n.fontSize;this.fontFamily=n.fontFamily;this.color=n.color;this.textAlign="center";this.textBaseline="top";this.maxWidth=n.maxWidth||2e3;this.square=n.square||!1;var t=this.getDrawOption({txt:this.txt,maxWidth:this.maxWidth,square:this.square,size:this.fontSize,alignment:this.textAlign,color:this.color||"black",fontFamily:this.fontFamily})},getDrawOption:function(n){var t,r,e,h,u=[],c=n.txt,o=n.maxWidth,p=n.square,s=n.size,a=n.alignment,w=n.color,v=n.fontFamily,b=n.backgroundColour,l=document.createElement("canvas"),i=l.getContext("2d"),y,f;i.font=s+"px "+v;o&&this.measureText(i,c)>o?(o=this.createMultilineText(i,c,o,u),t=this.getPowerOfTwo(o)):(u.push(c),t=this.getPowerOfTwo(i.measureText(c).width));r=this.getPowerOfTwo(s*(u.length+1));p&&(t>r?r=t:t=r);n.calculatedWidth=t;n.calculatedHeight=r;l.width=t;l.height=r;switch(a){case"left":e=0;break;case"center":e=t/2;break;case"right":e=t}for(h=r/2,i.fillStyle=w,i.textAlign=a,i.textBaseline="middle",i.font=s+"px "+v,y=(r-s*(u.length+1))*.5,n.cmd=[],f=0;f<u.length;f++)u.length>1&&(h=(f+1)*s+y),n.cmd.push({text:u[f],x:e,y:h}),i.fillText(u[f],e,h);return this.txtCanvas=l,n},getPowerOfTwo:function(n,t){for(var t=t||1;t<n;)t*=2;return t},measureText:function(n,t){return n.measureText(t).width},createMultilineText:function(n,t,i,r){var a,u;t=t.replace("\n"," ");for(var f=t,e,h=0,s=0,c=t.split(" "),l,o=l=c.length;this.measureText(n,f)>i&&o>1;)for(o--,a=!1,f=e="",u=0;u<l;u++)u<o?(f+=c[u],u+1<o&&(f+=" ")):(e+=c[u],u+1<l&&(e+=" "));return r.push(f),s=this.measureText(n,f),e&&(h=this.createMultilineText(n,e,i,r),h>s&&(s=h)),s},draw:function(n){n.fillStyle=this.color;n.font=this.font;n.textAlign=this.textAlign||"left";n.textBaseline=this.textBaseline||"top";n.fillText(this.text,0,0)},clone:function(){var n=new i.Text(this.text,this.font,this.color);return this.cloneProps(n),n}});i.Dom=t.extend({statics:{get:function(n){return this.element=document.querySelector(n),this},on:function(n,t){return this.element.addEventListener(n,t,!1),this}}});i.Stage=i.Container.extend({statics:{checkMove:!1},ctor:function(n){var f,u,t,r;this._super();this.canvas=typeof n=="string"?document.querySelector(n):n;this.width=this.canvas.width;this.height=this.canvas.height;f=!!window.CanvasRenderingContext2D;u=function(){try{var n=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl")))}catch(t){return!1}}();u&&!1||(this.ctx=this.canvas.getContext("2d"),this.renderer=new i.CanvasRenderer(this));i.Stage.renderer=this.renderer;this.hitRenderer=new i.CanvasRenderer(this);this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitCtx=this.hitCanvas.getContext("2d");Function.prototype.bind=function(){var t=this,n=Array.prototype.slice.call(arguments),i=n.shift();return function(){return t.apply(i,n.concat(Array.prototype.slice.call(arguments)))}};this._scaleX=this._scaleY=null;this.offset=this._getXY(this.canvas);this.overObj=null;this.pause=!1;this.fps=60;this.interval=Math.floor(1e3/this.fps);t=this;t.loop=setInterval(function(){t._tick(t)},t.interval);Object.defineProperty(this,"useRequestAnimFrame",{set:function(n){this._useRequestAnimFrame=n;n?(clearInterval(t.loop),t.loop=i.RAF.requestInterval(function(){t._tick(t)},t.interval)):(i.RAF.clearRequestInterval(t.loop),t.loop=setInterval(function(){t._tick(t)},t.interval))},get:function(){return this._useRequestAnimFrame}});this.domSurface=document.createElement("div");r=this.domSurface.style;r.width=this.width+"px";r.height=this.height+"px";r.backgroundColor="rgba(255,255,255,0)";r.zIndex=1003;r.position="absolute";r.border="0px solid red";r.left=this.offset[0]+"px";r.top=this.offset[1]+"px";document.body.appendChild(this.domSurface);this.domSurface.addEventListener("mousemove",this._handleMouseMove.bind(this),!1);this.domSurface.addEventListener("click",this._handleClick.bind(this),!1);this.debugDiv=document.createElement("div");this.debugDiv.style.cssText="display:none;position:absolute;z-index:1000;left:0;top:0;background-color:yellow;font-size:20px;";document.body.appendChild(this.debugDiv);Object.defineProperty(this,"debug",{set:function(n){this._debug=n;this.debugDiv.style.display=this._debug?"block":"none"},get:function(){return this._debug}})},add:function(n){var t,r,n;for(this._super.apply(this,arguments),r=arguments.length,t=0;t<r;t++)n=arguments[t],n instanceof i.DomElement&&this.domSurface.appendChild(n.element)},update:function(){this.pause||this.renderer.update()},_handleClick:function(n){var r,t,i,u,f,e;if(n.stageX=n.pageX-this.offset[0],n.stageY=n.pageY-this.offset[1],this._scaleX&&(r=this.correctingXY(n.stageX,n.stageY),n.stageX=Math.round(r.x),n.stageY=Math.round(r.y)),t=this.events.click,t)for(i=0,u=t.length;i<u;i++)f=t[i],f(n);e=this.hitRenderer.hitRender(this.hitCtx,this,null,n.stageX,n.stageY,"click")},_handleMouseMove:function(n){var r,t,i,u,f;if(n.stageX=n.pageX-this.offset[0],n.stageY=n.pageY-this.offset[1],this._scaleX&&(r=this.correctingXY(n.stageX,n.stageY),n.stageX=Math.round(r.x),n.stageY=Math.round(r.y)),t=this.events.mousemove,t)for(i=0,u=t.length;i<u;i++)f=t[i],f(n)},_getXY:function(n){var t=0,i=0,r;if(document.documentElement.getBoundingClientRect&&n.getBoundingClientRect)r=n.getBoundingClientRect(),i=r.left,t=r.top;else{while(n.offsetParent)t+=n.offsetTop,i+=n.offsetLeft,n=n.offsetParent;return[i,t]}return[i+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),t+Math.max(document.documentElement.scrollTop,document.body.scrollTop)]},destroy:function(){},_tick:function(n){var u,f,r,t,i;for(n.tick&&(this._initInterval(n),n.hasOwnProperty("_tickInterval")?(n._tickIntervalCurrent=new Date,n._tickIntervalLast||(n._tickIntervalLast=new Date),i=n._tickIntervalCurrent-n._tickIntervalLast,i*2>n._tickInterval&&(n.tick(),n._tickIntervalLast=n._tickIntervalCurrent)):n.tick()),u=n.children,f=u.length,r=0;r<f;r++)t=u[r],t.tick&&(this._initInterval(t),t.hasOwnProperty("_tickInterval")?(t._tickIntervalCurrent=new Date,t._tickIntervalLast||(t._tickIntervalLast=new Date),i=t._tickIntervalCurrent-t._tickIntervalLast,i*2>t._tickInterval&&(t.tick(),t._tickIntervalLast=t._tickIntervalCurrent)):t.tick()),t.baseInstanceof=="Container"&&this._tick(t)},_initInterval:function(n){n.hasOwnProperty("tickFPS")&&(n._tickInterval=n.tickFPS==0?1e4:1e3/n.tickFPS)},tick:function(){this.tickFn&&this.tickFn();this.update();this.debug&&(this.debugDiv.innerHTML="fps : "+this.getFPS()+" <br/>object count : "+this.getTotalCount()+" <br/>rendering mode : "+this.getRenderingMode())},onTick:function(n){this.tickFn=n},setFPS:function(n){this.interval=Math.floor(1e3/n)},onKeyboard:function(n,t,r){i.Keyboard.on(n,t,r)},getActiveKeys:function(){return i.Keyboard.getActiveKeys()},scalable:function(n,t){var r,i;n===1&&t===1&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden");document.body.style.margin=0;document.documentElement.style.margin=0;document.body.style.border=0;document.documentElement.style.border=0;document.body.style.padding=0;document.documentElement.style.padding=0;document.body.style.width="100%";document.documentElement.style.width="100%";document.body.style.height="100%";document.documentElement.style.height="100%";this._scaleX=n;this._scaleY=t;r=this.canvas;r.style.position="absolute";r.style.width=n*100+"%";r.style.height=t*100+"%";r.style.left=50*(1-n)+"%";r.style.top=50*(1-t)+"%";r.style.border="0px solid #ccc";i=this.domSurface;i.style.position="absolute";i.style.width=n*100+"%";i.style.height=t*100+"%";i.style.left=50*(1-n)+"%";i.style.top=50*(1-t)+"%";i.style.border="0px solid #ccc";i.style.transform=i.style.msTransform=i.style.OTransform=i.style.MozTransform=i.style.webkitTransform="scale("+window.innerWidth*this._scaleX/this.width+","+window.innerHeight*this._scaleX/this.height+")";this.offset=this._getXY(this.canvas)},correctingXY:function(n,t){return{x:n*this.width/(window.innerWidth*this._scaleX),y:t*this.height/(window.innerHeight*this._scaleY)}},getTotalCount:function(){function t(i){if(i.baseInstanceof=="Container")for(var r=0,u=i.children.length;r<u;r++)i.children[r].baseInstanceof=="Container"?t(i.children[r]):n++;else n++}var n=0;return t(this),n},getRenderingMode:function(){return this.renderer instanceof i.CanvasRenderer?"Canvas":"WebGL"},getFPS:function(){return i.FPS.get()}});i.FPS=t.extend({statics:{get:function(){return this.instance||(this.instance=new this),this.instance._computeFPS(),this.instance.value}},ctor:function(){this.last=new Date;this.current=null;this.value=0;this.fpsList=[];var n=this;setInterval(function(){var t=n.fpsList.length-1;n.value=n.fpsList[t];t>500&&n.fpsList.shift()},500)},_computeFPS:function(){this.current=new Date;this.fpsList.push(parseInt(1e3/(this.current-this.last)));this.last=this.current}});i.Keyboard=t.extend({statics:{ctor:function(){function g(){window.addEventListener?(window.document.addEventListener("keydown",v,!1),window.document.addEventListener("keyup",y,!1),window.addEventListener("blur",u,!1),window.addEventListener("webkitfullscreenchange",u,!1),window.addEventListener("mozfullscreenchange",u,!1)):window.attachEvent&&(window.document.attachEvent("onkeydown",v),window.document.attachEvent("onkeyup",y),window.attachEvent("onblur",u))}function st(){u();window.removeEventListener?(window.document.removeEventListener("keydown",v,!1),window.document.removeEventListener("keyup",y,!1),window.removeEventListener("blur",u,!1),window.removeEventListener("webkitfullscreenchange",u,!1),window.removeEventListener("mozfullscreenchange",u,!1)):window.detachEvent&&(window.document.detachEvent("onkeydown",v),window.document.detachEvent("onkeyup",y),window.detachEvent("onblur",u))}function u(n){r=[];tt();it(n)}function v(n){var t,r,i;if(t=b(n.keyCode),!(t.length<1)){for(n.isRepeat=!1,i=0;i<t.length;i+=1)r=t[i],p().indexOf(r)!=-1&&(n.isRepeat=!0),k(r);lt();pt(n)}}function y(n){var t,i;if(t=b(n.keyCode),!(t.length<1)){for(i=0;i<t.length;i+=1)w(t[i]);tt();it(n)}}function b(n){return s[n]||[]}function nt(n){for(var t in s)if(s.hasOwnProperty(t)&&s[t].indexOf(n)>-1)return t;return!1}function ht(n,t){if(typeof n!="string"&&(typeof n!="object"||typeof n.push!="function"))throw new Error("Cannot create macro. The combo must be a string or array.");if(typeof t!="object"||typeof t.push!="function")throw new Error("Cannot create macro. The injectedKeys must be an array.");i.push([n,t])}function ct(n){var r,t;if(typeof n!="string"&&(typeof n!="object"||typeof n.push!="function"))throw new Error("Cannot remove macro. The combo must be a string or array.");for(t=0;t<i.length;t+=1)if(r=i[t],rt(n,r[0])){w(r[1]);i.splice(t,1);break}}function lt(){for(var r,t,n=0;n<i.length;n+=1)if(r=e(i[n][0]),o.indexOf(i[n])===-1&&h(r))for(o.push(i[n]),t=0;t<i[n][1].length;t+=1)k(i[n][1][t])}function tt(){for(var i,t,n=0;n<o.length;n+=1)if(i=e(o[n][0]),h(i)===!1){for(t=0;t<o[n][1].length;t+=1)w(o[n][1][t]);o.splice(n,1);n-=1}}function at(n,i,r){function c(){for(var n=0;n<u.length;n+=1)t.splice(t.indexOf(u[n]),1)}function l(n){function e(){for(var i,r=0;r<t.length;r+=1)if(typeof t[r]=="function")if(n==="keyup")for(i=0;i<u.length;i+=1)u[i].keyUpCallback.splice(u[i].keyUpCallback.indexOf(t[r]),1);else for(i=0;i<u.length;i+=1)u[i].keyDownCallback.splice(u[i].keyDownCallback.indexOf(t[r]),1)}var f={},t,r,i;if(typeof n!="string")throw new Error("Cannot bind callback. The event name must be a string.");if(n!=="keyup"&&n!=="keydown")throw new Error('Cannot bind callback. The event name must be a "keyup" or "keydown".');for(t=Array.prototype.slice.apply(arguments,[1]),r=0;r<t.length;r+=1)if(typeof t[r]=="function")if(n==="keyup")for(i=0;i<u.length;i+=1)u[i].keyUpCallback.push(t[r]);else if(n==="keydown")for(i=0;i<u.length;i+=1)u[i].keyDownCallback.push(t[r]);return f.clear=e,f}var s={},f,u=[],o,h;for(typeof n=="string"&&(n=e(n)),o=0;o<n.length;o+=1){if(f={},h=ft([n[o]]),typeof h!="string")throw new Error("Failed to bind key combo. The key combo must be string.");f.keyCombo=h;f.keyDownCallback=[];f.keyUpCallback=[];i&&f.keyDownCallback.push(i);r&&f.keyUpCallback.push(r);t.push(f);u.push(f)}return s.clear=c,s.on=l,s}function vt(n){for(var r,i=0;i<t.length;i+=1)r=t[i],rt(n,r.keyCombo)&&(t.splice(i,1),i-=1)}function yt(n){var i,r,u;if(n){for(i=0;i<t.length;i+=1)for(u=t[i],r=0;r<u.keyCombo.length;r+=1)if(u.keyCombo[r].indexOf(n)>-1){t.splice(i,1);i-=1;break}}else t=[]}function pt(n){for(var o,f,s,a,b,u,y,w,e=[],v,c=[].concat(r),i=0;i<t.length;i+=1)v=ut(t[i].keyCombo).length,e[v]||(e[v]=[]),e[v].push(t[i]);for(o=e.length-1;o>=0;o-=1)if(e[o])for(i=0;i<e[o].length;i+=1){for(f=e[o][i],s=ut(f.keyCombo),y=!0,u=0;u<s.length;u+=1)if(c.indexOf(s[u])===-1){y=!1;break}if(y&&h(f.keyCombo)){for(l.push(f),u=0;u<s.length;u+=1)w=c.indexOf(s[u]),w>-1&&(c.splice(w,1),u-=1);for(a=0;a<f.keyDownCallback.length;a+=1)f.keyDownCallback[a](n,p(),f.keyCombo)===!1&&(b=!0);b===!0&&(n.preventDefault(),n.stopPropagation())}}}function it(n){for(var r,i,u,t=0;t<l.length;t+=1)if(i=l[t],h(i.keyCombo)===!1){for(r=0;r<i.keyUpCallback.length;r+=1)i.keyUpCallback[r](n,p(),i.keyCombo)===!1&&(u=!0);u===!0&&(n.preventDefault(),n.stopPropagation());l.splice(t,1);t-=1}}function rt(n,t){var i,r,u;if(n=e(n),t=e(t),n.length!==t.length)return!1;for(i=0;i<n.length;i+=1){if(n[i].length!==t[i].length)return!1;for(r=0;r<n[i].length;r+=1){if(n[i][r].length!==t[i][r].length)return!1;for(u=0;u<n[i][r].length;u+=1)if(t[i][r].indexOf(n[i][r][u])===-1)return!1}}return!0}function h(n){var t,u,f,i,o=0,s,h;for(n=e(n),t=0;t<n.length;t+=1){for(h=!0,o=0,u=0;u<n[t].length;u+=1){for(f=[].concat(n[t][u]),i=o;i<r.length;i+=1)s=f.indexOf(r[i]),s>-1&&(f.splice(s,1),o=i);if(f.length!==0){h=!1;break}}if(h)return!0}return!1}function ut(n){var t,i,r=[];for(n=e(n),t=0;t<n.length;t+=1)for(i=0;i<n[t].length;i+=1)r=r.concat(n[t][i]);return r}function e(n){var i=n,t=0,e=0,s=!1,o=!1,h=[],f=[],u=[],r="";if(typeof n=="object"&&typeof n.push=="function")return n;if(typeof n!="string")throw new Error('Cannot parse "keyCombo" because its type is "'+typeof n+'". It must be a "string".');while(i.charAt(t)===" ")t+=1;for(;;){if(i.charAt(t)===" "){while(i.charAt(t)===" ")t+=1;s=!0}else if(i.charAt(t)===","){if(e||o)throw new Error("Failed to parse key combo. Unexpected , at character index "+t+".");o=!0;t+=1}else if(i.charAt(t)==="+"){if(r.length&&(u.push(r),r=""),e||o)throw new Error("Failed to parse key combo. Unexpected + at character index "+t+".");e=!0;t+=1}else if(i.charAt(t)===">"){if(r.length&&(u.push(r),r=""),u.length&&(f.push(u),u=[]),e||o)throw new Error("Failed to parse key combo. Unexpected > at character index "+t+".");e=!0;t+=1}else if(t<i.length-1&&i.charAt(t)==="!"&&(i.charAt(t+1)===">"||i.charAt(t+1)===","||i.charAt(t+1)==="+"))r+=i.charAt(t+1),e=!1,s=!1,o=!1,t+=2;else if(t<i.length&&i.charAt(t)!=="+"&&i.charAt(t)!==">"&&i.charAt(t)!==","&&i.charAt(t)!==" ")for((e===!1&&s===!0||o===!0)&&(r.length&&(u.push(r),r=""),u.length&&(f.push(u),u=[]),f.length&&(h.push(f),f=[])),e=!1,s=!1,o=!1;t<i.length&&i.charAt(t)!=="+"&&i.charAt(t)!==">"&&i.charAt(t)!==","&&i.charAt(t)!==" ";)r+=i.charAt(t),t+=1;else{t+=1;continue}if(t>=i.length){r.length&&(u.push(r),r="");u.length&&(f.push(u),u=[]);f.length&&(h.push(f),f=[]);break}}return h}function ft(n){var t,i,r=[];if(typeof n=="string")return n;if(typeof n!="object"||typeof n.push!="function")throw new Error("Cannot stringify key combo.");for(t=0;t<n.length;t+=1){for(r[t]=[],i=0;i<n[t].length;i+=1)r[t][i]=n[t][i].join(" + ");r[t]=r[t].join(" > ")}return r.join(" ")}function p(){return[].concat(r)}function k(n){if(n.match(/\s/))throw new Error("Cannot add key name "+n+" to active keys because it contains whitespace.");r.indexOf(n)>-1||r.push(n)}function w(n){var t=nt(n);t==="91"||t==="92"?r=[]:r.splice(r.indexOf(n),1)}function et(n,t){if(typeof n!="string")throw new Error("Cannot register new locale. The locale name must be a string.");if(typeof t!="object")throw new Error("Cannot register "+n+" locale. The locale map must be an object.");if(typeof t.map!="object")throw new Error("Cannot register "+n+" locale. The locale map is invalid.");t.macros||(t.macros=[]);c[n]=t}function ot(n){if(n){if(typeof n!="string")throw new Error("Cannot set locale. The locale name must be a string.");if(!c[n])throw new Error("Cannot set locale to "+n+" because it does not exist. If you would like to submit a "+n+" locale map for KeyboardJS please submit it at https://github.com/RobertWHurst/KeyboardJS/issues.");s=c[n].map;i=c[n].macros;d=n}return d}for(var n={},c={},d,s,i,r=[],t=[],l=[],o=[],a={map:{"3":["cancel"],"8":["backspace"],"9":["tab"],"12":["clear"],"13":["enter"],"16":["shift"],"17":["ctrl"],"18":["alt","menu"],"19":["pause","break"],"20":["capslock"],"27":["escape","esc"],"32":["space","spacebar"],"33":["pageup"],"34":["pagedown"],"35":["end"],"36":["home"],"37":["left"],"38":["up"],"39":["right"],"40":["down"],"41":["select"],"42":["printscreen"],"43":["execute"],"44":["snapshot"],"45":["insert","ins"],"46":["delete","del"],"47":["help"],"91":["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"],"92":["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"],"145":["scrolllock","scroll"],"186":["semicolon",";"],"187":["equal","equalsign","="],"188":["comma",","],"189":["dash","-"],"190":["period","."],"191":["slash","forwardslash","/"],"192":["graveaccent","`"],"219":["openbracket","["],"220":["backslash","\\"],"221":["closebracket","]"],"222":["apostrophe","'"],"48":["zero","0"],"49":["one","1"],"50":["two","2"],"51":["three","3"],"52":["four","4"],"53":["five","5"],"54":["six","6"],"55":["seven","7"],"56":["eight","8"],"57":["nine","9"],"96":["numzero","num0"],"97":["numone","num1"],"98":["numtwo","num2"],"99":["numthree","num3"],"100":["numfour","num4"],"101":["numfive","num5"],"102":["numsix","num6"],"103":["numseven","num7"],"104":["numeight","num8"],"105":["numnine","num9"],"106":["nummultiply","num*"],"107":["numadd","num+"],"108":["numenter"],"109":["numsubtract","num-"],"110":["numdecimal","num."],"111":["numdivide","num/"],"144":["numlock","num"],"112":["f1"],"113":["f2"],"114":["f3"],"115":["f4"],"116":["f5"],"117":["f6"],"118":["f7"],"119":["f8"],"120":["f9"],"121":["f10"],"122":["f11"],"123":["f12"]},macros:[["shift + `",["tilde","~"]],["shift + 1",["exclamation","exclamationpoint","!"]],["shift + 2",["at","@"]],["shift + 3",["number","#"]],["shift + 4",["dollar","dollars","dollarsign","$"]],["shift + 5",["percent","%"]],["shift + 6",["caret","^"]],["shift + 7",["ampersand","and","&"]],["shift + 8",["asterisk","*"]],["shift + 9",["openparen","("]],["shift + 0",["closeparen",")"]],["shift + -",["underscore","_"]],["shift + =",["plus","+"]],["shift + (",["opencurlybrace","opencurlybracket","{"]],["shift + )",["closecurlybrace","closecurlybracket","}"]],["shift + \\",["verticalbar","|"]],["shift + ;",["colon",":"]],["shift + '",["quotationmark",'"']],["shift + !,",["openanglebracket","<"]],["shift + .",["closeanglebracket",">"]],["shift + /",["questionmark","?"]]]},f=65;f<=90;f+=1)a.map[f]=String.fromCharCode(f+32),a.macros.push(["shift + "+String.fromCharCode(f+32)+", capslock + "+String.fromCharCode(f+32),[String.fromCharCode(f)]]);et("us",a);ot("us");g();n.enable=g;n.disable=st;n.activeKeys=p;n.releaseKey=w;n.pressKey=k;n.on=at;n.clear=vt;n.clear.key=yt;n.locale=ot;n.locale.register=et;n.macro=ht;n.macro.remove=ct;n.key={};n.key.name=b;n.key.code=nt;n.combo={};n.combo.active=h;n.combo.parse=e;n.combo.stringify=ft;this.Keyboard=n},on:function(n,t,i){this.Keyboard.on(n,t,i)},getActiveKeys:function(){return this.Keyboard.activeKeys()}}});i.Loader=t.extend({ctor:function(){this.audios={};this.res={};this.loadedCount=0;this.resCount=-1;this.FILE_PATTERN=/(\w+:\/{2})?((?:\w+\.){2}\w+)?(\/?[\S]+\/|\/)?([\w\-%\.]+)(?:\.)(\w+)?(\?\S+)?/i;this.ns=3;this.sounds=[];for(var n=0;n<this.ns;n++)this.sounds.push([]);this.playing=[];this.soundsCount=0},get:function(n){return this.res[n]},loadRes:function(n){this.resCount=n.length;for(var t=0;t<n.length;t++)this._getTypeByExtension(n[t].src.match(this.FILE_PATTERN)[5])=="audio"?this.loadAudio(n[t].id,n[t].src):this.loadImage(n[t].id,n[t].src)},loadImage:function(n,t){var i=document.createElement("img"),r=this;i.onload=function(){r._handleLoad(this,n);i.onreadystatechange=null};i.onreadystatechange=function(){(i.readyState=="loaded"||i.readyState=="complete")&&(r._handleLoad(this,n),i.onload=null)};i.onerror=function(){};i.src=t},loadAudio:function(n,t){var i=document.createElement("audio"),r,u;i.autoplay=!1;this.res[n]=i;i.src=null;i.preload="auto";i.onerror=function(){};i.onstalled=function(){};r=this;u=function(){r.playing[n]=0;for(var i=0;i<r.ns;i++)r.sounds[i][n]=new Audio(t);r.loadedCount++;r.handleProgress(r.loadedCount,r.resCount);r._clean(this);this.removeEventListener&&this.removeEventListener("canplaythrough",u,!1);r.checkComplete()};i.addEventListener("canplaythrough",u,!1);i.src=t;i.load!=null&&i.load()},checkComplete:function(){this.loadedCount===this.resCount&&this.handleComplete()},complete:function(n){this.handleComplete=n},progress:function(n){this.handleProgress=n},playSound:function(n){this.sounds[this.playing[n]][n].play();++this.playing[n];this.playing[n]>=this.ns&&(this.playing[n]=0)},_handleLoad:function(n,t){this._clean(n);this.res[t]=n;this.loadedCount++;this.handleProgress&&this.handleProgress(this.loadedCount,this.resCount);this.checkComplete()},_getTypeByExtension:function(n){switch(n){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return"img";case"ogg":case"mp3":case"wav":return"audio"}},_clean:function(n){n.onload=null;n.onstalled=null;n.onprogress=null;n.onerror=null}});i.Matrix2D=t.extend({statics:{DEG_TO_RAD:.017453292519943295},ctor:function(n,t,i,r,u,f){return this.a=n==null?1:n,this.b=t||0,this.c=i||0,this.d=r==null?1:r,this.tx=u||0,this.ty=f||0,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},appendTransform:function(n,t,r,u,f,e,o,s,h,c,l){if(f%360)var y=f*i.Matrix2D.DEG_TO_RAD,a=Math.cos(y),v=Math.sin(y);else a=1,v=0;return e||o?(e*=i.Matrix2D.DEG_TO_RAD,o*=i.Matrix2D.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(e),Math.cos(e),n,t),this.append(a*r,v*r,-v*u,a*u,0,0)):this.append(a*r,v*r,-v*u,a*u,n,t),(s||h)&&(this.tx-=s*this.a+h*this.c,this.ty-=s*this.b+h*this.d),c&&(this.a*=-1,this.c*=-1),l&&(this.b*=-1,this.d*=-1),this},append:function(n,t,i,r,u,f){var e=this.a,o=this.b,s=this.c,h=this.d;return this.a=n*e+t*s,this.b=n*o+t*h,this.c=i*e+r*s,this.d=i*o+r*h,this.tx=u*e+f*s+this.tx,this.ty=u*o+f*h+this.ty,this},reinitialize:function(n,t,i,r,u,f,e,o,s){return this.initialize(n,t,i,r,u,f),this.alpha=e||1,this.shadow=o,this.compositeOperation=s,this},initialize:function(n,t,i,r,u,f){return n!=null&&(this.a=n),this.b=t||0,this.c=i||0,r!=null&&(this.d=r),this.tx=u||0,this.ty=f||0,this}});i.Observable=t.extend({statics:{ctor:function(){this.methods=["concat","every","filter","forEach","indexOf","join","lastIndexOf","map","pop","push","reduce","reduceRight","reverse","shift","slice","some","sort","splice","unshift","valueOf"];this.triggerStr="concat,pop,push,reverse,shift,sort,splice,unshift"},type:function(n){var t=Object.prototype.toString.call(n).split(" ")[1];return t.substr(0,t.length-1).toLowerCase()},isArray:function(n){return this.type(n)=="array"},isInArray:function(n,t){for(var i=n.length;--i>-1;)if(t===n[i])return!0;return!1},isFunction:function(n){return this.type(n)=="function"},watch:function(n,t){return new this(n,t)}},ctor:function(n,t){var r,u;for(r in n)n.hasOwnProperty(r)&&(t&&i.Observable.isInArray(t,r)||!t)&&this.watch(n,r);if(n.change)throw"naming conflictsï¼observable will extend 'change' method to your object .";u=this;n.change=function(n){u.propertyChangedHandler=n}},onPropertyChanged:function(n,t){this.propertyChangedHandler&&this.propertyChangedHandler(n,t)},mock:function(n){var t=this;i.Observable.methods.forEach(function(r){n[r]=function(){var u=Array.prototype[r].apply(this,Array.prototype.slice.call(arguments));for(var n in this)this.hasOwnProperty(n)&&n!="_super"&&!i.Observable.isFunction(this[n])&&t.watch(this,n);if(new RegExp("\\b"+r+"\\b").test(i.Observable.triggerStr))t.onPropertyChanged("array",r);return u}})},watch:function(n,t){var f,r,u;if(t.substr(0,2)!="__"&&(f=this,!i.Observable.isFunction(n[t]))&&(r=n["__"+t]=n[t],Object.defineProperty(n,t,{get:function(){return this["__"+t]},set:function(n){this["__"+t]=n;f.onPropertyChanged(t,n)}}),i.Observable.isArray(n)&&this.mock(n),typeof r=="object")){i.Observable.isArray(r)&&this.mock(r);for(u in r)r.hasOwnProperty(u)&&u!="_super"&&this.watch(r,u)}}});i.RAF=t.extend({statics:{ctor:function(){var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}(),t=function(t,i){function f(){var e=(new Date).getTime(),o=e-u;o>=i&&(t.call(),u=(new Date).getTime());r.value=n(f)}if(!window.requestAnimationFrame&&!window.webkitRequestAnimationFrame&&!(window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame)&&!window.oRequestAnimationFrame&&!window.msRequestAnimationFrame)return window.setInterval(t,i);var u=(new Date).getTime(),r={};return r.value=n(f),r},i=function(n){n&&setTimeout(function(){window.cancelAnimationFrame?window.cancelAnimationFrame(n.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(n.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(n.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(n.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(n.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(n.value):clearInterval(n)},0)};this.requestInterval=t;this.clearRequestInterval=i}}});i.TWEEN=t.extend({statics:{ctor:function(){Date.now===undefined&&(Date.now=function(){return(new Date).valueOf()});this._tweens=[]},REVISION:"14",getAll:function(){return this._tweens},removeAll:function(){this._tweens=[]},add:function(n){this._tweens.push(n)},remove:function(n){var t=this._tweens.indexOf(n);t!==-1&&this._tweens.splice(t,1)},update:function(n){if(this._tweens.length===0)return!1;var t=0;for(n=n!==undefined?n:typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();t<this._tweens.length;)this._tweens[t].update(n)?t++:this._tweens.splice(t,1);return!0},Tween:function(n){var r=n,u={},t={},f={},k=1e3,s=0,c=!1,l=!1,d=!1,a=0,e=null,g=i.TWEEN.Easing.Linear.None,nt=i.TWEEN.Interpolation.Linear,o=[],v=null,y=!1,p=null,w=null,b=null,h=!1,tt=null;for(var it in n)u[it]=parseFloat(n[it],10);this.togglePlayPause=function(){h?this.play():this.pause()};this.pause=function(){h=!0;var n=typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();tt=n-e};this.play=function(){h=!1;var n=typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();e=n-tt};this.to=function(n,i){return i!==undefined&&(k=i),t=n,this};this.start=function(n){i.TWEEN.add(this);l=!0;y=!1;e=(n!==undefined?n:typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now())+a;for(var o in t){if(t[o]instanceof Array){if(t[o].length===0)continue;t[o]=[r[o]].concat(t[o])}u[o]=r[o];u[o]instanceof Array==!1&&(u[o]*=1);f[o]=u[o]||0}return this};this.stop=function(){return l?(i.TWEEN.remove(this),l=!1,b!==null&&b.call(r),this.stopChainedTweens(),this):this};this.stopChainedTweens=function(){for(var n=0,t=o.length;n<t;n++)o[n].stop()};this.delay=function(n){return a=n,this};this.repeat=function(n){return s=n,this};this.yoyo=function(n){return c=n,this};this.easing=function(n){return g=n,this};this.interpolation=function(n){return nt=n,this};this.chain=function(){return o=arguments,this};this.onStart=function(n){return v=n,this};this.onUpdate=function(n){return p=n,this};this.onComplete=function(n){return w=n,this};this.onStop=function(n){return b=n,this};this.update=function(n){var i,b,tt,it,l,ut,rt,ft;if(h||n<e)return!0;y===!1&&(v!==null&&v.call(r),y=!0);b=(n-e)/k;b=b>1?1:b;tt=g(b);for(i in t)it=u[i]||0,l=t[i],l instanceof Array?r[i]=nt(l,tt):(typeof l=="string"&&(l=it+parseFloat(l,10)),typeof l=="number"&&(r[i]=it+(l-it)*tt));if(p!==null&&p.call(r,tt),b==1){if(s>0){isFinite(s)&&s--;for(i in f)typeof t[i]=="string"&&(f[i]=f[i]+parseFloat(t[i],10)),c&&(ut=f[i],f[i]=t[i],t[i]=ut),u[i]=f[i];return c&&(d=!d),e=n+a,!0}for(w!==null&&w.call(r),rt=0,ft=o.length;rt<ft;rt++)o[rt].start(n);return!1}return!0}},Easing:{Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return 1-Math.cos(n*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return.5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)))},Out:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin((n-i)*2*Math.PI/r)+1)},InOut:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),(n*=2)<1)?-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r):t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)*.5+1}},Back:{In:function(n){var t=1.70158;return n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},InOut:function(n){var t=1.70158*1.525;return(n*=2)<1?.5*n*n*((t+1)*n-t):.5*((n-=2)*n*((t+1)*n+t)+2)}},Bounce:{In:function(n){return 1-i.TWEEN.Easing.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?i.TWEEN.Easing.Bounce.In(n*2)*.5:i.TWEEN.Easing.Bounce.Out(n*2-1)*.5+.5}}},Interpolation:{Linear:function(n,t){var r=n.length-1,u=r*t,f=Math.floor(u),e=i.TWEEN.Interpolation.Utils.Linear;return t<0?e(n[0],n[1],u):t>1?e(n[r],n[r-1],r-u):e(n[f],n[f+1>r?r:f+1],u-f)},Bezier:function(n,t){for(var f=0,u=n.length-1,e=Math.pow,o=i.TWEEN.Interpolation.Utils.Bernstein,r=0;r<=u;r++)f+=e(1-t,u-r)*e(t,r)*n[r]*o(u,r);return f},CatmullRom:function(n,t){var r=n.length-1,f=r*t,u=Math.floor(f),e=i.TWEEN.Interpolation.Utils.CatmullRom;return n[0]===n[r]?(t<0&&(u=Math.floor(f=r*(1+t))),e(n[(u-1+r)%r],n[u],n[(u+1)%r],n[(u+2)%r],f-u)):t<0?n[0]-(e(n[0],n[0],n[1],n[1],-f)-n[0]):t>1?n[r]-(e(n[r],n[r],n[r-1],n[r-1],f-r)-n[r]):e(n[u?u-1:0],n[u],n[r<u+1?r:u+1],n[r<u+2?r:u+2],f-u)},Utils:{Linear:function(n,t,i){return(t-n)*i+n},Bernstein:function(n,t){var r=i.TWEEN.Interpolation.Utils.getFactorial();return r(n)/r(t)/r(n-t)},getFactorial:function(){return function(){var n=[1];return function(t){var r=1,i;if(n[t])return n[t];for(i=t;i>1;i--)r*=i;return n[t]=r}}()},CatmullRom:function(n,t,i,r,u){var f=(i-n)*.5,e=(r-t)*.5,o=u*u,s=u*o;return(2*t-2*i+f+e)*s+(-3*t+3*i-2*f-e)*o+f*u+t}}}}});i.UID=t.extend({statics:{_nextID:0,_nextCacheID:1,get:function(){return this._nextID++},getCacheID:function(){return this._nextCacheID++}}});i.Util=t.extend({statics:{random:function(n,t){return n+Math.floor(Math.random()*(t-n+1))}}});i.Vector2=t.extend({ctor:function(n,t){this.x=n;this.y=t},copy:function(){return new i.Vector2(this.x,this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},sqrLength:function(){return this.x*this.x+this.y*this.y},normalize:function(){var n=1/this.length();return new i.Vector2(this.x*n,this.y*n)},negate:function(){return new i.Vector2(-this.x,-this.y)},add:function(n){this.x+=n.x;this.y+=n.y},subtract:function(n){return new i.Vector2(this.x-n.x,this.y-n.y)},multiply:function(n){return new i.Vector2(this.x*n,this.y*n)},divide:function(n){var t=1/n;return new i.Vector2(this.x*t,this.y*t)},dot:function(n){return this.x*n.x+this.y*n.y}});typeof module!="undefined"&&module.exports&&this.module!==module?module.exports=i:typeof define=="function"&&define.amd?define(i):n.ARE=i}()})(Function("return this")())