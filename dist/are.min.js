/* Alloy Game Engine
 * By AlloyTeam http://www.alloyteam.com/
 * Github: https://github.com/AlloyTeam/AlloyGameEngine
 * MIT Licensed.
 */
(function(n){var i=!1,r=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,t=function(){};t.extend=function(n){function u(){!i&&this.ctor&&this.ctor.apply(this,arguments)}var o=this.prototype,e,f,t;i=!0;e=new this;i=!1;for(t in n)t!="statics"&&(e[t]=typeof n[t]=="function"&&typeof o[t]=="function"&&r.test(n[t])?function(n,t){return function(){var r=this._super,i;return this._super=o[n],i=t.apply(this,arguments),this._super=r,i}}(t,n[t]):n[t]);for(f in this)this.hasOwnProperty(f)&&f!="extend"&&(u[f]=this[f]);if(u.prototype=e,n.statics)for(t in n.statics)n.statics.hasOwnProperty(t)&&(u[t]=n.statics[t],t=="ctor"&&u[t]());return u.prototype.constructor=u,u.extend=arguments.callee,u.implement=function(n){for(var t in n)e[t]=n[t]},u},function(){var i={};i.FPS=t.extend({statics:{get:function(){return this.instance||(this.instance=new this),this.instance._computeFPS(),this.instance}},ctor:function(){this.last=new Date;this.current=null;this.value=0;this.totalValue=0;this.fpsList=[];this.count=0;var n=this;setInterval(function(){var t=n.fpsList.length-1;n.value=n.fpsList[t];t>500&&n.fpsList.shift();n.averageFPS=Math.ceil(n.totalValue/n.count)},500)},_computeFPS:function(){if(this.current=new Date,this.current-this.last>0){var n=Math.ceil(1e3/(this.current-this.last));this.fpsList.push(n);this.count++;this.totalValue+=n;this.last=this.current}}});i.DisplayObject=t.extend({ctor:function(){this.alpha=this.scaleX=this.scaleY=this.scale=1;this.x=this.y=this.rotation=this.originX=this.originY=this.skewX=this.skewY=this.width=this.height=this.regX=this.regY=0;this.textureReady=!0;this.visible=!0;this._matrix=new i.Matrix2D;this._hitMatrix=new i.Matrix2D;this.events={};this.id=i.UID.get();this.cacheID=0;this.baseInstanceof="DisplayObject";var n=this;this._watch(this,"originX",function(t,i){n.regX=typeof i=="string"?parseInt(i):n.width*i});this._watch(this,"originY",function(t,i){n.regY=typeof i=="string"?parseInt(i):n.height*i});this._watch(this,"filter",function(t,i){n.setFilter.apply(n,i)});this._watch(this,"scale",function(){this.scaleX=this.scaleY=this.scale});this._preAABB=[-1,-1,0,0]},_watch:function(n,t,i){var r=this,u=n["__"+t]=this[t];Object.defineProperty(n,t,{get:function(){return this["__"+t]},set:function(r){this["__"+t]=r;i.apply(n,[t,r])}})},isVisible:function(){return!!(this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0&&this.textureReady)},on:function(n,t){this.events[n]||(this.events[n]=[]);this.events[n].push(t)},execEvent:function(n,t,i){var e=this.events[n],o=!0,r,u,f;if(e)for(r=0,u=e.length;r<u;r++)o=e[r].call(this,{stageX:t,stageY:i,type:n});if((n==="mouseup"||n==="touchend")&&(f=this.events.pressup,f))for(r=0,u=f.length;r<u;r++)o=f[r].call(this,{stageX:t,stageY:i,type:"pressup"});return o},clone:function(){var n=new i.DisplayObject;return this.cloneProps(n),n},cloneProps:function(n){n.visible=this.visible;n.alpha=this.alpha;n.originX=this.originX;n.originY=this.originY;n.rotation=this.rotation;n.scaleX=this.scaleX;n.scaleY=this.scaleY;n.skewX=this.skewX;n.skewY=this.skewY;n.x=this.x;n.y=this.y;n.regX=this.regX;n.regY=this.regY},cache:function(){if(!this.cacheCanvas){this.cacheCanvas=document.createElement("canvas");var n=this.getBound();this.cacheCanvas.width=n.width;this.cacheCanvas.height=n.height;this.cacheCtx=this.cacheCanvas.getContext("2d")}this.cacheID=i.UID.getCacheID();this.updateCache(this.cacheCtx,this,n.width,n.width)},uncache:function(){this.cacheCanvas=null;this.cacheCtx=null;this.cacheID=null},setFilter:function(n,t,i,r){var e,f,u,o;if(this.width!==0&&this.height!==0){for(this.uncache(),this.cache(),e=this.cacheCtx.getImageData(0,0,this.cacheCanvas.width,this.cacheCanvas.height),f=e.data,u=0,o=f.length;u<o;u+=4)f[u+3]>0&&(f[u]*=n,f[u+1]*=t,f[u+2]*=i,f[u+3]*=r);this.cacheCtx.putImageData(e,0,0)}},getBound:function(){return{width:this.width,height:this.height}},toCenter:function(){this.originX=.5;this.originY=.5;this.x=this.parent.width/2;this.y=this.parent.height/2},onClick:function(n){this.on("click",n)},onMouseMove:function(n){this.on("mousemove",n)},onMouseDown:function(n){this.on("mousedown",n)},onPressMove:function(n){this.on("pressmove",n)},onHover:function(n,t){this.on("mouseover",n);this.on("mouseout",t)},destroy:function(){this.cacheCanvas=null;this.cacheCtx=null;this.cacheID=null;this._matrix=null;this.events=null;this.parent&&this.parent.remove(this)},initAABB:function(){var n=0,t=0,h=this.width,c=this.height,e=this._matrix,l=h*e.a,a=h*e.b,v=c*e.c,y=c*e.d,o=e.tx,s=e.ty,i=o,u=o,r=s,f=s;(n=l+o)<i?i=n:n>u&&(u=n);(n=l+v+o)<i?i=n:n>u&&(u=n);(n=v+o)<i?i=n:n>u&&(u=n);(t=a+s)<r?r=t:t>f&&(f=t);(t=a+y+s)<r?r=t:t>f&&(f=t);(t=y+s)<r?r=t:t>f&&(f=t);this.AABB=[i,r,u-i,f-r]},getRectPoints:function(){var r=this.width,u=this.height,n=this._matrix,f=r*n.a,e=r*n.b,o=u*n.c,s=u*n.d,t=n.tx,i=n.ty;return this.rectPoints=[{x:t,y:i},{x:f+t,y:e+i},{x:f+o+t,y:e+s+i},{x:o+t,y:s+i}],this.rectPoints},onPressUp:function(n){this.on("pressup",n)},onMouseWheel:function(n){this.on("mousewheel",n)},onTouchStart:function(n){this.on("touchstart",n)},onTouchMove:function(n){this.on("touchmove",n)},onTouchEnd:function(n){this.on("touchend",n)},updateCache:function(n,t,i,r){n.clearRect(0,0,i+1,r+1);this.renderCache(n,t)},renderCache:function(n,t){var f,u,e,r;if(t.isVisible())if(t instanceof i.Container||t instanceof i.Stage)for(f=t.children.slice(0),u=0,e=f.length;u<e;u++)n.save(),this.render(n,f[u]),n.restore();else t instanceof i.Bitmap||t instanceof i.Sprite?(r=t.rect,n.drawImage(t.img,r[0],r[1],r[2],r[3],0,0,r[2],r[3])):t.txtCanvas?n.drawImage(t.txtCanvas,0,0):t.shapeCanvas&&n.drawImage(t.shapeCanvas,0,0)}});i.Container=i.DisplayObject.extend({ctor:function(){this._super();this.children=[];this.baseInstanceof="Container"},add:function(n){var f=arguments.length,u,t,r;if(f>1)for(u=0;u<f;u++)t=arguments[u],t&&(this.children.push(t),t.parent=this,t instanceof i.DomElement&&(i.Stage.domSurface.appendChild(t.element),t.element.style.visibility="visible",r=window.getComputedStyle(t.element,null),t.width=parseInt(r.width),t.height=parseInt(r.height)));else n&&(this.children.push(n),n.parent=this,n instanceof i.DomElement&&(i.Stage.domSurface.appendChild(n.element),n.element.style.visibility="visible",r=window.getComputedStyle(n.element,null),n.width=parseInt(r.width),n.height=parseInt(r.height)))},remove:function(n){var e=arguments.length,o=this.children.length,r,t,u,f;if(e>1){for(r=0;r<e;r++)for(t=arguments[r],u=o;--u>=0;)if(this.children[u].id==t.id){t.parent=null;this.children.splice(u,1);t instanceof i.DomElement&&i.Stage.domSurface.removeChild(t.element);break}}else for(f=o;--f>=0;)if(this.children[f].id==n.id){n.parent=null;this.children.splice(f,1);n instanceof i.DomElement&&i.Stage.domSurface.removeChild(n.element);break}},clone:function(){var t=new i.Container,r,n,u;for(this.cloneProps(t),r=t.children=[],n=this.children.length-1;n>-1;n--)u=this.children[n].clone(),r.unshift(u);return t},removeAll:function(){for(var n=this.children;n.length;)n.pop().parent=null},destroy:function(){var n,t;for(this._super(),n=this.children;n.length;)t=n.pop(),t.destroy()},swapChildrenAt:function(n,t){var i=this.children,r=i[n],u=i[t];r&&u&&(i[n]=u,i[t]=r)},swapChildren:function(n,t){for(var r=this.children,u,f,i=0,e=r.length;i<e;i++)if(r[i]==n&&(u=i),r[i]==t&&(f=i),u!=null&&f!=null)break;i!=e&&(r[u]=t,r[f]=n)},swapToTop:function(n){this.swapChildren(n,this.children[this.children.length-1])}});i.DomElement=i.DisplayObject.extend({ctor:function(n){this._super();this.element=typeof n=="string"?document.querySelector(n):n;var u=this.element,r=i.Observable.watch(this,["x","y","scaleX","scaleY","perspective","rotation","skewX","skewY","regX","regY"]),t=this;r.propertyChangedHandler=function(){var n=t._matrix.identity().appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY);t.element.style.transform=t.element.style.msTransform=t.element.style.OTransform=t.element.style.MozTransform=t.element.style.webkitTransform="matrix("+n.a+","+n.b+","+n.c+","+n.d+","+n.tx+","+n.ty+")"};delete this.visible;Object.defineProperty(this,"visible",{set:function(n){this._visible=n;this.element.style.visibility=this._visible?"visible":"hidden"},get:function(){return this._visible}});delete this.alpha;Object.defineProperty(this,"alpha",{set:function(n){this._opacity=n;this.element.style.opacity=n},get:function(){return this._opacity}});this.visible=!0;this.alpha=1;this.element.style.visibility="hidden";this.element.style.position="absolute"},isVisible:function(){return!!(this.visible&&this.alpha>0&&this.scaleX!=0&&this.scaleY!=0)}});i.Bitmap=i.DisplayObject.extend({ctor:function(n){(this._super(),arguments.length!==0)&&(typeof n=="string"?this._initWithSrc(n):this._init(n))},_initWithSrc:function(n){var r=i.Bitmap[n],t;r?this._init(r):(t=this,this.textureReady=!1,this.img=document.createElement("img"),this.img.onload=function(){t.rect||(t.rect=[0,0,t.img.width,t.img.height]);t.width=t.rect[2];t.height=t.rect[3];t.regX=t.width*t.originX;t.regY=t.height*t.originY;i.Bitmap[n]=t.img;t.textureReady=!0;t.imageLoadHandle&&t.imageLoadHandle();t.filter&&(t.filter=t.filter)},this.img.src=n)},_init:function(n){n&&(this.img=n,this.width=n.width,this.height=n.height,Object.defineProperty(this,"rect",{get:function(){return this.__rect},set:function(n){this.__rect=n;this.width=n[2];this.height=n[3];this.regX=n[2]*this.originX;this.regY=n[3]*this.originY}}),this.rect=[0,0,n.width,n.height])},useImage:function(n){typeof n=="string"?this._initWithSrc(n):(this._init(n),this.imageLoadHandle&&this.imageLoadHandle())},onImageLoad:function(n){this.imageLoadHandle=n},clone:function(){var n=new i.Bitmap(this.img);return n.rect=this.rect.slice(0),this.cloneProps(n),n},flipX:function(){},flipY:function(){}});i.Particle=i.Bitmap.extend({ctor:function(n){this._super(n.texture);this.originX=.5;this.originY=.5;this.position=n.position;this.x=this.position.x;this.y=this.position.y;this.rotation=n.rotation||0;this.velocity=n.velocity;this.acceleration=n.acceleration||new i.Vector2(0,0);this.rotatingSpeed=n.rotatingSpeed||0;this.rotatingAcceleration=n.rotatingAcceleration||0;this.hideSpeed=n.hideSpeed||.01;this.zoomSpeed=n.hideSpeed||.01;this.isAlive=!0;this.img=n.texture;this.img.src=""},tick:function(){this.velocity.add(this.acceleration);this.position.add(this.velocity.multiply(.1));this.rotatingSpeed+=this.rotatingAcceleration;this.rotation+=this.rotatingSpeed;this.alpha-=this.hideSpeed;this.x=this.position.x;this.y=this.position.y;this.alpha=this.alpha}});i.ParticleSystem=i.Container.extend({ctor:function(n){this._super();this.speed=n.speed;this.angle=n.angle;this.angleRange=n.angleRange;this.emitArea=n.emitArea;this.gravity=n.gravity||{x:0,y:0};this.filter=n.filter;this.compositeOperation="lighter";this.emitCount=n.emitCount;this.maxCount=n.maxCount||1e3;this.emitX=n.emitX;this.emitY=n.emitY;var t=this;if(typeof n.texture=="string")if(i.Bitmap[n.texture])this.texture=i.Bitmap[n.texture],this.generateFilterTexture(this.texture);else{this.bitmap=new i.Bitmap;this.bitmap._parent=this;this.bitmap.onImageLoad(function(){this._parent.texture=this.img;this._parent.generateFilterTexture(this.img);delete this._parent});this.bitmap.useImage(n.texture)}else this.texture=n.texture,this.generateFilterTexture(n.texture);this.totalCount=n.totalCount;this.emittedCount=0;this.tickFPS=60;this.hideSpeed=n.hideSpeed||.01},generateFilterTexture:function(n){var t=new i.Bitmap(n);t.filter=this.filter;this.filterTexture=t.cacheCanvas},emit:function(){var n=(this.angle+i.Util.random(-this.angleRange/2,this.angleRange/2))*Math.PI/180,t=this.emitArea[0]/2,r=this.emitArea[1]/2,u=new i.Particle({position:new i.Vector2(this.emitX+i.Util.random(-t,t),this.emitY+i.Util.random(-r,r)),velocity:new i.Vector2(this.speed*Math.cos(n),this.speed*Math.sin(n)),texture:this.filterTexture,acceleration:this.gravity,hideSpeed:this.hideSpeed});this.add(u);this.emittedCount++},tick:function(){var n,r,t,i;if(this.filterTexture){if(n=this.children.length,this.totalCount&&this.emittedCount>this.totalCount)n===0&&this.destroy();else if(n<this.maxCount)for(r=0;r<this.emitCount;r++)this.emit();for(t=0;t<n;t++)i=this.children[t],i.isVisible()?i.tick():(this.remove(i),t--,n--)}}});i.Sprite=i.DisplayObject.extend({ctor:function(n){var e,f,r,u,t;for(this._super(),this.option=n,this.x=n.x||0,this.y=n.y||0,this.currentFrameIndex=0,this.animationFrameIndex=0,this.currentAnimation=n.currentAnimation||null,this.rect=[0,0,10,10],this.visible=!1,this.bitmaps=[],this._loadedCount=0,e=this,f=this.option.imgs.length,r=0;r<f;r++)if(u=this.option.imgs[r],typeof u=="string")if(i.Bitmap[u])this.bitmaps.push(new i.Bitmap(i.Bitmap[u])),this._loadedCount++;else{t=new i.Bitmap;t._sprite=this;t.onImageLoad(function(){t._sprite._loadedCount++;t._sprite._loadedCount===f&&(t._sprite.visible=!0,delete t._sprite)});t.useImage(this.option.imgs[r]);this.bitmaps.push(t)}else this._loadedCount++,this.bitmaps.push(new i.Bitmap(u));this._loadedCount===f&&(this.visible=!0);this.img=this.bitmaps[0].img;this.interval=1e3/n.framerate;this.loop=null;this.paused=!1;this.animationEnd=n.animationEnd||null;this.currentAnimation&&this.gotoAndPlay(this.currentAnimation);this.tickAnimationEnd=n.tickAnimationEnd||null},play:function(){this.paused=!1},stop:function(){this.paused=!0},reset:function(){this.currentFrameIndex=0;this.animationFrameIndex=0},gotoAndPlay:function(n,t){this.paused=!1;this.reset();clearInterval(this.loop);this.currentAnimation=n;var i=this,r=0;this.loop=setInterval(function(){var n,u;if(!i.paused){var f=i.option,e=f.animations[i.currentAnimation].frames,o=e.length;i.animationFrameIndex++;i.animationFrameIndex>o-1&&(r++,i.animationFrameIndex=0,i.tickAnimationEnd&&i.tickAnimationEnd(),t&&r==t&&(i.animationEnd&&i.animationEnd(),i.paused=!0,clearInterval(i.loop),i.parent.remove(i)));i.rect=f.frames[e[i.animationFrameIndex]];i.width=i.rect[2];i.height=i.rect[3];n=i.rect;u=n.length;u>4&&(i.regX=n[2]*n[4]);u>5&&(i.regY=n[3]*n[5]);u>6&&(i.img=i.bitmaps[n[6]].img)}},this.interval)},gotoAndStop:function(n){var t,i,r;this.reset();clearInterval(this.loop);t=this;t.currentAnimation=n;var u=t.option,f=u.animations[t.currentAnimation].frames,e=f.length;t.rect=u.frames[f[t.animationFrameIndex]];t.width=t.rect[2];t.height=t.rect[3];i=t.rect;r=i.length;r>4&&(t.regX=i[2]*i[4]);r>5&&(t.regY=i[3]*i[5]);r>6&&(t.img=t.bitmaps[i[6]].img)}});i.Shape=i.DisplayObject.extend({ctor:function(n,t,i){this._super();this.cmds=[];this.assMethod=["fillStyle","strokeStyle","lineWidth"];this.width=n;this.height=t;this._width=n;this._height=t;this.shapeCanvas=document.createElement("canvas");this.shapeCanvas.width=this.width;this.shapeCanvas.height=this.height;this.shapeCtx=this.shapeCanvas.getContext("2d");i&&(this.fillStyle("red"),this.fillRect(0,0,n,t));this._watch(this,"scaleX",function(n,t){this.width=this._width*t;this.height=this._height*this.scaleY;this.originX=this.originX;this.shapeCanvas.width=this.width;this.shapeCanvas.height=this.height;this.shapeCtx.scale(t,this.scaleY);this.end()});this._watch(this,"scaleY",function(n,t){this.width=this._width*this.scaleX;this.height=this._height*t;this.originY=this.originY;this.shapeCanvas.width=this.width;this.shapeCanvas.height=this.height;this.shapeCtx.scale(this.scaleX,t);this.end()})},end:function(){var t,r,u,n;for(this.cacheID=i.UID.getCacheID(),t=this.shapeCtx,r=0,u=this.cmds.length;r<u;r++)n=this.cmds[r],this.assMethod.join("-").match(new RegExp("\\b"+n[0]+"\\b","g"))?t[n[0]]=n[1][0]:t[n[0]].apply(t,Array.prototype.slice.call(n[1]))},clearRect:function(n,t,r,u){this.cacheID=i.UID.getCacheID();this.shapeCtx.clearRect(n,t,r,u)},clear:function(){this.cacheID=i.UID.getCacheID();this.shapeCtx.clearRect(0,0,this.width,this.height)},strokeRect:function(){return this.cmds.push(["strokeRect",arguments]),this},fillRect:function(){return this.cmds.push(["fillRect",arguments]),this},beginPath:function(){return this.cmds.push(["beginPath",arguments]),this},arc:function(){return this.cmds.push(["arc",arguments]),this},closePath:function(){return this.cmds.push(["closePath",arguments]),this},fillStyle:function(){return this.cmds.push(["fillStyle",arguments]),this},fill:function(){return this.cmds.push(["fill",arguments]),this},strokeStyle:function(){return this.cmds.push(["strokeStyle",arguments]),this},lineWidth:function(){return this.cmds.push(["lineWidth",arguments]),this},stroke:function(){return this.cmds.push(["stroke",arguments]),this},moveTo:function(){return this.cmds.push(["moveTo",arguments]),this},lineTo:function(){return this.cmds.push(["lineTo",arguments]),this},bezierCurveTo:function(){return this.cmds.push(["bezierCurveTo",arguments]),this},clone:function(){}});i.RectAdjust=t.extend({ctor:function(n){this.min=n.min;this.max=n.max;this.value=n.value;this.change=n.change;this.renderTo=n.renderTo;this.fillStyle=n.fillStyle;this.canvas=document.createElement("canvas");this.canvas.width=140;this.canvas.height=16;this.canvas.style.cssText="border:1px solid black;";this.ctx=this.canvas.getContext("2d");this.renderTo.appendChild(this.canvas);this.render(160*(this.value-this.min)/(this.max-this.min));this.offset=this.canvas.getBoundingClientRect();var t=this,i=!1;this.canvas.addEventListener("mousedown",function(n){i=!0;var r=n.pageX-t.offset.left,u=n.pageY-t.offset.top;t.value=t.min+(t.max-t.min)*r/140;t.value>t.max&&(t.value=t.max);t.value<t.min&&(t.value=t.min);t.change(t.value);t.render(r);n.preventDefault();n.stopPropagation()},!1);this.canvas.addEventListener("mousemove",function(n){if(i){var r=n.pageX-t.offset.left,u=n.pageY-t.offset.top;t.value=t.min+(t.max-t.min)*r/140;t.value>t.max&&(t.value=t.max);t.value<t.min&&(t.value=t.min);t.change(t.value);t.render(r);n.preventDefault();n.stopPropagation()}},!1);document.addEventListener("mouseup",function(){i=!1},!1)},render:function(n){this.ctx.fillStyle=this.fillStyle;this.ctx.clearRect(0,0,500,500);this.ctx.beginPath();this.ctx.fillRect(0,0,n,60)}});i.Text=i.DisplayObject.extend({ctor:function(n){this._super();this.txt=n.txt;this.fontSize=n.fontSize;this.fontFamily=n.fontFamily;this.color=n.color;this.textAlign="center";this.textBaseline="top";this.maxWidth=n.maxWidth||2e3;this.square=n.square||!1;this.txtCanvas=document.createElement("canvas");this.txtCtx=this.txtCanvas.getContext("2d");var t=this.getDrawOption({txt:this.txt,maxWidth:this.maxWidth,square:this.square,size:this.fontSize,alignment:this.textAlign,color:this.color||"black",fontFamily:this.fontFamily});this.cacheID=i.UID.getCacheID();this.width=t.calculatedWidth;this.height=t.calculatedHeight},getDrawOption:function(n){var l=this.txtCanvas,t=this.txtCtx,i,r,e,h,u=[],c=n.txt,o=n.maxWidth,p=n.square,s=n.size,a=n.alignment,w=n.color,v=n.fontFamily,b=n.backgroundColour,y,f;t.font=s+"px "+v;o&&this.measureText(t,c)>o?(o=this.createMultilineText(t,c,o,u),i=this.getPowerOfTwo(o)):(u.push(c),i=this.getPowerOfTwo(t.measureText(c).width));r=this.getPowerOfTwo(s*(u.length+1));p&&(i>r?r=i:i=r);n.calculatedWidth=i;n.calculatedHeight=r;l.width=i;l.height=r;switch(a){case"left":e=0;break;case"center":e=i/2;break;case"right":e=i}for(h=r/2,t.fillStyle=w,t.textAlign=a,t.textBaseline="middle",t.font=s+"px "+v,y=(r-s*(u.length+1))*.5,n.cmd=[],f=0;f<u.length;f++)u.length>1&&(h=(f+1)*s+y),n.cmd.push({text:u[f],x:e,y:h}),t.fillText(u[f],e,h);return n},getPowerOfTwo:function(n,t){for(var t=t||1;t<n;)t*=2;return t},measureText:function(n,t){return n.measureText(t).width},createMultilineText:function(n,t,i,r){var a,u;t=t.replace("\n"," ");for(var f=t,e,h=0,s=0,c=t.split(" "),l,o=l=c.length;this.measureText(n,f)>i&&o>1;)for(o--,a=!1,f=e="",u=0;u<l;u++)u<o?(f+=c[u],u+1<o&&(f+=" ")):(e+=c[u],u+1<l&&(e+=" "));return r.push(f),s=this.measureText(n,f),e&&(h=this.createMultilineText(n,e,i,r),h>s&&(s=h)),s},draw:function(n){n.fillStyle=this.color;n.font=this.font;n.textAlign=this.textAlign||"left";n.textBaseline=this.textBaseline||"top";n.fillText(this.text,0,0)},clone:function(){var n=new i.Text(this.text,this.font,this.color);return this.cloneProps(n),n}});i.Dom=t.extend({statics:{get:function(n){return this.element=document.querySelector(n),this},on:function(n,t){return this.element.addEventListener(n,t,!1),this}}});i.Stage=i.Container.extend({ctor:function(n,t){this._super();this.canvas=typeof n=="string"?document.querySelector(n):n;this.width=this.canvas.width;this.height=this.canvas.height;this.AABB=[0,0,this.width,this.height];this.hitAABB=!1;this.hitRenderer=new i.CanvasRenderer;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.stageRenderer=new i.Renderer(this,t);this.hitCtx=this.hitCanvas.getContext("2d");this._scaleX=this._scaleY=null;this.offset=this._getXY(this.canvas);this.overObj=null;this.pause=!1;this.fps=63;this.interval=Math.floor(1e3/this.fps);var r=this;r.loop=setInterval(function(){r.pause||r._tick(r)},r.interval);Object.defineProperty(this,"useRequestAnimFrame",{set:function(n){this._useRequestAnimFrame=n;n?(clearInterval(r.loop),r.loop=i.RAF.requestInterval(function(){r._tick(r)},r.interval)):(i.RAF.clearRequestInterval(r.loop),r.loop=setInterval(function(){r._tick(r)},r.interval))},get:function(){return this._useRequestAnimFrame}});this._watch(this,"fps",function(n,t){this.interval=Math.floor(1e3/t);var r=this;if(this.useRequestAnimFrame){clearInterval(this.loop);try{i.RAF.clearRequestInterval(this.loop)}catch(u){}this.loop=i.RAF.requestInterval(function(){r._tick(r)},this.interval)}else{i.RAF.clearRequestInterval(this.loop);try{clearInterval(this.loop)}catch(u){}this.loop=setInterval(function(){r._tick(r)},this.interval)}});this._initDomSurface();this._initDebug();this._pressmoveObjs=null;this.baseInstanceof="Stage";this.overObj=null;this._moveInterval=16;this._preMoveTime=new Date;this._currentMoveTime=new Date;Object.defineProperty(this,"moveFPS",{set:function(n){this._moveFPS=n;this._moveInterval=1e3/n},get:function(){return this._moveFPS}});this.canvas.addEventListener("mousemove",this._handleMouseMove.bind(this),!1);this.canvas.addEventListener("click",this._handleClick.bind(this),!1);this.canvas.addEventListener("mousedown",this._handleMouseDown.bind(this),!1);this.canvas.addEventListener("mouseup",this._handleMouseUp.bind(this),!1);this.canvas.addEventListener("dblclick",this._handleDblClick.bind(this),!1);this.addEvent(this.canvas,"mousewheel",this._handleMouseWheel.bind(this));this.canvas.addEventListener("touchmove",this._handleMouseMove.bind(this),!1);this.canvas.addEventListener("touchstart",this._handleMouseDown.bind(this),!1);this.canvas.addEventListener("touchend",this._handleMouseUp.bind(this),!1);window.addEventListener("load",this._initDomSurface.bind(this),!1)},_initDebug:function(){this.debugDiv=document.createElement("div");this.debugDiv.style.cssText="display:none;position:absolute;z-index:2000;left:0;top:0;background-color:yellow;font-size:16px;";document.body.appendChild(this.debugDiv);Object.defineProperty(this,"debug",{set:function(n){this._debug=n;this.debugDiv.style.display=this._debug?"block":"none"},get:function(){return this._debug}})},_handleMouseWheel:function(n){var i=this.events.mousewheel,t,r,u;if(i)for(t=0,r=i.length;t<r;t++)u=i[t],u(n);n.preventDefault()},_initDomSurface:function(){var t=this,n;this.domSurface=document.createElement("div");n=this.domSurface.style;n.width=this.width+"px";n.height=this.height+"px";n.backgroundColor="rgba(255,255,255,0)";n.zIndex=1003;n.position="absolute";n.border="0px solid red";n.left=this.offset[0]+"px";n.top=this.offset[1]+"px";document.body.appendChild(this.domSurface);i.Stage.domSurface=this.domSurface;this.domSurface.addEventListener("mousemove",this._handleMouseMove.bind(this),!1);this.domSurface.addEventListener("click",this._handleClick.bind(this),!1);this.domSurface.addEventListener("mousedown",this._handleMouseDown.bind(this),!1);this.domSurface.addEventListener("mouseup",this._handleMouseUp.bind(this),!1);this.domSurface.addEventListener("dblclick",this._handleDblClick.bind(this),!1);this.addEvent(this.domSurface,"mousewheel",this._handleMouseWheel.bind(this));this.domSurface.addEventListener("touchmove",this._handleMouseMove.bind(this),!1);this.domSurface.addEventListener("touchstart",this._handleMouseDown.bind(this),!1);this.domSurface.addEventListener("touchend",this._handleMouseUp.bind(this),!1);window.addEventListener("resize",function(){t.offset=t._getXY(t.canvas);n.left=t.offset[0]+"px";n.top=t.offset[1]+"px";t._scaleX&&t.scaleToScreen(t._scaleX,t._scaleY)},!1)},update:function(){this.stageRenderer.update()},_correctionEvent:function(n){var t,u,i,r,f,e;if(n.touches?(t=n.touches[0],t&&(n.stageX=t.pageX-this.offset[0],n.stageY=t.pageY-this.offset[1])):(n.stageX=n.pageX-this.offset[0],n.stageY=n.pageY-this.offset[1]),this._scaleX&&(u=this.correctingXY(n.stageX,n.stageY),n.stageX=Math.round(u.x),n.stageY=Math.round(u.y)),i=this.events[n.type],i)for(r=0,f=i.length;r<f;r++)e=i[r],e(n);n.preventDefault()},_handleClick:function(n){this._correctionEvent(n);this._getObjectUnderPoint(n.stageX,n.stageY,n.type)},_handleMouseMove:function(n){var i,t;this._correctionEvent(n);this._pressmoveObjs&&(i=this._pressmoveObjs.events.pressmove,i&&this._pressmoveObjs.execEvent("pressmove",n.stageX,n.stageY));this._currentMoveTime=new Date;this._currentMoveTime-this._preMoveTime>this._moveInterval/2&&(t=this._getObjectUnderPoint(n.stageX,n.stageY,"mousemove"),t?this.overObj?t.id!=this.overObj.id?(this.hitRenderer._bubbleEvent(this.overObj,"mouseout",n.stageX,n.stageY),this.hitRenderer._bubbleEvent(t,"mouseover",n.stageX,n.stageY),this.overObj=t):this.hitRenderer._bubbleEvent(t,"mousemove",n.stageX,n.stageY):(this.overObj=t,this.hitRenderer._bubbleEvent(t,"mouseover",n.stageX,n.stageY)):this.overObj&&(this.hitRenderer._bubbleEvent(this.overObj,"mouseout",n.stageX,n.stageY),this.overObj=null),this._preMoveTime=this._currentMoveTime)},_getPressmoveTarget:function(n){n.events.pressmove&&(this._pressmoveObjs=n);n.parent&&this._getPressmoveTarget(n.parent)},_handleMouseDown:function(n){this._correctionEvent(n);var t=this._getObjectUnderPoint(n.stageX,n.stageY,n.type);t&&(this._getPressmoveTarget(t),this._getObjectUnderPoint(n.stageX,n.stageY,n.type))},_handleMouseUp:function(n){this._pressmoveObjs=null;this._correctionEvent(n);this._getObjectUnderPoint(n.stageX,n.stageY,n.type)},_handleDblClick:function(n){this._correctionEvent(n);this._getObjectUnderPoint(n.stageX,n.stageY,"dblclick")},_getObjectUnderPoint:function(n,t,i){return this.hitAABB?this.hitRenderer.hitAABB(this.hitCtx,this,null,n,t,i):this.hitRenderer.hitRender(this.hitCtx,this,null,n,t,i)},_getXY:function(n){var t=0,i=0,r;if(document.documentElement.getBoundingClientRect&&n.getBoundingClientRect)r=n.getBoundingClientRect(),i=r.left,t=r.top;else{while(n.offsetParent)t+=n.offsetTop,i+=n.offsetLeft,n=n.offsetParent;return[i,t]}return[i+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),t+Math.max(document.documentElement.scrollTop,document.body.scrollTop)]},_tick:function(n){var u,f,r,t,i;for(n&&n.tick&&(this._initInterval(n),n.hasOwnProperty("_tickInterval")?(n._tickIntervalCurrent=new Date,n._tickIntervalLast||(n._tickIntervalLast=new Date),i=n._tickIntervalCurrent-n._tickIntervalLast,i*2>n._tickInterval&&(n.tick(),n._tickIntervalLast=n._tickIntervalCurrent)):n.tick()),u=n.children,f=u.length,r=0;r<f;r++)t=u[r],t&&(t.tick&&(this._initInterval(t),t.hasOwnProperty("_tickInterval")?(t._tickIntervalCurrent=new Date,t._tickIntervalLast||(t._tickIntervalLast=new Date),i=t._tickIntervalCurrent-t._tickIntervalLast,i*2>t._tickInterval&&(t.tick(),t._tickIntervalLast=t._tickIntervalCurrent)):t.tick()),t.baseInstanceof=="Container"&&this._tick(t))},_initInterval:function(n){n.hasOwnProperty("tickFPS")&&(n._tickInterval=n.tickFPS==0?1e4:1e3/n.tickFPS)},tick:function(){this.tickFn&&this.tickFn();this.update();this.debug&&(this.getFPS(),this.debugDiv.innerHTML="fps : "+this.fpsValue+" <br/>average fps : "+this.averageFPS+" <br/>object count : "+this.getTotalCount()+" <br/>rendering mode : "+this.getRenderingMode()+" <br/>inner object count  : "+this.stageRenderer.objs.length)},onTick:function(n){this.tickFn=n},setFPS:function(n){this.interval=Math.floor(1e3/n)},onKeyboard:function(n,t,r){i.Keyboard.on(n,t,r)},getActiveKeys:function(){return i.Keyboard.getActiveKeys()},scaleToScreen:function(n,t){var r,i;n===1&&t===1&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden");document.body.style.margin=0;document.documentElement.style.margin=0;document.body.style.border=0;document.documentElement.style.border=0;document.body.style.padding=0;document.documentElement.style.padding=0;document.body.style.width="100%";document.documentElement.style.width="100%";document.body.style.height="100%";document.documentElement.style.height="100%";this._scaleX=n;this._scaleY=t;r=this.canvas;r.style.position="absolute";r.style.width=n*100+"%";r.style.height=t*100+"%";r.style.left=50*(1-n)+"%";r.style.top=50*(1-t)+"%";r.style.border="0px solid #ccc";i=this.domSurface;i.style.position="absolute";i.style.border="0px solid #ccc";i.style.transform=i.style.msTransform=i.style.OTransform=i.style.MozTransform=i.style.webkitTransform="scale("+window.innerWidth*this._scaleX/this.width+","+window.innerHeight*this._scaleY/this.height+")";this.offset=this._getXY(this.canvas);this.offset2=this._getXY(i);i.style.left=parseInt(i.style.left)-this.offset2[0]+this.offset[0]+"px";i.style.top=parseInt(i.style.top)-this.offset2[1]+this.offset[1]+"px"},correctingXY:function(n,t){return{x:n*this.width/(window.innerWidth*this._scaleX),y:t*this.height/(window.innerHeight*this._scaleY)}},getTotalCount:function(){function t(r){var u,e,f;if(r.baseInstanceof=="Container"||r.baseInstanceof=="Stage")for(u=0,e=r.children.length;u<e;u++)f=r.children[u],f instanceof i.Container?t(f):n++;else n++}var n=0,r=this;return t(this),n},getRenderingMode:function(){return this.stageRenderer.renderingEngine instanceof i.CanvasRenderer?"Canvas":"WebGL"},getFPS:function(){var n=i.FPS.get();this.fpsValue=n.value;this.averageFPS=n.averageFPS},addEvent:function(n,t,i,r){t==="mousewheel"&&document.mozHidden!==undefined&&(t="DOMMouseScroll");n.addEventListener(t,function(n){var t=n.type;(t=="DOMMouseScroll"||t=="mousewheel")&&(n.delta=n.wheelDelta?n.wheelDelta/120:-(n.detail||0)/3);i.call(this,n)},r||!1)},setCursor:function(n){this.canvas.style.cursor=n;this.domSurface.style.cursor=n}});i.CanvasRenderer=t.extend({ctor:function(n){n&&(this.canvas=n,this.ctx=this.canvas.getContext("2d"),this.height=this.canvas.width,this.width=this.canvas.height)},hitAABB:function(n,t,i,r,u,f){for(var o,s,h=t.children.slice(0),c=h.length,e=c-1;e>=0;e--)if((o=h[e],this.isbindingEvent(o))&&(s=this._hitAABB(n,o,i,r,u,f),s))return s},_hitAABB:function(n,t,r,u,f,e){var s,c,o,l,h;if(t.isVisible())if(t instanceof i.Container){for(s=t.children.slice(0),c=s.length,o=c-1;o>=0;o--)if(l=s[o],h=this._hitAABB(n,l,r,u,f,e),h)return h}else if(this.checkPointInAABB(u,f,t.AABB))return this._bubbleEvent(t,e,u,f),t},hitRender:function(n,t,i,r,u,f){var o,c,e,s,h;for(i?t._hitMatrix.initialize(i.a,i.b,i.c,i.d,i.tx,i.ty):t._hitMatrix.initialize(1,0,0,1,0,0),i=t._hitMatrix,i.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY),o=t.children.slice(0),c=o.length,e=c-1;e>=0;e--)if((s=o[e],i.initialize(1,0,0,1,0,0),i.appendTransform(t.x-r,t.y-u,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY),this.isbindingEvent(s))&&(n.save(),h=this._hitRender(n,s,i,r,u,f),n.restore(),h))return h},_hitRender:function(n,t,r,u,f,e){var h,c,a,s,l,o;if(n.clearRect(0,0,2,2),t.isVisible()){if(r?t._hitMatrix.initialize(r.a,r.b,r.c,r.d,r.tx,r.ty):t._hitMatrix.initialize(1,0,0,1,0,0),r=t._hitMatrix,t instanceof i.Shape?r.appendTransform(t.x,t.y,1,1,t.rotation,t.skewX,t.skewY,t.regX,t.regY):r.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY),h=t.cacheCanvas||t.txtCanvas||t.shapeCanvas,h)n.globalAlpha=t.complexAlpha,n.globalCompositeOperation=t.complexCompositeOperation,n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),n.drawImage(h,0,0);else if(t instanceof i.Container)for(c=t.children.slice(0),a=c.length,s=a-1;s>=0;s--){if(n.save(),l=this._hitRender(n,c[s],r,u,f,e),l)return l;n.restore()}else(t instanceof i.Bitmap||t instanceof i.Sprite)&&(n.globalAlpha=t.complexAlpha,n.globalCompositeOperation=t.complexCompositeOperation,o=t.rect,n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),n.drawImage(t.img,o[0],o[1],o[2],o[3],0,0,o[2],o[3]));if(n.getImageData(0,0,1,1).data[3]>1&&!(t instanceof i.Container))return this._bubbleEvent(t,e,u,f),t}},_bubbleEvent:function(n,t,i,r){var u=n.execEvent(t,i,r);u!==!1&&n.parent&&n.parent.events[t]&&n.parent.events[t].length>0&&n.parent.baseInstanceof!=="Stage"&&this._bubbleEvent(n.parent,t,i,r)},isbindingEvent:function(n){var t,u,r;if(Object.keys(n.events).length!==0)return!0;if(n instanceof i.Container)for(t=0,u=n.children.length;t<u;t++){if(r=n.children[t],r instanceof i.Container)return this.isbindingEvent(r);if(Object.keys(r.events).length!==0)return!0}return!1},clear:function(){this.ctx.clearRect(0,0,this.height,this.width)},renderObj:function(n,t){var r=t._matrix,f,u;n.save();n.globalAlpha=t.complexAlpha;n.globalCompositeOperation=t.complexCompositeOperation;f=t.cacheCanvas||t.txtCanvas||t.shapeCanvas;f?(n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),n.drawImage(f,0,0)):(t instanceof i.Bitmap||t instanceof i.Sprite)&&(u=t.rect,n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),n.drawImage(t.img,u[0],u[1],u[2],u[3],0,0,u[2],u[3]));n.restore()},clearBackUpCanvasCache:function(){},checkPointInAABB:function(n,t,i){var u=i[0],r,f,e;return n<u?!1:(r=i[1],t<r)?!1:(f=u+i[2],n>f)?!1:(e=r+i[3],t>e)?!1:!0}});i.Loader=t.extend({ctor:function(){this.audios={};this.res={};this.loadedCount=0;this.resCount=-1;this.FILE_PATTERN=/(\w+:\/{2})?((?:\w+\.){2}\w+)?(\/?[\S]+\/|\/)?([\w\-%\.]+)(?:\.)(\w+)?(\?\S+)?/i;this.ns=3;this.sounds=[];for(var n=0;n<this.ns;n++)this.sounds.push([]);this.playing=[];this.soundsCount=0},get:function(n){return this.res[n]},loadRes:function(n){this.resCount=n.length;for(var t=0;t<n.length;t++)this._getTypeByExtension(n[t].src.match(this.FILE_PATTERN)[5])=="audio"?this.loadAudio(n[t].id,n[t].src):this.loadImage(n[t].id,n[t].src)},loadImage:function(n,t){var i=document.createElement("img"),r=this;i.onload=function(){r._handleLoad(this,n);i.onreadystatechange=null};i.onreadystatechange=function(){(i.readyState=="loaded"||i.readyState=="complete")&&(r._handleLoad(this,n),i.onload=null)};i.onerror=function(){};i.src=t},loadAudio:function(n,t){var i=document.createElement("audio"),r,u;i.autoplay=!1;this.res[n]=i;i.src=null;i.preload="auto";i.onerror=function(){};i.onstalled=function(){};r=this;u=function(){r.playing[n]=0;for(var i=0;i<r.ns;i++)r.sounds[i][n]=new Audio(t);r.loadedCount++;r.handleProgress(r.loadedCount,r.resCount);r._clean(this);this.removeEventListener&&this.removeEventListener("canplaythrough",u,!1);r.checkComplete()};i.addEventListener("canplaythrough",u,!1);i.src=t;i.load!=null&&i.load()},checkComplete:function(){this.loadedCount===this.resCount&&this.handleComplete()},complete:function(n){this.handleComplete=n},progress:function(n){this.handleProgress=n},playSound:function(n){this.sounds[this.playing[n]][n].play();++this.playing[n];this.playing[n]>=this.ns&&(this.playing[n]=0)},_handleLoad:function(n,t){this._clean(n);this.res[t]=n;this.loadedCount++;this.handleProgress&&this.handleProgress(this.loadedCount,this.resCount);this.checkComplete()},_getTypeByExtension:function(n){switch(n){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return"img";case"ogg":case"mp3":case"wav":return"audio"}},_clean:function(n){n.onload=null;n.onstalled=null;n.onprogress=null;n.onerror=null}});i.Matrix2D=t.extend({statics:{DEG_TO_RAD:.017453292519943295},ctor:function(n,t,i,r,u,f){return this.a=n==null?1:n,this.b=t||0,this.c=i||0,this.d=r==null?1:r,this.tx=u||0,this.ty=f||0,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},appendTransform:function(n,t,r,u,f,e,o,s,h){if(f%360)var a=f*i.Matrix2D.DEG_TO_RAD,c=Math.cos(a),l=Math.sin(a);else c=1,l=0;return e||o?(e*=i.Matrix2D.DEG_TO_RAD,o*=i.Matrix2D.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(e),Math.cos(e),n,t),this.append(c*r,l*r,-l*u,c*u,0,0)):this.append(c*r,l*r,-l*u,c*u,n,t),(s||h)&&(this.tx-=s*this.a+h*this.c,this.ty-=s*this.b+h*this.d),this},append:function(n,t,i,r,u,f){var e=this.a,o=this.b,s=this.c,h=this.d;return this.a=n*e+t*s,this.b=n*o+t*h,this.c=i*e+r*s,this.d=i*o+r*h,this.tx=u*e+f*s+this.tx,this.ty=u*o+f*h+this.ty,this},initialize:function(n,t,i,r,u,f){return this.a=n,this.b=t,this.c=i,this.d=r,this.tx=u,this.ty=f,this},setValues:function(n,t,i,r,u,f){return this.a=n==null?1:n,this.b=t||0,this.c=i||0,this.d=r==null?1:r,this.tx=u||0,this.ty=f||0,this},copy:function(n){return this.setValues(n.a,n.b,n.c,n.d,n.tx,n.ty)}});i.RAF=t.extend({statics:{ctor:function(){var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}(),t=function(t,i){function f(){var e=(new Date).getTime(),o=e-u;o>=i&&(t.call(),u=(new Date).getTime());r.value=n(f)}if(!window.requestAnimationFrame&&!window.webkitRequestAnimationFrame&&!(window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame)&&!window.oRequestAnimationFrame&&!window.msRequestAnimationFrame)return window.setInterval(t,i);var u=(new Date).getTime(),r={};return r.value=n(f),r},i=function(n){n&&setTimeout(function(){window.cancelAnimationFrame?window.cancelAnimationFrame(n.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(n.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(n.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(n.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(n.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(n.value):clearInterval(n)},0)};this.requestInterval=t;this.clearRequestInterval=i}}});i.Observable=t.extend({statics:{ctor:function(){this.methods=["concat","every","filter","forEach","indexOf","join","lastIndexOf","map","pop","push","reduce","reduceRight","reverse","shift","slice","some","sort","splice","unshift","valueOf"];this.triggerStr="concat,pop,push,reverse,shift,sort,splice,unshift"},type:function(n){var t=Object.prototype.toString.call(n).split(" ")[1];return t.substr(0,t.length-1).toLowerCase()},isArray:function(n){return this.type(n)=="array"},isInArray:function(n,t){for(var i=n.length;--i>-1;)if(t===n[i])return!0;return!1},isFunction:function(n){return this.type(n)=="function"},watch:function(n,t){return new this(n,t)}},ctor:function(n,t){var r,u;for(r in n)n.hasOwnProperty(r)&&(t&&i.Observable.isInArray(t,r)||!t)&&this.watch(n,r);if(n.change)throw"naming conflicts！observable will extend 'change' method to your object .";u=this;n.change=function(n){u.propertyChangedHandler=n}},onPropertyChanged:function(n,t){this.propertyChangedHandler&&this.propertyChangedHandler(n,t)},mock:function(n){var t=this;i.Observable.methods.forEach(function(r){n[r]=function(){var u=Array.prototype[r].apply(this,Array.prototype.slice.call(arguments));for(var n in this)this.hasOwnProperty(n)&&n!="_super"&&!i.Observable.isFunction(this[n])&&t.watch(this,n);if(new RegExp("\\b"+r+"\\b").test(i.Observable.triggerStr))t.onPropertyChanged("array",r);return u}})},watch:function(n,t){var f,r,u;if(t.substr(0,2)!="__"&&(f=this,!i.Observable.isFunction(n[t]))&&(r=n["__"+t]=n[t],Object.defineProperty(n,t,{get:function(){return this["__"+t]},set:function(n){this["__"+t]=n;f.onPropertyChanged(t,n)}}),i.Observable.isArray(n)&&this.mock(n),typeof r=="object")){i.Observable.isArray(r)&&this.mock(r);for(u in r)r.hasOwnProperty(u)&&u!="_super"&&this.watch(r,u)}}});i.To=t.extend({statics:{ctor:function(){var n=this;setTimeout(function(){n.bounceOut=i.TWEEN.Easing.Bounce.Out;n.linear=i.TWEEN.Easing.Linear.None;n.quadraticIn=i.TWEEN.Easing.Quadratic.In;n.quadraticOut=i.TWEEN.Easing.Quadratic.Out;n.quadraticInOut=i.TWEEN.Easing.Quadratic.InOut;n.cubicIn=i.TWEEN.Easing.Cubic.In;n.cubicOut=i.TWEEN.Easing.Cubic.Out;n.cubicInOut=i.TWEEN.Easing.Cubic.InOut;n.quarticIn=i.TWEEN.Easing.Quartic.In;n.quarticOut=i.TWEEN.Easing.Quartic.Out;n.quarticInOut=i.TWEEN.Easing.Quartic.InOut;n.quinticIn=i.TWEEN.Easing.Quintic.In;n.quinticOut=i.TWEEN.Easing.Quintic.Out;n.quinticInOut=i.TWEEN.Easing.Quintic.InOut;n.sinusoidalIn=i.TWEEN.Easing.Sinusoidal.In;n.sinusoidalOut=i.TWEEN.Easing.Sinusoidal.Out;n.sinusoidalInOut=i.TWEEN.Easing.Sinusoidal.InOut;n.exponentialIn=i.TWEEN.Easing.Exponential.In;n.exponentialOut=i.TWEEN.Easing.Exponential.Out;n.exponentialInOut=i.TWEEN.Easing.Exponential.InOut;n.circularIn=i.TWEEN.Easing.Circular.In;n.circularOut=i.TWEEN.Easing.Circular.Out;n.circularInOut=i.TWEEN.Easing.Circular.InOut;n.elasticIn=i.TWEEN.Easing.Elastic.In;n.elasticOut=i.TWEEN.Easing.Elastic.Out;n.elasticInOut=i.TWEEN.Easing.Elastic.InOut;n.backIn=i.TWEEN.Easing.Back.In;n.backOut=i.TWEEN.Easing.Back.Out;n.backInOut=i.TWEEN.Easing.Back.InOut;n.bounceIn=i.TWEEN.Easing.Bounce.In;n.bounceOut=i.TWEEN.Easing.Bounce.Out;n.bounceInOut=i.TWEEN.Easing.Bounce.InOut;n.interpolationLinear=i.TWEEN.Interpolation.Linear;n.interpolationBezier=i.TWEEN.Interpolation.Bezier;n.interpolationCatmullRom=i.TWEEN.Interpolation.CatmullRom},0)},get:function(n){return new this(n)}},ctor:function(n){this.element=n;this.cmds=[];this.index=0;this.loop=setInterval(function(){i.TWEEN.update()},15);this.cycleCount=0},to:function(){return this.cmds.push(["to"]),this},set:function(n,t,i,r){return this.cmds[this.cmds.length-1].push([n,[t,i,r]]),this},x:function(){return this.cmds[this.cmds.length-1].push(["x",arguments]),this},y:function(){return this.cmds[this.cmds.length-1].push(["y",arguments]),this},z:function(){return this.cmds[this.cmds.length-1].push(["z",arguments]),this},rotation:function(){return this.cmds[this.cmds.length-1].push(["rotation",arguments]),this},scaleX:function(){return this.cmds[this.cmds.length-1].push(["scaleX",arguments]),this},scaleY:function(){return this.cmds[this.cmds.length-1].push(["scaleY",arguments]),this},skewX:function(){return this.cmds[this.cmds.length-1].push(["skewX",arguments]),this},skewY:function(){return this.cmds[this.cmds.length-1].push(["skewY",arguments]),this},originX:function(){return this.cmds[this.cmds.length-1].push(["originX",arguments]),this},originY:function(){return this.cmds[this.cmds.length-1].push(["originY",arguments]),this},alpha:function(){return this.cmds[this.cmds.length-1].push(["alpha",arguments]),this},begin:function(n){return this.cmds[this.cmds.length-1].begin=n,this},progress:function(n){return this.cmds[this.cmds.length-1].progress=n,this},end:function(n){return this.cmds[this.cmds.length-1].end=n,this},wait:function(){return this.cmds.push(["wait",arguments]),this},then:function(){return this.cmds.push(["then",arguments]),this},cycle:function(){return this.cmds.push(["cycle",arguments]),this},shake:function(){return this.cmds=this.cmds.concat([["to",["x",{"0":10,"1":50}]],["to",["x",{"0":-10,"1":50}]],["to",["x",{"0":10,"1":50}]],["to",["x",{"0":-10,"1":50}]],["to",["x",{"0":10,"1":50}]],["to",["x",{"0":-10,"1":50}]],["to",["x",{"0":10,"1":50}]],["to",["x",{"0":-10,"1":50}]],["to",["x",{"0":10,"1":50}]],["to",["x",{"0":-10,"1":50}]],["to",["x",{"0":10,"1":50}]],["to",["x",{"0":0,"1":50}]]]),this},rubber:function(){return this.cmds=this.cmds.concat([["to",["scaleX",{"0":1.25,"1":300}],["scaleY",{"0":.75,"1":300}]],["to",["scaleX",{"0":.75,"1":100}],["scaleY",{"0":1.25,"1":100}]],["to",["scaleX",{"0":1.15,"1":100}],["scaleY",{"0":.85,"1":100}]],["to",["scaleX",{"0":.95,"1":150}],["scaleY",{"0":1.05,"1":150}]],["to",["scaleX",{"0":1.05,"1":100}],["scaleY",{"0":.95,"1":100}]],["to",["scaleX",{"0":1,"1":250}],["scaleY",{"0":1,"1":250}]]]),this},bounceIn:function(){return this.cmds=this.cmds.concat([["to",["scaleX",{"0":0,"1":0}],["scaleY",{"0":0,"1":0}]],["to",["scaleX",{"0":1.35,"1":200}],["scaleY",{"0":1.35,"1":200}]],["to",["scaleX",{"0":.9,"1":100}],["scaleY",{"0":.9,"1":100}]],["to",["scaleX",{"0":1.1,"1":100}],["scaleY",{"0":1.1,"1":100}]],["to",["scaleX",{"0":.95,"1":100}],["scaleY",{"0":.95,"1":100}]],["to",["scaleX",{"0":1,"1":100}],["scaleY",{"0":1,"1":100}]]]),this},flipInX:function(){return this.cmds=this.cmds.concat([["to",["rotateX",{"0":-90,"1":0}]],["to",["rotateX",{"0":20,"1":300}]],["to",["rotateX",{"0":-20,"1":300}]],["to",["rotateX",{"0":10,"1":300}]],["to",["rotateX",{"0":-5,"1":300}]],["to",["rotateX",{"0":0,"1":300}]]]),this},zoomOut:function(){return this.cmds=this.cmds.concat([["to",["scaleX",{"0":0,"1":400}],["scaleY",{"0":0,"1":400}]]]),this},start:function(){var n=this.cmds.length;this.index<n?this.exec(this.cmds[this.index],this.index==n-1):clearInterval(this.loop)},exec:function(n,t){var h=n.length,r=this,u,a,e,s;switch(n[0]){case"to":for(r.stepCompleteCount=0,u=1;u<h;u++){var f=n[u],c=f[1][2],l={},o=f[0];l[o]=f[1][0];a=new i.TWEEN.Tween(this.element).to(l,f[1][1]).onStart(function(){n.start&&n.start()}).onUpdate(function(){n.progress&&n.progress.call(r.element);r.element[o]=this[o]}).easing(c?c:i.To.linear).onComplete(function(){r.stepCompleteCount++;r.stepCompleteCount==h-1&&(n.end&&n.end.call(r.element),t&&r.complete&&r.complete(),r.index++,r.start())}).start()}break;case"wait":setTimeout(function(){r.index++;r.start();t&&r.complete&&r.complete()},n[1][0]);break;case"then":e=n[1][0];e.index=0;e.complete=function(){r.index++;r.start();t&&r.complete&&r.complete()};e.start();break;case"cycle":s=n[1][1];s&&r.cycleCount==s?(r.index++,r.start(),t&&r.complete&&r.complete()):(r.cycleCount++,r.index=n[1][0],r.start())}}});i.Vector2=t.extend({ctor:function(n,t){this.x=n;this.y=t},copy:function(){return new i.Vector2(this.x,this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},sqrLength:function(){return this.x*this.x+this.y*this.y},normalize:function(){var n=1/this.length();return new i.Vector2(this.x*n,this.y*n)},negate:function(){return new i.Vector2(-this.x,-this.y)},add:function(n){this.x+=n.x;this.y+=n.y},subtract:function(n){return new i.Vector2(this.x-n.x,this.y-n.y)},multiply:function(n){return new i.Vector2(this.x*n,this.y*n)},divide:function(n){var t=1/n;return new i.Vector2(this.x*t,this.y*t)},dot:function(n){return this.x*n.x+this.y*n.y}});i.UID=t.extend({statics:{_nextID:0,_nextCacheID:1,get:function(){return this._nextID++},getCacheID:function(){return this._nextCacheID++}}});i.Renderer=t.extend({ctor:function(n){this.stage=n;this.objs=[];this.width=this.stage.width;this.height=this.stage.height;this.mainCanvas=this.stage.canvas;this.renderingEngine=new i.CanvasRenderer(this.stage.canvas);this.mainCtx=this.renderingEngine.ctx},update:function(){var t=this.objs,u=this.mainCtx,i=this.renderingEngine,r,n;for(t.length=0,this.computeMatrix(),i.clear(),r=t.length,n=0;n<r;n++)i.renderObj(u,t[n])},computeMatrix:function(){for(var n=0,t=this.stage.children.length;n<t;n++)this._computeMatrix(this.stage.children[n])},initComplex:function(n){n.complexCompositeOperation=this._getCompositeOperation(n);n.complexAlpha=this._getAlpha(n,1)},_computeMatrix:function(n,t){if(n.isVisible())if(t?n._matrix.initialize(t.a,t.b,t.c,t.d,t.tx,t.ty):n._matrix.initialize(1,0,0,1,0,0),n instanceof i.Shape?n._matrix.appendTransform(n.x,n.y,1,1,n.rotation,n.skewX,n.skewY,n.regX,n.regY):n._matrix.appendTransform(n.x,n.y,n.scaleX,n.scaleY,n.rotation,n.skewX,n.skewY,n.regX,n.regY),n instanceof i.Container)for(var u=n.children,f=u.length,r=0;r<f;r++)this._computeMatrix(u[r],n._matrix);else n.initAABB(),this.isInStage(n)&&(this.objs.push(n),this.initComplex(n))},_getCompositeOperation:function(n){return n.compositeOperation?n.compositeOperation:n.parent?this._getCompositeOperation(n.parent):void 0},_getAlpha:function(n,t){var i=n.alpha*t;return n.parent?this._getAlpha(n.parent,i):i},isInStage:function(n){return this.collisionBetweenAABB(n.AABB,this.stage.AABB)},collisionBetweenAABB:function(n,t){var u=n[0]+n[2],r,i;return u<t[0]?!1:(r=n[0],r>t[0]+t[2])?!1:(i=n[1]+n[3],i<t[1])?!1:(i=n[1],i>t[1]+t[3])?!1:!0}});i.TWEEN=t.extend({statics:{ctor:function(){Date.now===undefined&&(Date.now=function(){return(new Date).valueOf()});this._tweens=[]},REVISION:"14",getAll:function(){return this._tweens},removeAll:function(){this._tweens=[]},add:function(n){this._tweens.push(n)},remove:function(n){var t=this._tweens.indexOf(n);t!==-1&&this._tweens.splice(t,1)},update:function(n){if(this._tweens.length===0)return!1;var t=0;for(n=n!==undefined?n:typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();t<this._tweens.length;)this._tweens[t].update(n)?t++:this._tweens.splice(t,1);return!0},Tween:function(n){var r=n,u={},t={},f={},k=1e3,s=0,c=!1,l=!1,d=!1,a=0,e=null,g=i.TWEEN.Easing.Linear.None,nt=i.TWEEN.Interpolation.Linear,o=[],v=null,y=!1,p=null,w=null,b=null,h=!1,tt=null;for(var it in n)u[it]=parseFloat(n[it],10);this.togglePlayPause=function(){h?this.play():this.pause()};this.pause=function(){h=!0;var n=typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();tt=n-e};this.play=function(){h=!1;var n=typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();e=n-tt};this.to=function(n,i){return i!==undefined&&(k=i),t=n,this};this.start=function(n){i.TWEEN.add(this);l=!0;y=!1;e=(n!==undefined?n:typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now())+a;for(var o in t){if(t[o]instanceof Array){if(t[o].length===0)continue;t[o]=[r[o]].concat(t[o])}u[o]=r[o];u[o]instanceof Array==!1&&(u[o]*=1);f[o]=u[o]||0}return this};this.stop=function(){return l?(i.TWEEN.remove(this),l=!1,b!==null&&b.call(r),this.stopChainedTweens(),this):this};this.stopChainedTweens=function(){for(var n=0,t=o.length;n<t;n++)o[n].stop()};this.delay=function(n){return a=n,this};this.repeat=function(n){return s=n,this};this.yoyo=function(n){return c=n,this};this.easing=function(n){return g=n,this};this.interpolation=function(n){return nt=n,this};this.chain=function(){return o=arguments,this};this.onStart=function(n){return v=n,this};this.onUpdate=function(n){return p=n,this};this.onComplete=function(n){return w=n,this};this.onStop=function(n){return b=n,this};this.update=function(n){var i,b,tt,it,l,ut,rt,ft;if(h||n<e)return!0;y===!1&&(v!==null&&v.call(r),y=!0);b=(n-e)/k;b=b>1?1:b;tt=g(b);for(i in t)it=u[i]||0,l=t[i],l instanceof Array?r[i]=nt(l,tt):(typeof l=="string"&&(l=it+parseFloat(l,10)),typeof l=="number"&&(r[i]=it+(l-it)*tt));if(p!==null&&p.call(r,tt),b==1){if(s>0){isFinite(s)&&s--;for(i in f)typeof t[i]=="string"&&(f[i]=f[i]+parseFloat(t[i],10)),c&&(ut=f[i],f[i]=t[i],t[i]=ut),u[i]=f[i];return c&&(d=!d),e=n+a,!0}for(w!==null&&w.call(r),rt=0,ft=o.length;rt<ft;rt++)o[rt].start(n);return!1}return!0}},Easing:{Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return 1-Math.cos(n*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return.5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)))},Out:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin((n-i)*2*Math.PI/r)+1)},InOut:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),(n*=2)<1)?-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r):t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)*.5+1}},Back:{In:function(n){var t=1.70158;return n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},InOut:function(n){var t=1.70158*1.525;return(n*=2)<1?.5*n*n*((t+1)*n-t):.5*((n-=2)*n*((t+1)*n+t)+2)}},Bounce:{In:function(n){return 1-i.TWEEN.Easing.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?i.TWEEN.Easing.Bounce.In(n*2)*.5:i.TWEEN.Easing.Bounce.Out(n*2-1)*.5+.5}}},Interpolation:{Linear:function(n,t){var r=n.length-1,u=r*t,f=Math.floor(u),e=i.TWEEN.Interpolation.Utils.Linear;return t<0?e(n[0],n[1],u):t>1?e(n[r],n[r-1],r-u):e(n[f],n[f+1>r?r:f+1],u-f)},Bezier:function(n,t){for(var f=0,u=n.length-1,e=Math.pow,o=i.TWEEN.Interpolation.Utils.Bernstein,r=0;r<=u;r++)f+=e(1-t,u-r)*e(t,r)*n[r]*o(u,r);return f},CatmullRom:function(n,t){var r=n.length-1,f=r*t,u=Math.floor(f),e=i.TWEEN.Interpolation.Utils.CatmullRom;return n[0]===n[r]?(t<0&&(u=Math.floor(f=r*(1+t))),e(n[(u-1+r)%r],n[u],n[(u+1)%r],n[(u+2)%r],f-u)):t<0?n[0]-(e(n[0],n[0],n[1],n[1],-f)-n[0]):t>1?n[r]-(e(n[r],n[r],n[r-1],n[r-1],f-r)-n[r]):e(n[u?u-1:0],n[u],n[r<u+1?r:u+1],n[r<u+2?r:u+2],f-u)},Utils:{Linear:function(n,t,i){return(t-n)*i+n},Bernstein:function(n,t){var r=i.TWEEN.Interpolation.Utils.getFactorial();return r(n)/r(t)/r(n-t)},getFactorial:function(){return function(){var n=[1];return function(t){var r=1,i;if(n[t])return n[t];for(i=t;i>1;i--)r*=i;return n[t]=r}}()},CatmullRom:function(n,t,i,r,u){var f=(i-n)*.5,e=(r-t)*.5,o=u*u,s=u*o;return(2*t-2*i+f+e)*s+(-3*t+3*i-2*f-e)*o+f*u+t}}}}});i.Util=t.extend({statics:{random:function(n,t){return n+Math.floor(Math.random()*(t-n+1))}}});i.Keyboard=t.extend({statics:{ctor:function(){function g(){window.addEventListener?(window.document.addEventListener("keydown",v,!1),window.document.addEventListener("keyup",y,!1),window.addEventListener("blur",u,!1),window.addEventListener("webkitfullscreenchange",u,!1),window.addEventListener("mozfullscreenchange",u,!1)):window.attachEvent&&(window.document.attachEvent("onkeydown",v),window.document.attachEvent("onkeyup",y),window.attachEvent("onblur",u))}function st(){u();window.removeEventListener?(window.document.removeEventListener("keydown",v,!1),window.document.removeEventListener("keyup",y,!1),window.removeEventListener("blur",u,!1),window.removeEventListener("webkitfullscreenchange",u,!1),window.removeEventListener("mozfullscreenchange",u,!1)):window.detachEvent&&(window.document.detachEvent("onkeydown",v),window.document.detachEvent("onkeyup",y),window.detachEvent("onblur",u))}function u(n){r=[];tt();it(n)}function v(n){var t,r,i;if(t=b(n.keyCode),!(t.length<1)){for(n.isRepeat=!1,i=0;i<t.length;i+=1)r=t[i],p().indexOf(r)!=-1&&(n.isRepeat=!0),k(r);lt();pt(n)}}function y(n){var t,i;if(t=b(n.keyCode),!(t.length<1)){for(i=0;i<t.length;i+=1)w(t[i]);tt();it(n)}}function b(n){return s[n]||[]}function nt(n){for(var t in s)if(s.hasOwnProperty(t)&&s[t].indexOf(n)>-1)return t;return!1}function ht(n,t){if(typeof n!="string"&&(typeof n!="object"||typeof n.push!="function"))throw new Error("Cannot create macro. The combo must be a string or array.");if(typeof t!="object"||typeof t.push!="function")throw new Error("Cannot create macro. The injectedKeys must be an array.");i.push([n,t])}function ct(n){var r,t;if(typeof n!="string"&&(typeof n!="object"||typeof n.push!="function"))throw new Error("Cannot remove macro. The combo must be a string or array.");for(t=0;t<i.length;t+=1)if(r=i[t],rt(n,r[0])){w(r[1]);i.splice(t,1);break}}function lt(){for(var r,t,n=0;n<i.length;n+=1)if(r=e(i[n][0]),o.indexOf(i[n])===-1&&h(r))for(o.push(i[n]),t=0;t<i[n][1].length;t+=1)k(i[n][1][t])}function tt(){for(var i,t,n=0;n<o.length;n+=1)if(i=e(o[n][0]),h(i)===!1){for(t=0;t<o[n][1].length;t+=1)w(o[n][1][t]);o.splice(n,1);n-=1}}function at(n,i,r){function c(){for(var n=0;n<u.length;n+=1)t.splice(t.indexOf(u[n]),1)}function l(n){function e(){for(var i,r=0;r<t.length;r+=1)if(typeof t[r]=="function")if(n==="keyup")for(i=0;i<u.length;i+=1)u[i].keyUpCallback.splice(u[i].keyUpCallback.indexOf(t[r]),1);else for(i=0;i<u.length;i+=1)u[i].keyDownCallback.splice(u[i].keyDownCallback.indexOf(t[r]),1)}var f={},t,r,i;if(typeof n!="string")throw new Error("Cannot bind callback. The event name must be a string.");if(n!=="keyup"&&n!=="keydown")throw new Error('Cannot bind callback. The event name must be a "keyup" or "keydown".');for(t=Array.prototype.slice.apply(arguments,[1]),r=0;r<t.length;r+=1)if(typeof t[r]=="function")if(n==="keyup")for(i=0;i<u.length;i+=1)u[i].keyUpCallback.push(t[r]);else if(n==="keydown")for(i=0;i<u.length;i+=1)u[i].keyDownCallback.push(t[r]);return f.clear=e,f}var s={},f,u=[],o,h;for(typeof n=="string"&&(n=e(n)),o=0;o<n.length;o+=1){if(f={},h=ft([n[o]]),typeof h!="string")throw new Error("Failed to bind key combo. The key combo must be string.");f.keyCombo=h;f.keyDownCallback=[];f.keyUpCallback=[];i&&f.keyDownCallback.push(i);r&&f.keyUpCallback.push(r);t.push(f);u.push(f)}return s.clear=c,s.on=l,s}function vt(n){for(var r,i=0;i<t.length;i+=1)r=t[i],rt(n,r.keyCombo)&&(t.splice(i,1),i-=1)}function yt(n){var i,r,u;if(n){for(i=0;i<t.length;i+=1)for(u=t[i],r=0;r<u.keyCombo.length;r+=1)if(u.keyCombo[r].indexOf(n)>-1){t.splice(i,1);i-=1;break}}else t=[]}function pt(n){for(var o,f,s,a,b,u,y,w,e=[],v,c=[].concat(r),i=0;i<t.length;i+=1)v=ut(t[i].keyCombo).length,e[v]||(e[v]=[]),e[v].push(t[i]);for(o=e.length-1;o>=0;o-=1)if(e[o])for(i=0;i<e[o].length;i+=1){for(f=e[o][i],s=ut(f.keyCombo),y=!0,u=0;u<s.length;u+=1)if(c.indexOf(s[u])===-1){y=!1;break}if(y&&h(f.keyCombo)){for(l.push(f),u=0;u<s.length;u+=1)w=c.indexOf(s[u]),w>-1&&(c.splice(w,1),u-=1);for(a=0;a<f.keyDownCallback.length;a+=1)f.keyDownCallback[a](n,p(),f.keyCombo)===!1&&(b=!0);b===!0&&(n.preventDefault(),n.stopPropagation())}}}function it(n){for(var r,i,u,t=0;t<l.length;t+=1)if(i=l[t],h(i.keyCombo)===!1){for(r=0;r<i.keyUpCallback.length;r+=1)i.keyUpCallback[r](n,p(),i.keyCombo)===!1&&(u=!0);u===!0&&(n.preventDefault(),n.stopPropagation());l.splice(t,1);t-=1}}function rt(n,t){var i,r,u;if(n=e(n),t=e(t),n.length!==t.length)return!1;for(i=0;i<n.length;i+=1){if(n[i].length!==t[i].length)return!1;for(r=0;r<n[i].length;r+=1){if(n[i][r].length!==t[i][r].length)return!1;for(u=0;u<n[i][r].length;u+=1)if(t[i][r].indexOf(n[i][r][u])===-1)return!1}}return!0}function h(n){var t,u,f,i,o=0,s,h;for(n=e(n),t=0;t<n.length;t+=1){for(h=!0,o=0,u=0;u<n[t].length;u+=1){for(f=[].concat(n[t][u]),i=o;i<r.length;i+=1)s=f.indexOf(r[i]),s>-1&&(f.splice(s,1),o=i);if(f.length!==0){h=!1;break}}if(h)return!0}return!1}function ut(n){var t,i,r=[];for(n=e(n),t=0;t<n.length;t+=1)for(i=0;i<n[t].length;i+=1)r=r.concat(n[t][i]);return r}function e(n){var i=n,t=0,e=0,s=!1,o=!1,h=[],f=[],u=[],r="";if(typeof n=="object"&&typeof n.push=="function")return n;if(typeof n!="string")throw new Error('Cannot parse "keyCombo" because its type is "'+typeof n+'". It must be a "string".');while(i.charAt(t)===" ")t+=1;for(;;){if(i.charAt(t)===" "){while(i.charAt(t)===" ")t+=1;s=!0}else if(i.charAt(t)===","){if(e||o)throw new Error("Failed to parse key combo. Unexpected , at character index "+t+".");o=!0;t+=1}else if(i.charAt(t)==="+"){if(r.length&&(u.push(r),r=""),e||o)throw new Error("Failed to parse key combo. Unexpected + at character index "+t+".");e=!0;t+=1}else if(i.charAt(t)===">"){if(r.length&&(u.push(r),r=""),u.length&&(f.push(u),u=[]),e||o)throw new Error("Failed to parse key combo. Unexpected > at character index "+t+".");e=!0;t+=1}else if(t<i.length-1&&i.charAt(t)==="!"&&(i.charAt(t+1)===">"||i.charAt(t+1)===","||i.charAt(t+1)==="+"))r+=i.charAt(t+1),e=!1,s=!1,o=!1,t+=2;else if(t<i.length&&i.charAt(t)!=="+"&&i.charAt(t)!==">"&&i.charAt(t)!==","&&i.charAt(t)!==" ")for((e===!1&&s===!0||o===!0)&&(r.length&&(u.push(r),r=""),u.length&&(f.push(u),u=[]),f.length&&(h.push(f),f=[])),e=!1,s=!1,o=!1;t<i.length&&i.charAt(t)!=="+"&&i.charAt(t)!==">"&&i.charAt(t)!==","&&i.charAt(t)!==" ";)r+=i.charAt(t),t+=1;else{t+=1;continue}if(t>=i.length){r.length&&(u.push(r),r="");u.length&&(f.push(u),u=[]);f.length&&(h.push(f),f=[]);break}}return h}function ft(n){var t,i,r=[];if(typeof n=="string")return n;if(typeof n!="object"||typeof n.push!="function")throw new Error("Cannot stringify key combo.");for(t=0;t<n.length;t+=1){for(r[t]=[],i=0;i<n[t].length;i+=1)r[t][i]=n[t][i].join(" + ");r[t]=r[t].join(" > ")}return r.join(" ")}function p(){return[].concat(r)}function k(n){if(n.match(/\s/))throw new Error("Cannot add key name "+n+" to active keys because it contains whitespace.");r.indexOf(n)>-1||r.push(n)}function w(n){var t=nt(n);t==="91"||t==="92"?r=[]:r.splice(r.indexOf(n),1)}function et(n,t){if(typeof n!="string")throw new Error("Cannot register new locale. The locale name must be a string.");if(typeof t!="object")throw new Error("Cannot register "+n+" locale. The locale map must be an object.");if(typeof t.map!="object")throw new Error("Cannot register "+n+" locale. The locale map is invalid.");t.macros||(t.macros=[]);c[n]=t}function ot(n){if(n){if(typeof n!="string")throw new Error("Cannot set locale. The locale name must be a string.");if(!c[n])throw new Error("Cannot set locale to "+n+" because it does not exist. If you would like to submit a "+n+" locale map for KeyboardJS please submit it at https://github.com/RobertWHurst/KeyboardJS/issues.");s=c[n].map;i=c[n].macros;d=n}return d}for(var n={},c={},d,s,i,r=[],t=[],l=[],o=[],a={map:{"3":["cancel"],"8":["backspace"],"9":["tab"],"12":["clear"],"13":["enter"],"16":["shift"],"17":["ctrl"],"18":["alt","menu"],"19":["pause","break"],"20":["capslock"],"27":["escape","esc"],"32":["space","spacebar"],"33":["pageup"],"34":["pagedown"],"35":["end"],"36":["home"],"37":["left"],"38":["up"],"39":["right"],"40":["down"],"41":["select"],"42":["printscreen"],"43":["execute"],"44":["snapshot"],"45":["insert","ins"],"46":["delete","del"],"47":["help"],"91":["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"],"92":["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"],"145":["scrolllock","scroll"],"186":["semicolon",";"],"187":["equal","equalsign","="],"188":["comma",","],"189":["dash","-"],"190":["period","."],"191":["slash","forwardslash","/"],"192":["graveaccent","`"],"219":["openbracket","["],"220":["backslash","\\"],"221":["closebracket","]"],"222":["apostrophe","'"],"48":["zero","0"],"49":["one","1"],"50":["two","2"],"51":["three","3"],"52":["four","4"],"53":["five","5"],"54":["six","6"],"55":["seven","7"],"56":["eight","8"],"57":["nine","9"],"96":["numzero","num0"],"97":["numone","num1"],"98":["numtwo","num2"],"99":["numthree","num3"],"100":["numfour","num4"],"101":["numfive","num5"],"102":["numsix","num6"],"103":["numseven","num7"],"104":["numeight","num8"],"105":["numnine","num9"],"106":["nummultiply","num*"],"107":["numadd","num+"],"108":["numenter"],"109":["numsubtract","num-"],"110":["numdecimal","num."],"111":["numdivide","num/"],"144":["numlock","num"],"112":["f1"],"113":["f2"],"114":["f3"],"115":["f4"],"116":["f5"],"117":["f6"],"118":["f7"],"119":["f8"],"120":["f9"],"121":["f10"],"122":["f11"],"123":["f12"]},macros:[["shift + `",["tilde","~"]],["shift + 1",["exclamation","exclamationpoint","!"]],["shift + 2",["at","@"]],["shift + 3",["number","#"]],["shift + 4",["dollar","dollars","dollarsign","$"]],["shift + 5",["percent","%"]],["shift + 6",["caret","^"]],["shift + 7",["ampersand","and","&"]],["shift + 8",["asterisk","*"]],["shift + 9",["openparen","("]],["shift + 0",["closeparen",")"]],["shift + -",["underscore","_"]],["shift + =",["plus","+"]],["shift + (",["opencurlybrace","opencurlybracket","{"]],["shift + )",["closecurlybrace","closecurlybracket","}"]],["shift + \\",["verticalbar","|"]],["shift + ;",["colon",":"]],["shift + '",["quotationmark",'"']],["shift + !,",["openanglebracket","<"]],["shift + .",["closeanglebracket",">"]],["shift + /",["questionmark","?"]]]},f=65;f<=90;f+=1)a.map[f]=String.fromCharCode(f+32),a.macros.push(["shift + "+String.fromCharCode(f+32)+", capslock + "+String.fromCharCode(f+32),[String.fromCharCode(f)]]);et("us",a);ot("us");g();n.enable=g;n.disable=st;n.activeKeys=p;n.releaseKey=w;n.pressKey=k;n.on=at;n.clear=vt;n.clear.key=yt;n.locale=ot;n.locale.register=et;n.macro=ht;n.macro.remove=ct;n.key={};n.key.name=b;n.key.code=nt;n.combo={};n.combo.active=h;n.combo.parse=e;n.combo.stringify=ft;this.Keyboard=n},on:function(n,t,i){this.Keyboard.on(n,t,i)},getActiveKeys:function(){return this.Keyboard.activeKeys()}}});typeof module!="undefined"&&module.exports&&this.module!==module?module.exports=i:typeof define=="function"&&define.amd?define(i):n.ARE=i}()})(Function("return this")());
/*
//# sourceMappingURL=are.min.js.map
*/