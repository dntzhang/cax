/* Alloy Game Engine
 * By AlloyTeam http://www.alloyteam.com/
 * Github: https://github.com/AlloyTeam/AlloyGameEngine
 * MIT Licensed.
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.ARE=e()}(this,function(){"use strict";var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,i=function(){};i.extend=function(n){function s(){!t&&this.ctor&&this.ctor.apply(this,arguments)}var r=this.prototype;t=!0;var a=new this;t=!1;for(var o in n)"statics"!=o&&(a[o]="function"==typeof n[o]&&"function"==typeof r[o]&&e.test(n[o])?function(t,e){return function(){var i=this._super;this._super=r[t];var n=e.apply(this,arguments);return this._super=i,n}}(o,n[o]):n[o]);for(var h in this)this.hasOwnProperty(h)&&"extend"!=h&&(s[h]=this[h]);if(s.prototype=a,n.statics)for(var o in n.statics)n.statics.hasOwnProperty(o)&&(s[o]=n.statics[o],"ctor"==o&&s[o]());return s.prototype.constructor=s,s.extend=i.extend,s.implement=function(t){for(var e in t)a[e]=t[e]},s},window.Class=i;var n={};return n.TWEEN=i.extend({statics:{ctor:function(){void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()}),this._tweens=[]},REVISION:"14",getAll:function(){return this._tweens},removeAll:function(){this._tweens=[]},add:function(t){this._tweens.push(t)},remove:function(t){var e=this._tweens.indexOf(t);-1!==e&&this._tweens.splice(e,1)},update:function(t){if(0===this._tweens.length)return!1;var e=0;for(t=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();e<this._tweens.length;)this._tweens[e].update(t)?e++:this._tweens.splice(e,1);return!0},Tween:function(t){var e=t,i={},s={},r={},a=1e3,o=0,h=!1,c=!1,u=!1,l=0,f=null,d=n.TWEEN.Easing.Linear.None,p=n.TWEEN.Interpolation.Linear,m=[],g=null,v=!1,w=null,b=null,x=null,y=!1,E=null;for(var _ in t)i[_]=parseFloat(t[_],10);this.toggle=function(){y?this.play():this.pause()},this.pause=function(){y=!0;var t="undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();E=t-f},this.play=function(){y=!1;var t="undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();f=t-E},this.to=function(t,e){return void 0!==e&&(a=e),s=t,this},this.start=function(t){n.TWEEN.add(this),c=!0,v=!1,f=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),f+=l;for(var a in s){if(s[a]instanceof Array){if(0===s[a].length)continue;s[a]=[e[a]].concat(s[a])}i[a]=e[a],i[a]instanceof Array==!1&&(i[a]*=1),r[a]=i[a]||0}return this},this.stop=function(){return c?(n.TWEEN.remove(this),c=!1,null!==x&&x.call(e),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,e=m.length;e>t;t++)m[t].stop()},this.delay=function(t){return l=t,this},this.repeat=function(t){return o=t,this},this.yoyo=function(t){return h=t,this},this.easing=function(t){return d=t,this},this.interpolation=function(t){return p=t,this},this.chain=function(){return m=arguments,this},this.onStart=function(t){return g=t,this},this.onUpdate=function(t){return w=t,this},this.onComplete=function(t){return b=t,this},this.onStop=function(t){return x=t,this},this.update=function(t){if(y)return!0;var n;if(f>t)return!0;v===!1&&(null!==g&&g.call(e),v=!0);var c=(t-f)/a;c=c>1?1:c;var x=d(c);for(n in s){var E=i[n]||0,_=s[n];_ instanceof Array?e[n]=p(_,x):("string"==typeof _&&(_=E+parseFloat(_,10)),"number"==typeof _&&(e[n]=E+(_-E)*x))}if(null!==w&&w.call(e,x),1==c){if(o>0){isFinite(o)&&o--;for(n in r){if("string"==typeof s[n]&&(r[n]=r[n]+parseFloat(s[n],10)),h){var C=r[n];r[n]=s[n],s[n]=C}i[n]=r[n]}return h&&(u=!u),f=t+l,!0}null!==b&&b.call(e);for(var T=0,A=m.length;A>T;T++)m[T].start(t);return!1}return!0}},Easing:{Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)))},Out:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/n)+1)},InOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n):i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-n.TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*n.TWEEN.Easing.Bounce.In(2*t):.5*n.TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},Interpolation:{Linear:function(t,e){var i=t.length-1,s=i*e,r=Math.floor(s),a=n.TWEEN.Interpolation.Utils.Linear;return 0>e?a(t[0],t[1],s):e>1?a(t[i],t[i-1],i-s):a(t[r],t[r+1>i?i:r+1],s-r)},Bezier:function(t,e){var i,s=0,r=t.length-1,a=Math.pow,o=n.TWEEN.Interpolation.Utils.Bernstein;for(i=0;r>=i;i++)s+=a(1-e,r-i)*a(e,i)*t[i]*o(r,i);return s},CatmullRom:function(t,e){var i=t.length-1,s=i*e,r=Math.floor(s),a=n.TWEEN.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(0>e&&(r=Math.floor(s=i*(1+e))),a(t[(r-1+i)%i],t[r],t[(r+1)%i],t[(r+2)%i],s-r)):0>e?t[0]-(a(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(a(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):a(t[r?r-1:0],t[r],t[r+1>i?i:r+1],t[r+2>i?i:r+2],s-r)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=n.TWEEN.Interpolation.Utils.getFactorial();return i(t)/i(e)/i(t-e)},getFactorial:function(){return function(){var t=[1];return function(e){var i,n=1;if(t[e])return t[e];for(i=e;i>1;i--)n*=i;return t[e]=n}}()},CatmullRom:function(t,e,i,n,s){var r=.5*(i-t),a=.5*(n-e),o=s*s,h=s*o;return(2*e-2*i+r+a)*h+(-3*e+3*i-2*r-a)*o+r*s+e}}}}}),n.Dom=i.extend({statics:{get:function(t){return this.element=document.querySelector(t),this},on:function(t,e){return this.element.addEventListener(t,e,!1),this}}}),n.FPS=i.extend({statics:{get:function(){return this.instance||(this.instance=new this),this.instance._computeFPS(),this.instance}},ctor:function(){this.last=new Date,this.current=null,this.value=0,this.totalValue=0,this.fpsList=[],this.count=0;var t=this;setInterval(function(){var e=t.fpsList.length-1;t.value=t.fpsList[e],e>500&&t.fpsList.shift(),t.averageFPS=Math.ceil(t.totalValue/t.count)},500)},_computeFPS:function(){if(this.current=new Date,this.current-this.last>0){var t=Math.ceil(1e3/(this.current-this.last));this.fpsList.push(t),this.count++,this.totalValue+=t,this.last=this.current}}}),n.Keyboard=i.extend({statics:{ctor:function(){function t(){window.addEventListener?(window.document.addEventListener("keydown",n,!1),window.document.addEventListener("keyup",s,!1),window.addEventListener("blur",i,!1),window.addEventListener("webkitfullscreenchange",i,!1),window.addEventListener("mozfullscreenchange",i,!1)):window.attachEvent&&(window.document.attachEvent("onkeydown",n),window.document.attachEvent("onkeyup",s),window.attachEvent("onblur",i))}function e(){i(),window.removeEventListener?(window.document.removeEventListener("keydown",n,!1),window.document.removeEventListener("keyup",s,!1),window.removeEventListener("blur",i,!1),window.removeEventListener("webkitfullscreenchange",i,!1),window.removeEventListener("mozfullscreenchange",i,!1)):window.detachEvent&&(window.document.detachEvent("onkeydown",n),window.document.detachEvent("onkeyup",s),window.detachEvent("onblur",i))}function i(t){S=[],u(),m(t)}function n(t){var e,i,n;if(e=r(t.keyCode),!(e.length<1)){for(t.isRepeat=!1,n=0;n<e.length;n+=1)i=e[n],-1!=y().indexOf(i)&&(t.isRepeat=!0),E(i);c(),p(t)}}function s(t){var e,i;if(e=r(t.keyCode),!(e.length<1)){for(i=0;i<e.length;i+=1)_(e[i]);u(),m(t)}}function r(t){return k[t]||[]}function a(t){var e;for(e in k)if(k.hasOwnProperty(e)&&k[e].indexOf(t)>-1)return e;return!1}function o(t,e){if("string"!=typeof t&&("object"!=typeof t||"function"!=typeof t.push))throw new Error("Cannot create macro. The combo must be a string or array.");if("object"!=typeof e||"function"!=typeof e.push)throw new Error("Cannot create macro. The injectedKeys must be an array.");I.push([t,e])}function h(t){var e,i;if("string"!=typeof t&&("object"!=typeof t||"function"!=typeof t.push))throw new Error("Cannot remove macro. The combo must be a string or array.");for(i=0;i<I.length;i+=1)if(e=I[i],g(t,e[0])){_(e[1]),I.splice(i,1);break}}function c(){var t,e,i;for(t=0;t<I.length;t+=1)if(e=b(I[t][0]),-1===B.indexOf(I[t])&&v(e))for(B.push(I[t]),i=0;i<I[t][1].length;i+=1)E(I[t][1][i])}function u(){var t,e,i;for(t=0;t<B.length;t+=1)if(e=b(B[t][0]),v(e)===!1){for(i=0;i<B[t][1].length;i+=1)_(B[t][1][i]);B.splice(t,1),t-=1}}function l(t,e,i){function n(){var t;for(t=0;t<c.length;t+=1)M.splice(M.indexOf(c[t]),1)}function s(t){function e(){var e,n;for(e=0;e<i.length;e+=1)if("function"==typeof i[e])if("keyup"===t)for(n=0;n<c.length;n+=1)c[n].keyUpCallback.splice(c[n].keyUpCallback.indexOf(i[e]),1);else for(n=0;n<c.length;n+=1)c[n].keyDownCallback.splice(c[n].keyDownCallback.indexOf(i[e]),1)}var i,n,s,r={};if("string"!=typeof t)throw new Error("Cannot bind callback. The event name must be a string.");if("keyup"!==t&&"keydown"!==t)throw new Error('Cannot bind callback. The event name must be a "keyup" or "keydown".');for(i=Array.prototype.slice.apply(arguments,[1]),n=0;n<i.length;n+=1)if("function"==typeof i[n])if("keyup"===t)for(s=0;s<c.length;s+=1)c[s].keyUpCallback.push(i[n]);else if("keydown"===t)for(s=0;s<c.length;s+=1)c[s].keyDownCallback.push(i[n]);return r.clear=e,r}var r,a,o,h={},c=[];for("string"==typeof t&&(t=b(t)),a=0;a<t.length;a+=1){if(r={},o=x([t[a]]),"string"!=typeof o)throw new Error("Failed to bind key combo. The key combo must be string.");r.keyCombo=o,r.keyDownCallback=[],r.keyUpCallback=[],e&&r.keyDownCallback.push(e),i&&r.keyUpCallback.push(i),M.push(r),c.push(r)}return h.clear=n,h.on=s,h}function f(t){var e,i;for(e=0;e<M.length;e+=1)i=M[e],g(t,i.keyCombo)&&(M.splice(e,1),e-=1)}function d(t){var e,i,n;if(t){for(e=0;e<M.length;e+=1)for(n=M[e],i=0;i<n.keyCombo.length;i+=1)if(n.keyCombo[i].indexOf(t)>-1){M.splice(e,1),e-=1;break}}else M=[]}function p(t){var e,i,n,s,r,a,o,h,c,u,l,f=[];for(r=[].concat(S),e=0;e<M.length;e+=1)l=w(M[e].keyCombo).length,f[l]||(f[l]=[]),f[l].push(M[e]);for(i=f.length-1;i>=0;i-=1)if(f[i])for(e=0;e<f[i].length;e+=1){for(n=f[i][e],s=w(n.keyCombo),c=!0,h=0;h<s.length;h+=1)if(-1===r.indexOf(s[h])){c=!1;break}if(c&&v(n.keyCombo)){for(L.push(n),h=0;h<s.length;h+=1)u=r.indexOf(s[h]),u>-1&&(r.splice(u,1),h-=1);for(a=0;a<n.keyDownCallback.length;a+=1)n.keyDownCallback[a](t,y(),n.keyCombo)===!1&&(o=!0);o===!0&&(t.preventDefault(),t.stopPropagation())}}}function m(t){var e,i,n,s;for(e=0;e<L.length;e+=1)if(n=L[e],v(n.keyCombo)===!1){for(i=0;i<n.keyUpCallback.length;i+=1)n.keyUpCallback[i](t,y(),n.keyCombo)===!1&&(s=!0);s===!0&&(t.preventDefault(),t.stopPropagation()),L.splice(e,1),e-=1}}function g(t,e){var i,n,s;if(t=b(t),e=b(e),t.length!==e.length)return!1;for(i=0;i<t.length;i+=1){if(t[i].length!==e[i].length)return!1;for(n=0;n<t[i].length;n+=1){if(t[i][n].length!==e[i][n].length)return!1;for(s=0;s<t[i][n].length;s+=1)if(-1===e[i][n].indexOf(t[i][n][s]))return!1}}return!0}function v(t){var e,i,n,s,r,a,o=0;for(t=b(t),e=0;e<t.length;e+=1){for(a=!0,o=0,i=0;i<t[e].length;i+=1){for(n=[].concat(t[e][i]),s=o;s<S.length;s+=1)r=n.indexOf(S[s]),r>-1&&(n.splice(r,1),o=s);if(0!==n.length){a=!1;break}}if(a)return!0}return!1}function w(t){var e,i,n=[];for(t=b(t),e=0;e<t.length;e+=1)for(i=0;i<t[e].length;i+=1)n=n.concat(t[e][i]);return n}function b(t){var e=t,i=0,n=0,s=!1,r=!1,a=[],o=[],h=[],c="";if("object"==typeof t&&"function"==typeof t.push)return t;if("string"!=typeof t)throw new Error('Cannot parse "keyCombo" because its type is "'+typeof t+'". It must be a "string".');for(;" "===e.charAt(i);)i+=1;for(;;){if(" "===e.charAt(i)){for(;" "===e.charAt(i);)i+=1;s=!0}else if(","===e.charAt(i)){if(n||r)throw new Error("Failed to parse key combo. Unexpected , at character index "+i+".");r=!0,i+=1}else if("+"===e.charAt(i)){if(c.length&&(h.push(c),c=""),n||r)throw new Error("Failed to parse key combo. Unexpected + at character index "+i+".");n=!0,i+=1}else if(">"===e.charAt(i)){if(c.length&&(h.push(c),c=""),h.length&&(o.push(h),h=[]),n||r)throw new Error("Failed to parse key combo. Unexpected > at character index "+i+".");n=!0,i+=1}else if(i<e.length-1&&"!"===e.charAt(i)&&(">"===e.charAt(i+1)||","===e.charAt(i+1)||"+"===e.charAt(i+1)))c+=e.charAt(i+1),n=!1,s=!1,r=!1,i+=2;else{if(!(i<e.length&&"+"!==e.charAt(i)&&">"!==e.charAt(i)&&","!==e.charAt(i)&&" "!==e.charAt(i))){i+=1;continue}for((n===!1&&s===!0||r===!0)&&(c.length&&(h.push(c),c=""),h.length&&(o.push(h),h=[]),o.length&&(a.push(o),o=[])),n=!1,s=!1,r=!1;i<e.length&&"+"!==e.charAt(i)&&">"!==e.charAt(i)&&","!==e.charAt(i)&&" "!==e.charAt(i);)c+=e.charAt(i),i+=1}if(i>=e.length){c.length&&(h.push(c),c=""),h.length&&(o.push(h),h=[]),o.length&&(a.push(o),o=[]);break}}return a}function x(t){var e,i,n=[];if("string"==typeof t)return t;if("object"!=typeof t||"function"!=typeof t.push)throw new Error("Cannot stringify key combo.");for(e=0;e<t.length;e+=1){for(n[e]=[],i=0;i<t[e].length;i+=1)n[e][i]=t[e][i].join(" + ");n[e]=n[e].join(" > ")}return n.join(" ")}function y(){return[].concat(S)}function E(t){if(t.match(/\s/))throw new Error("Cannot add key name "+t+" to active keys because it contains whitespace.");S.indexOf(t)>-1||S.push(t)}function _(t){var e=a(t);"91"===e||"92"===e?S=[]:S.splice(S.indexOf(t),1)}function C(t,e){if("string"!=typeof t)throw new Error("Cannot register new locale. The locale name must be a string.");if("object"!=typeof e)throw new Error("Cannot register "+t+" locale. The locale map must be an object.");if("object"!=typeof e.map)throw new Error("Cannot register "+t+" locale. The locale map is invalid.");e.macros||(e.macros=[]),P[t]=e}function T(t){if(t){if("string"!=typeof t)throw new Error("Cannot set locale. The locale name must be a string.");if(!P[t])throw new Error("Cannot set locale to "+t+" because it does not exist. If you would like to submit a "+t+" locale map for KeyboardJS please submit it at https://github.com/RobertWHurst/KeyboardJS/issues.");k=P[t].map,I=P[t].macros,A=t}return A}var A,k,I,R,O,D={},P={},S=[],M=[],L=[],B=[];for(O={map:{3:["cancel"],8:["backspace"],9:["tab"],12:["clear"],13:["enter"],16:["shift"],17:["ctrl"],18:["alt","menu"],19:["pause","break"],20:["capslock"],27:["escape","esc"],32:["space","spacebar"],33:["pageup"],34:["pagedown"],35:["end"],36:["home"],37:["left"],38:["up"],39:["right"],40:["down"],41:["select"],42:["printscreen"],43:["execute"],44:["snapshot"],45:["insert","ins"],46:["delete","del"],47:["help"],91:["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"],92:["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"],145:["scrolllock","scroll"],186:["semicolon",";"],187:["equal","equalsign","="],188:["comma",","],189:["dash","-"],190:["period","."],191:["slash","forwardslash","/"],192:["graveaccent","`"],219:["openbracket","["],220:["backslash","\\"],221:["closebracket","]"],222:["apostrophe","'"],48:["zero","0"],49:["one","1"],50:["two","2"],51:["three","3"],52:["four","4"],53:["five","5"],54:["six","6"],55:["seven","7"],56:["eight","8"],57:["nine","9"],96:["numzero","num0"],97:["numone","num1"],98:["numtwo","num2"],99:["numthree","num3"],100:["numfour","num4"],101:["numfive","num5"],102:["numsix","num6"],103:["numseven","num7"],104:["numeight","num8"],105:["numnine","num9"],106:["nummultiply","num*"],107:["numadd","num+"],108:["numenter"],109:["numsubtract","num-"],110:["numdecimal","num."],111:["numdivide","num/"],144:["numlock","num"],112:["f1"],113:["f2"],114:["f3"],115:["f4"],116:["f5"],117:["f6"],118:["f7"],119:["f8"],120:["f9"],121:["f10"],122:["f11"],123:["f12"]},macros:[["shift + `",["tilde","~"]],["shift + 1",["exclamation","exclamationpoint","!"]],["shift + 2",["at","@"]],["shift + 3",["number","#"]],["shift + 4",["dollar","dollars","dollarsign","$"]],["shift + 5",["percent","%"]],["shift + 6",["caret","^"]],["shift + 7",["ampersand","and","&"]],["shift + 8",["asterisk","*"]],["shift + 9",["openparen","("]],["shift + 0",["closeparen",")"]],["shift + -",["underscore","_"]],["shift + =",["plus","+"]],["shift + (",["opencurlybrace","opencurlybracket","{"]],["shift + )",["closecurlybrace","closecurlybracket","}"]],["shift + \\",["verticalbar","|"]],["shift + ;",["colon",":"]],["shift + '",["quotationmark",'"']],["shift + !,",["openanglebracket","<"]],["shift + .",["closeanglebracket",">"]],["shift + /",["questionmark","?"]]]},R=65;90>=R;R+=1)O.map[R]=String.fromCharCode(R+32),O.macros.push(["shift + "+String.fromCharCode(R+32)+", capslock + "+String.fromCharCode(R+32),[String.fromCharCode(R)]]);C("us",O),T("us"),t(),D.enable=t,D.disable=e,D.activeKeys=y,D.releaseKey=_,D.pressKey=E,D.on=l,D.clear=f,D.clear.key=d,D.locale=T,D.locale.register=C,D.macro=o,D.macro.remove=h,D.key={},D.key.name=r,D.key.code=a,D.combo={},D.combo.active=v,D.combo.parse=b,D.combo.stringify=x,this.Keyboard=D},on:function(t,e,i){this.Keyboard.on(t,e,i)},getActiveKeys:function(){return this.Keyboard.activeKeys()}}}),n.Loader=i.extend({ctor:function(){this.audios={},this.res={},this.loadedCount=0,this.resCount=-1,this.FILE_PATTERN=/(\w+:\/{2})?((?:\w+\.){2}\w+)?(\/?[\S]+\/|\/)?([\w\-%\.]+)(?:\.)(\w+)?(\?\S+)?/i,this.ns=3,this.sounds=[];for(var t=0;t<this.ns;t++)this.sounds.push([]);this.playing=[],this.soundsCount=0},get:function(t){return this.res[t]},loadRes:function(t){this.resCount=t.length;for(var e=0;e<t.length;e++)"audio"==this._getTypeByExtension(t[e].src.match(this.FILE_PATTERN)[5])?this.loadAudio(t[e].id,t[e].src):this.loadImage(t[e].id,t[e].src)},loadImage:function(t,e){var i=document.createElement("img"),n=this;i.onload=function(){n._handleLoad(this,t),i.onreadystatechange=null},i.onreadystatechange=function(){("loaded"==i.readyState||"complete"==i.readyState)&&(n._handleLoad(this,t),i.onload=null)},i.onerror=function(){},i.src=e},loadAudio:function(t,e){var i=document.createElement("audio");i.autoplay=!1,this.res[t]=i,i.src=null,i.preload="auto",i.onerror=function(){},i.onstalled=function(){};var n=this,s=function(){n.playing[t]=0;for(var i=0;i<n.ns;i++)n.sounds[i][t]=new Audio(e);n.loadedCount++,n.handleProgress(n.loadedCount,n.resCount),n._clean(this),this.removeEventListener&&this.removeEventListener("canplaythrough",s,!1),n.checkComplete()};i.addEventListener("canplaythrough",s,!1),i.src=e,null!=i.load&&i.load()},checkComplete:function(){this.loadedCount===this.resCount&&this.handleComplete()},complete:function(t){this.handleComplete=t},progress:function(t){this.handleProgress=t},playSound:function(t){this.sounds[this.playing[t]][t].play(),++this.playing[t],this.playing[t]>=this.ns&&(this.playing[t]=0)},_handleLoad:function(t,e){this._clean(t),this.res[e]=t,this.loadedCount++,this.handleProgress&&this.handleProgress(this.loadedCount,this.resCount),this.checkComplete()},_getTypeByExtension:function(t){switch(t){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return"img";case"ogg":case"mp3":case"wav":return"audio"}},_clean:function(t){t.onload=null,t.onstalled=null,t.onprogress=null,t.onerror=null}}),n.Matrix2D=i.extend({statics:{DEG_TO_RAD:.017453292519943295},ctor:function(t,e,i,n,s,r){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==n?1:n,this.tx=s||0,this.ty=r||0,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},appendTransform:function(t,e,i,s,r,a,o,h,c){if(r%360)var u=r*n.Matrix2D.DEG_TO_RAD,l=Math.cos(u),f=Math.sin(u);else l=1,f=0;return a||o?(a*=n.Matrix2D.DEG_TO_RAD,o*=n.Matrix2D.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(a),Math.cos(a),t,e),this.append(l*i,f*i,-f*s,l*s,0,0)):this.append(l*i,f*i,-f*s,l*s,t,e),(h||c)&&(this.tx-=h*this.a+c*this.c,this.ty-=h*this.b+c*this.d),this},append:function(t,e,i,n,s,r){var a=this.a,o=this.b,h=this.c,c=this.d;return this.a=t*a+e*h,this.b=t*o+e*c,this.c=i*a+n*h,this.d=i*o+n*c,this.tx=s*a+r*h+this.tx,this.ty=s*o+r*c+this.ty,this},initialize:function(t,e,i,n,s,r){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=r,this},setValues:function(t,e,i,n,s,r){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==n?1:n,this.tx=s||0,this.ty=r||0,this},copy:function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)}}),function(){var t=function(e,i,n){var s=function(e,i,n){e.$observer||(e.$observer=this);var s=e.$observer,r=[];t.isArray(e)&&s.mock(e);for(var a in e)e.hasOwnProperty(a)&&(n?t.isArray(i)&&t.isInArray(i,a)?(r.push(a),s.watch(e,a)):t.isString(i)&&a==i&&(r.push(a),s.watch(e,a)):(r.push(a),s.watch(e,a)));s.target=e,s.propertyChangedHandler||(s.propertyChangedHandler=[]);var o=n?n:i;s.propertyChangedHandler.push({all:!n,propChanged:o,eventPropArr:r})};return s.prototype={onPropertyChanged:function(e,i,n,s,r){if(i!==n&&this.propertyChangedHandler)for(var a=t._getRootName(e,r),o=0,h=this.propertyChangedHandler.length;h>o;o++){var c=this.propertyChangedHandler[o];(c.all||t.isInArray(c.eventPropArr,a)||0===a.indexOf("Array-"))&&c.propChanged.call(this.target,e,i,n,r)}0!==e.indexOf("Array-")&&"object"==typeof i&&this.watch(s,e,s.$observeProps.$observerPath)},mock:function(e){var i=this;t.methods.forEach(function(n){e[n]=function(){var e=Array.prototype.slice.call(this,0),s=Array.prototype[n].apply(this,Array.prototype.slice.call(arguments));if(new RegExp("\\b"+n+"\\b").test(t.triggerStr)){for(var r in this)this.hasOwnProperty(r)&&!t.isFunction(this[r])&&i.watch(this,r,this.$observeProps.$observerPath);i.onPropertyChanged("Array-"+n,this,e,this,this.$observeProps.$observerPath)}return s}})},watch:function(e,i,n){if("$observeProps"!==i&&"$observer"!==i&&!t.isFunction(e[i])){e.$observeProps||(e.$observeProps={}),e.$observeProps.$observerPath=void 0!==n?n:"#";var s=this,r=e.$observeProps[i]=e[i];if(Object.defineProperty(e,i,{get:function(){return this.$observeProps[i]},set:function(t){var n=this.$observeProps[i];this.$observeProps[i]=t,s.onPropertyChanged(i,t,n,this,e.$observeProps.$observerPath)}}),"object"==typeof r){t.isArray(r)&&this.mock(r);for(var a in r)r.hasOwnProperty(a)&&this.watch(r,a,e.$observeProps.$observerPath+"-"+i)}}}},new s(e,i,n)};t.methods=["concat","every","filter","forEach","indexOf","join","lastIndexOf","map","pop","push","reduce","reduceRight","reverse","shift","slice","some","sort","splice","unshift","toLocaleString","toString","size"],t.triggerStr=["concat","pop","push","reverse","shift","sort","splice","unshift","size"].join(","),t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isString=function(t){return"string"==typeof t},t.isInArray=function(t,e){for(var i=t.length;--i>-1;)if(e===t[i])return!0;return!1},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.twoWay=function(e,i,n,s){"object"==typeof e[i]&&"object"==typeof n[s]?(t(e,i,function(t,e){n[s]=this[i]}),t(n,s,function(t,n){e[i]=this[s]})):(t(e,i,function(t,e){n[s]=e}),t(n,s,function(t,n){e[i]=n}))},t._getRootName=function(t,e){return"#"===e?t:e.split("-")[1]},t.add=function(t,e,i){t[e]=i;var n=t.$observer;n.watch(t,e)},Array.prototype.size=function(t){this.length=t},n.Observe=t}(),n.RAF=i.extend({statics:{ctor:function(){var t=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}(),e=function(e,i){function n(){var a=(new Date).getTime(),o=a-s;o>=i&&(e.call(),s=(new Date).getTime()),r.value=t(n)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setInterval(e,i);var s=(new Date).getTime(),r=new Object;return r.value=t(n),r},i=function(t){t&&setTimeout(function(){window.cancelAnimationFrame?window.cancelAnimationFrame(t.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(t.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(t.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(t.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(t.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(t.value):clearInterval(t)},0)};this.requestInterval=e,this.clearRequestInterval=i}}}),n.To=i.extend({statics:{ctor:function(){this.bounceOut=n.TWEEN.Easing.Bounce.Out,this.linear=n.TWEEN.Easing.Linear.None,this.quadraticIn=n.TWEEN.Easing.Quadratic.In,this.quadraticOut=n.TWEEN.Easing.Quadratic.Out,this.quadraticInOut=n.TWEEN.Easing.Quadratic.InOut,this.cubicIn=n.TWEEN.Easing.Cubic.In,this.cubicOut=n.TWEEN.Easing.Cubic.Out,this.cubicInOut=n.TWEEN.Easing.Cubic.InOut,this.quarticIn=n.TWEEN.Easing.Quartic.In,this.quarticOut=n.TWEEN.Easing.Quartic.Out,this.quarticInOut=n.TWEEN.Easing.Quartic.InOut,this.quinticIn=n.TWEEN.Easing.Quintic.In,this.quinticOut=n.TWEEN.Easing.Quintic.Out,this.quinticInOut=n.TWEEN.Easing.Quintic.InOut,this.sinusoidalIn=n.TWEEN.Easing.Sinusoidal.In,this.sinusoidalOut=n.TWEEN.Easing.Sinusoidal.Out,this.sinusoidalInOut=n.TWEEN.Easing.Sinusoidal.InOut,this.exponentialIn=n.TWEEN.Easing.Exponential.In,this.exponentialOut=n.TWEEN.Easing.Exponential.Out,this.exponentialInOut=n.TWEEN.Easing.Exponential.InOut,this.circularIn=n.TWEEN.Easing.Circular.In,this.circularOut=n.TWEEN.Easing.Circular.Out,this.circularInOut=n.TWEEN.Easing.Circular.InOut,this.elasticIn=n.TWEEN.Easing.Elastic.In,this.elasticOut=n.TWEEN.Easing.Elastic.Out,this.elasticInOut=n.TWEEN.Easing.Elastic.InOut,this.backIn=n.TWEEN.Easing.Back.In,this.backOut=n.TWEEN.Easing.Back.Out,this.backInOut=n.TWEEN.Easing.Back.InOut,this.bounceIn=n.TWEEN.Easing.Bounce.In,this.bounceOut=n.TWEEN.Easing.Bounce.Out,this.bounceInOut=n.TWEEN.Easing.Bounce.InOut,this.interpolationLinear=n.TWEEN.Interpolation.Linear,this.interpolationBezier=n.TWEEN.Interpolation.Bezier,this.interpolationCatmullRom=n.TWEEN.Interpolation.CatmullRom},get:function(t){var e=new this(t),i=this.getStage(t);return i.toList.push(e),e},getStage:function(t){if(!t.parent)throw"please add the object to the stage , then animate it.";return t.parent instanceof n.Stage?t.parent:this.getStage(t.parent)}},ctor:function(t){this.element=t,this.cmds=[],this.index=0,this.tweens=[],this._pause=!1,this.loop=setInterval(function(){n.TWEEN.update()},15),this.cycleCount=0},to:function(){return this.cmds.push(["to"]),this},set:function(t,e,i,n){return this.cmds[this.cmds.length-1].push([t,[e,i,n]]),this},x:function(){return this.cmds[this.cmds.length-1].push(["x",arguments]),this},y:function(){return this.cmds[this.cmds.length-1].push(["y",arguments]),this},z:function(){return this.cmds[this.cmds.length-1].push(["z",arguments]),this},rotation:function(){return this.cmds[this.cmds.length-1].push(["rotation",arguments]),this},scaleX:function(){return this.cmds[this.cmds.length-1].push(["scaleX",arguments]),this},scaleY:function(){return this.cmds[this.cmds.length-1].push(["scaleY",arguments]),this},skewX:function(){return this.cmds[this.cmds.length-1].push(["skewX",arguments]),this},skewY:function(){return this.cmds[this.cmds.length-1].push(["skewY",arguments]),this},originX:function(){return this.cmds[this.cmds.length-1].push(["originX",arguments]),this},originY:function(){return this.cmds[this.cmds.length-1].push(["originY",arguments]),this},alpha:function(){return this.cmds[this.cmds.length-1].push(["alpha",arguments]),this},begin:function(t){return this.cmds[this.cmds.length-1].begin=t,this},progress:function(t){return this.cmds[this.cmds.length-1].progress=t,this},end:function(t){return this.cmds[this.cmds.length-1].end=t,this},wait:function(){return this.cmds.push(["wait",arguments]),this},then:function(){return this.cmds.push(["then",arguments]),this},cycle:function(){return this.cmds.push(["cycle",arguments]),this},shake:function(){return this.cmds=this.cmds.concat([["to",["x",{0:10,1:50}]],["to",["x",{0:-10,1:50}]],["to",["x",{0:10,1:50}]],["to",["x",{0:-10,1:50}]],["to",["x",{0:10,1:50}]],["to",["x",{0:-10,1:50}]],["to",["x",{0:10,1:50}]],["to",["x",{0:-10,1:50}]],["to",["x",{0:10,1:50}]],["to",["x",{0:-10,1:50}]],["to",["x",{0:10,1:50}]],["to",["x",{0:0,1:50}]]]),this},rubber:function(){return this.cmds=this.cmds.concat([["to",["scaleX",{0:1.25,1:300}],["scaleY",{0:.75,1:300}]],["to",["scaleX",{0:.75,1:100}],["scaleY",{0:1.25,1:100}]],["to",["scaleX",{0:1.15,1:100}],["scaleY",{0:.85,1:100}]],["to",["scaleX",{0:.95,1:150}],["scaleY",{0:1.05,1:150}]],["to",["scaleX",{0:1.05,1:100}],["scaleY",{0:.95,1:100}]],["to",["scaleX",{0:1,1:250}],["scaleY",{0:1,1:250}]]]),this},bounceIn:function(){return this.cmds=this.cmds.concat([["to",["scaleX",{0:0,1:0}],["scaleY",{0:0,1:0}]],["to",["scaleX",{0:1.35,1:200}],["scaleY",{0:1.35,1:200}]],["to",["scaleX",{0:.9,1:100}],["scaleY",{0:.9,1:100}]],["to",["scaleX",{0:1.1,1:100}],["scaleY",{0:1.1,1:100}]],["to",["scaleX",{0:.95,1:100}],["scaleY",{0:.95,1:100}]],["to",["scaleX",{0:1,1:100}],["scaleY",{0:1,1:100}]]]),this},flipInX:function(){return this.cmds=this.cmds.concat([["to",["rotateX",{0:-90,1:0}]],["to",["rotateX",{0:20,1:300}]],["to",["rotateX",{0:-20,1:300}]],["to",["rotateX",{0:10,1:300}]],["to",["rotateX",{0:-5,1:300}]],["to",["rotateX",{0:0,1:300}]]]),this},zoomOut:function(){return this.cmds=this.cmds.concat([["to",["scaleX",{0:0,1:400}],["scaleY",{0:0,1:400}]]]),this},start:function(){if(!this._pause){var t=this.cmds.length;return this.index<t?this.exec(this.cmds[this.index],this.index==t-1):clearInterval(this.loop),this}},pause:function(){this._pause=!0;for(var t=0,e=this.tweens.length;e>t;t++)this.tweens[t].pause();"wait"==this.currentTask&&(this.timeout-=new Date-this.currentTaskBegin,this.currentTaskBegin=new Date)},toggle:function(){this._pause?this.play():this.pause()},play:function(){this._pause=!1;for(var t=0,e=this.tweens.length;e>t;t++)this.tweens[t].play();var i=this;"wait"==this.currentTask&&setTimeout(function(){i._pause||(i.index++,i.start(),i.index==i.cmds.length&&i.complete&&i.complete())},this.timeout)},exec:function(t,e){var i=t.length,s=this;switch(this.currentTask=t[0],this.currentTask){case"to":s.stepCompleteCount=0;for(var r=1;i>r;r++){var a=t[r],o=a[1][2],h={},c=a[0];h[c]=a[1][0];var u=new n.TWEEN.Tween(this.element).to(h,a[1][1]).onStart(function(){t.start&&t.start()}).onUpdate(function(){t.progress&&t.progress.call(s.element),s.element[c]=this[c]}).easing(o?o:n.To.linear).onComplete(function(){s.stepCompleteCount++,
s.stepCompleteCount==i-1&&(t.end&&t.end.call(s.element),e&&s.complete&&s.complete(),s.index++,s.start())}).start();this.tweens.push(u)}break;case"wait":this.currentTaskBegin=new Date,this.timeout=t[1][0],setTimeout(function(){s._pause||(s.index++,s.start(),e&&s.complete&&s.complete())},t[1][0]);break;case"then":var l=t[1][0];l.index=0,l.complete=function(){s.index++,s.start(),e&&s.complete&&s.complete()},l.start();break;case"cycle":var f=t[1][1];f&&s.cycleCount==f?(s.index++,s.start(),e&&s.complete&&s.complete()):(s.cycleCount++,s.index=t[1][0],s.start())}}}),n.UID=i.extend({statics:{_nextID:0,_nextCacheID:1,get:function(){return this._nextID++},getCacheID:function(){return this._nextCacheID++}}}),n.Util=i.extend({statics:{random:function(t,e){return t+Math.floor(Math.random()*(e-t+1))}}}),n.Vector2=i.extend({ctor:function(t,e){this.x=t,this.y=e},copy:function(){return new n.Vector2(this.x,this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},sqrLength:function(){return this.x*this.x+this.y*this.y},normalize:function(){var t=1/this.length();return new n.Vector2(this.x*t,this.y*t)},negate:function(){return new n.Vector2(-this.x,-this.y)},add:function(t){this.x+=t.x,this.y+=t.y},subtract:function(t){return new n.Vector2(this.x-t.x,this.y-t.y)},multiply:function(t){return new n.Vector2(this.x*t,this.y*t)},divide:function(t){var e=1/t;return new n.Vector2(this.x*e,this.y*e)},dot:function(t){return this.x*t.x+this.y*t.y}}),n.Renderer=i.extend({ctor:function(t,e){this.stage=t,this.objs=[],this.width=this.stage.width,this.height=this.stage.height,this.mainCanvas=this.stage.canvas;var i=!!window.CanvasRenderingContext2D,s=function(){try{var t=document.createElement("canvas");return!(!window.WebGLRenderingContext||!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(e){return!1}}();if(s&&!e)this.renderingEngine=new n.WebGLRenderer(this.stage.canvas);else{if(!i)throw"your browser does not support canvas and webgl ";this.renderingEngine=new n.CanvasRenderer(this.stage.canvas)}this.mainCtx=this.renderingEngine.ctx},update:function(){var t=this.objs,e=this.mainCtx,i=this.renderingEngine;t.length=0,this.computeMatrix(),i.clear();for(var n=t.length,s=0;n>s;s++)i.renderObj(e,t[s])},computeMatrix:function(){for(var t=0,e=this.stage.children.length;e>t;t++)this._computeMatrix(this.stage.children[t])},initComplex:function(t){t.complexCompositeOperation=this._getCompositeOperation(t),t.complexAlpha=this._getAlpha(t,1)},_computeMatrix:function(t,e){if(t.isVisible())if(e?t._matrix.initialize(e.a,e.b,e.c,e.d,e.tx,e.ty):t._matrix.initialize(1,0,0,1,0,0),t instanceof n.Shape?t._matrix.appendTransform(t.x,t.y,1,1,t.rotation,t.skewX,t.skewY,t.regX,t.regY):t._matrix.appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY),t instanceof n.Container)for(var i=t.children,s=i.length,r=0;s>r;r++)this._computeMatrix(i[r],t._matrix);else t instanceof n.Graphics||t instanceof n.Text?(this.objs.push(t),this.initComplex(t)):(t.initAABB(),this.isInStage(t)&&(this.objs.push(t),this.initComplex(t)))},_getCompositeOperation:function(t){return t.compositeOperation?t.compositeOperation:t.parent?this._getCompositeOperation(t.parent):void 0},_getAlpha:function(t,e){var i=t.alpha*e;return t.parent?this._getAlpha(t.parent,i):i},isInStage:function(t){return this.collisionBetweenAABB(t.AABB,this.stage.AABB)},collisionBetweenAABB:function(t,e){var i=t[0]+t[2];if(i<e[0])return!1;var n=t[0];if(n>e[0]+e[2])return!1;var s=t[1]+t[3];if(s<e[1])return!1;var s=t[1];return s>e[1]+e[3]?!1:!0}}),n.CanvasRenderer=i.extend({ctor:function(t){t&&(this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.height=this.canvas.width,this.width=this.canvas.height)},hitAABB:function(t,e,i,n){for(var s=e.children.slice(0),r=s.length,a=r-1;a>=0;a--){var o=s[a];if(this.isbindingEvent(o)){var h=this._hitAABB(t,o,i,n);if(h)return h}}},_hitAABB:function(t,e,i,s){if(e.isVisible())if(e instanceof n.Container)for(var r=e.children.slice(0),a=r.length,o=a-1;o>=0;o--){var h=r[o],c=this._hitAABB(t,h,i,s);if(c)return c}else if(e.AABB&&this.checkPointInAABB(i.stageX,i.stageY,e.AABB))return this._bubbleEvent(e,s,i),e},hitRender:function(t,e,i,n){for(var s=e._hitMatrix,r=e.children.slice(0),a=r.length,o=a-1;o>=0;o--){var h=r[o];if(s.initialize(1,0,0,1,0,0),s.appendTransform(e.x-i.stageX,e.y-i.stageY,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY),this.isbindingEvent(h)){t.save();var c=this._hitRender(t,h,s,i,n);if(t.restore(),c)return c}}},_hitRender:function(t,e,i,s,r){if(t.clearRect(0,0,2,2),e.isVisible()){i?e._hitMatrix.initialize(i.a,i.b,i.c,i.d,i.tx,i.ty):e._hitMatrix.initialize(1,0,0,1,0,0),i=e._hitMatrix,e instanceof n.Shape?i.appendTransform(e.x,e.y,1,1,e.rotation,e.skewX,e.skewY,e.regX,e.regY):i.appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY);var a=e.cacheCanvas||e.txtCanvas||e.shapeCanvas;if(a)t.globalAlpha=e.complexAlpha,t.globalCompositeOperation=e.complexCompositeOperation,t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),t.drawImage(a,0,0);else if(e instanceof n.Container)for(var o=e.children.slice(0),h=o.length,c=h-1;c>=0;c--){t.save();var u=this._hitRender(t,o[c],i,s,r);if(u)return u;t.restore()}else if(e instanceof n.Bitmap||e instanceof n.Sprite){t.globalAlpha=e.complexAlpha,t.globalCompositeOperation=e.complexCompositeOperation;var l=e.rect;t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),t.drawImage(e.img,l[0],l[1],l[2],l[3],0,0,l[2],l[3])}else e instanceof n.Graphics&&(t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),e.draw(t));return t.getImageData(0,0,1,1).data[3]>1&&!(e instanceof n.Container)?(this._bubbleEvent(e,r,s),e):void 0}},_bubbleEvent:function(t,e,i){var n=t.execEvent(e,i);n!==!1&&t.parent&&t.parent.events[e]&&t.parent.events[e].length>0&&"Stage"!==t.parent.baseInstanceof&&this._bubbleEvent(t.parent,e,i)},isbindingEvent:function(t){if(0!==Object.keys(t.events).length)return!0;if(t instanceof n.Container)for(var e=0,i=t.children.length;i>e;e++){var s=t.children[e];if(s instanceof n.Container)return this.isbindingEvent(s);if(0!==Object.keys(s.events).length)return!0}return!1},clear:function(){this.ctx.clearRect(0,0,this.height,this.width)},renderObj:function(t,e){var i=e._matrix;t.save(),t.globalAlpha=e.complexAlpha,t.globalCompositeOperation=e.complexCompositeOperation;var s=e.cacheCanvas||e.txtCanvas||e.shapeCanvas;if(s)t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),t.drawImage(s,0,0);else if(e instanceof n.Bitmap||e instanceof n.Sprite){var r=e.rect;t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),t.drawImage(e.img,r[0],r[1],r[2],r[3],0,0,r[2],r[3])}else(e instanceof n.Graphics||e instanceof n.Text)&&(t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),e.draw(t));t.restore()},clearBackUpCanvasCache:function(){},checkPointInAABB:function(t,e,i){var n=i[0];if(n>t)return!1;var s=i[1];if(s>e)return!1;var r=n+i[2];if(t>r)return!1;var a=s+i[3];return e>a?!1:!0}}),n.WebGLRenderer=i.extend({ctor:function(t){this.surface=t,this.snapToPixel=!0,this.canvasRenderer=new n.CanvasRenderer,this.textureCache={},this.textureCanvasCache={},this.initSurface(this.surface)},initSurface:function(t){var e={depth:!1,alpha:!0,preserveDrawingBuffer:!0,antialias:!1,premultipliedAlpha:!0},i=void 0;try{i=t.ctx=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),i.viewportWidth=t.width,i.viewportHeight=t.height}catch(n){}i||alert("Could not initialise WebGL. Make sure you've updated your browser, or try a different one like Google Chrome.");var s=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(s,"precision mediump float;\nvarying vec3 vTextureCoord;\nvarying float vAlpha;\nuniform float uAlpha;\nuniform sampler2D uSampler0;\nvoid main(void) { \nvec4 color = texture2D(uSampler0, vTextureCoord.st);  \ngl_FragColor = vec4(color.rgb, color.a * vAlpha);\n}"),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)||alert(i.getShaderInfoLog(s));var r=i.createShader(i.VERTEX_SHADER);i.shaderSource(r,"attribute vec2 aVertexPosition;\nattribute vec3 aTextureCoord;\nattribute float aAlpha;\nuniform bool uSnapToPixel;\nconst mat4 pMatrix = mat4("+2/i.viewportWidth+",0,0,0, 0,"+-2/i.viewportHeight+",0,0, 0,0,-2,   0, -1,1,-1,1); \nvarying vec3 vTextureCoord;\nvarying float vAlpha;\nvoid main(void) { \nvTextureCoord = aTextureCoord; \nvAlpha = aAlpha; \ngl_Position = pMatrix * vec4(aVertexPosition.x,aVertexPosition.y,0.0, 1.0);\n}"),i.compileShader(r),i.getShaderParameter(r,i.COMPILE_STATUS)||alert(i.getShaderInfoLog(r));var a=t.shader=i.createProgram();i.attachShader(a,r),i.attachShader(a,s),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)||alert("Could not initialise shaders"),i.enableVertexAttribArray(a.vertexPositionAttribute=i.getAttribLocation(a,"aVertexPosition")),i.enableVertexAttribArray(a.uvCoordAttribute=i.getAttribLocation(a,"aTextureCoord")),i.enableVertexAttribArray(a.colorAttribute=i.getAttribLocation(a,"aAlpha")),a.alphaUniform=i.getUniformLocation(a,"uAlpha"),a.snapToUniform=i.getUniformLocation(a,"uSnapToPixel"),i.useProgram(a),this._vertexDataCount=5,this._degToRad=Math.PI/180,this.vertices=window.Float32Array?new window.Float32Array(4*this._vertexDataCount):new Array(4*this._vertexDataCount),this.arrayBuffer=i.createBuffer(),this.indexBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.arrayBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var o=4*this._vertexDataCount;i.vertexAttribPointer(a.vertexPositionAttribute,2,i.FLOAT,0,o,0),i.vertexAttribPointer(a.uvCoordAttribute,2,i.FLOAT,0,o,8),i.vertexAttribPointer(a.colorAttribute,1,i.FLOAT,0,o,16),this.indices=window.Uint16Array?new window.Uint16Array(6):new Array(6);for(var h=0,c=this.indices.length;c>h;h+=6){var u=4*h/6;this.indices.set([u,u+1,u+2,u,u+2,u+3],h)}i.bufferData(i.ARRAY_BUFFER,this.vertices,i.STREAM_DRAW),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW),i.viewport(0,0,i.viewportWidth,i.viewportHeight),i.colorMask(!0,!0,!0,!0),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.SRC_ALPHA,i.ONE),i.enable(i.BLEND),i.disable(i.DEPTH_TEST),t.init=!0,this.ctx=i},_initTexture:function(t,e){this.textureCache[t.src]?(t.glTexture=this.textureCache[t.src],e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.glTexture)):(t.glTexture=e.createTexture(),t.glTexture.image=t,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.glTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.glTexture.image),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.textureCache[t.src]=t.glTexture,e.uniform1i(e.getUniformLocation(e.canvas.shader,"uSampler0"),0))},_initCache:function(t,e,i){this.textureCanvasCache[t.cacheID]?(e.glTexture=this.textureCanvasCache[t.cacheID],i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e.glTexture)):(this.textureCanvasCache[this._preCacheId]=null,e.glTexture=i.createTexture(),e.glTexture.image=e,i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,e.glTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e.glTexture.image),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.uniform1i(i.getUniformLocation(i.canvas.shader,"uSampler0"),0),this.textureCanvasCache[t.cacheID]=e.glTexture)},updateCache:function(t,e,i,n){t.clearRect(0,0,i+1,n+1),this.renderCache(t,e)},renderCache:function(t,e){if(e.isVisible())if(e instanceof n.Container||e instanceof n.Stage)for(var i=e.children.slice(0),s=0,r=i.length;r>s;s++)t.save(),this.canvasRenderer.render(t,i[s]),t.restore();else if(e instanceof n.Bitmap||e instanceof n.Sprite){var a=e.rect;t.drawImage(e.img,a[0],a[1],a[2],a[3],0,0,a[2],a[3])}else e.txtCanvas?t.drawImage(e.txtCanvas,0,0):e.shapeCanvas&&t.drawImage(e.shapeCanvas,0,0)},clear:function(){this.ctx.clear(this.ctx.COLOR_BUFFER_BIT)},renderObj:function(t,e){var i=e._matrix,s=0,r=0,a=0,o=0,h=0,c=0,u=1,l=1,f=0;"lighter"===e.complexCompositeOperation?t.blendFunc(t.SRC_ALPHA,t.ONE):t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA);var d=e.cacheCanvas||e.txtCanvas||e.shapeCanvas;if(d)this._initCache(e,d,t),a=s+d.width,o=r+d.height;else if(e instanceof n.Bitmap||e instanceof n.Sprite){var p=e.rect;f=e.img,this._initTexture(f,t),a=s+p[2],o=r+p[3],u=p[2]/f.width,l=p[3]/f.height,h=p[0]/f.width,c=p[1]/f.height}var m=i.a,g=i.b,v=i.c,w=i.d,b=i.tx,x=i.ty,y=s*m,E=s*g,_=r*v,C=r*w,T=a*m,A=a*g,k=o*v,I=o*w,R=e.complexAlpha;this.vertices.set([y+_+b,E+C+x,h,c,R,y+k+b,E+I+x,h,c+l,R,T+k+b,A+I+x,h+u,c+l,R,T+_+b,A+C+x,h+u,c,R],0),t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)},clearBackUpCanvasCache:function(){this.textureCanvasCache[1]=null}}),n.DisplayObject=i.extend({ctor:function(){this.alpha=this.scaleX=this.scaleY=this.scale=1,this.x=this.y=this.rotation=this.originX=this.originY=this.skewX=this.skewY=this.width=this.height=this.regX=this.regY=0,this.textureReady=!0,this.visible=!0,this._matrix=new n.Matrix2D,this._hitMatrix=new n.Matrix2D,this.events={},this.id=n.UID.get(),this.cacheID=0,this.baseInstanceof="DisplayObject",this.tickFPS=60;var t=this;this._watch(this,"originX",function(e,i){t.regX="string"==typeof i?parseInt(i):t.width*i}),this._watch(this,"originY",function(e,i){t.regY="string"==typeof i?parseInt(i):t.height*i}),this._watch(this,"filter",function(e,i){t.setFilter.apply(t,i)}),this._watch(this,"scale",function(t,e){this.scaleX=this.scaleY=this.scale}),this._preAABB=[-1,-1,0,0],this.cursor="default",this.onHover(function(){},function(){this._setCursor(this,"default")})},_watch:function(t,e,i){if("string"==typeof e){{t["__"+e]=this[e]}Object.defineProperty(t,e,{get:function(){return this["__"+e]},set:function(n){this["__"+e]=n,i.apply(t,[e,n])}})}else for(var n=0,s=e.length;s>n;n++){{var r=e[n];t["__"+r]=this[r]}!function(e){Object.defineProperty(t,e,{get:function(){return this["__"+e]},set:function(n){this["__"+e]=n,i.apply(t,[e,n])}})}(r)}},isVisible:function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&this.textureReady)},on:function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},execEvent:function(t,e){if(this.events){var i=this.events[t],n=!0;if(i)for(var s=0,r=i.length;r>s;s++)n=i[s].call(this,e);return n}},_setCursor:function(t,e){t&&(t.parent instanceof n.Stage?t.parent.setCursor(e):this._setCursor(t.parent,e))},clone:function(){var t=new n.DisplayObject;return this.cloneProps(t),t},cloneProps:function(t){t.visible=this.visible,t.alpha=this.alpha,t.originX=this.originX,t.originY=this.originY,t.rotation=this.rotation,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.skewX=this.skewX,t.skewY=this.skewY,t.x=this.x,t.y=this.y,t.regX=this.regX,t.regY=this.regY},cache:function(){if(!this.cacheCanvas){this.cacheCanvas=document.createElement("canvas");var t=this.getBound();this.cacheCanvas.width=t.width,this.cacheCanvas.height=t.height,this.cacheCtx=this.cacheCanvas.getContext("2d")}this.cacheID=n.UID.getCacheID(),this.updateCache(this.cacheCtx,this,t.width,t.width)},uncache:function(){this.cacheCanvas=null,this.cacheCtx=null,this.cacheID=null},setFilter:function(t,e,i,n){if(0!==this.width&&0!==this.height){this.uncache(),this.cache();for(var s=this.cacheCtx.getImageData(0,0,this.cacheCanvas.width,this.cacheCanvas.height),r=s.data,a=0,o=r.length;o>a;a+=4)r[a+3]>0&&(r[a]*=t,r[a+1]*=e,r[a+2]*=i,r[a+3]*=n);this.cacheCtx.putImageData(s,0,0)}},getBound:function(){return{width:this.width,height:this.height}},toCenter:function(){this.originX=.5,this.originY=.5,this.x=this.parent.width/2,this.y=this.parent.height/2},destroy:function(){this.cacheCanvas=null,this.cacheCtx=null,this.cacheID=null,this._matrix=null,this.events=null,this.parent&&this.parent.remove(this)},initAABB:function(){var t=0,e=0,i=this.width,n=this.height,s=this._matrix,r=i*s.a,a=i*s.b,o=n*s.c,h=n*s.d,c=s.tx,u=s.ty,l=c,f=c,d=u,p=u;(t=r+c)<l?l=t:t>f&&(f=t),(t=r+o+c)<l?l=t:t>f&&(f=t),(t=o+c)<l?l=t:t>f&&(f=t),(e=a+u)<d?d=e:e>p&&(p=e),(e=a+h+u)<d?d=e:e>p&&(p=e),(e=h+u)<d?d=e:e>p&&(p=e),this.AABB=[l,d,f-l,p-d],this.rectPoints=[{x:c,y:u},{x:r+c,y:a+u},{x:r+o+c,y:a+h+u},{x:o+c,y:h+u}]},updateCache:function(t,e,i,n){t.clearRect(0,0,i+1,n+1),this.renderCache(t,e)},renderCache:function(t,e){if(e.isVisible())if(e instanceof n.Container||e instanceof n.Stage)for(var i=e.children.slice(0),s=0,r=i.length;r>s;s++)t.save(),this.render(t,i[s]),t.restore();else if(e instanceof n.Bitmap||e instanceof n.Sprite){var a=e.rect;t.drawImage(e.img,a[0],a[1],a[2],a[3],0,0,a[2],a[3])}else e.txtCanvas?t.drawImage(e.txtCanvas,0,0):e.shapeCanvas&&t.drawImage(e.shapeCanvas,0,0)},onClick:function(t){this.on("click",t)},onMouseDown:function(t){this.on("pressdown",t)},onMouseMove:function(t){this.on("mousemove",t)},onMouseUp:function(t){this.on("pressup",t)},onMouseOver:function(t){this.on("mouseover",t)},onMouseOut:function(t){this.on("mouseout",t)},onHover:function(t,e){this.on("mouseover",t),this.on("mouseout",e)},onPressDown:function(t){this.on("pressdown",t)},onPressMove:function(t){this.on("pressmove",t)},onPressUp:function(t){this.on("pressup",t)},onMouseWheel:function(t){this.on("mousewheel",t)},onTouchStart:function(t){this.on("pressdown",t)},onTouchMove:function(t){this.on("pressmove",t)},onTouchEnd:function(t){this.on("pressup",t)},onDbClick:function(t){this.on("dblclick",t)}}),n.Bitmap=n.DisplayObject.extend({ctor:function(t){this._super(),0!==arguments.length&&("string"==typeof t?this._initWithSrc(t):this._init(t))},_initWithSrc:function(t){var e=n.Bitmap[t];if(e)this._init(e);else{var i=this;this.textureReady=!1,this.img=document.createElement("img"),this.img.onload=function(){i.rect||(i.rect=[0,0,i.img.width,i.img.height]),i.width=i.rect[2],i.height=i.rect[3],i.regX=i.width*i.originX,i.regY=i.height*i.originY,n.Bitmap[t]=i.img,i.textureReady=!0,i.imageLoadHandle&&i.imageLoadHandle(),i.filter&&(i.filter=i.filter)},this.img.src=t}},_init:function(t){t&&(this.img=t,this.width=t.width,this.height=t.height,Object.defineProperty(this,"rect",{get:function(){return this.__rect},set:function(t){this.__rect=t,this.width=t[2],this.height=t[3],this.regX=t[2]*this.originX,this.regY=t[3]*this.originY}}),this.rect=[0,0,t.width,t.height])},useImage:function(t){"string"==typeof t?this._initWithSrc(t):(this._init(t),this.imageLoadHandle&&this.imageLoadHandle())},onImageLoad:function(t){this.imageLoadHandle=t},clone:function(){var t=new n.Bitmap(this.img);return t.rect=this.rect.slice(0),this.cloneProps(t),t},flipX:function(){},flipY:function(){}}),n.CircleShape=n.DisplayObject.extend({ctor:function(t,e,i){this._super(),this.r=t||1,this.color=e||"black",this.isHollow=i,this.width=this.height=2*t,this.shapeCanvas=document.createElement("canvas"),this.shapeCanvas.width=this.width,this.shapeCanvas.height=this.height,this.shapeCtx=this.shapeCanvas.getContext("2d"),this.draw(),this.cacheID=n.UID.getCacheID()},draw:function(t){var t=this.shapeCtx;t.beginPath(),t.arc(this.r,this.r,this.r,0,2*Math.PI),this.originX=this.originY=.5,this.isHollow?(t.strokeStyle=this.color,t.stroke()):(t.fillStyle=this.color,t.fill())}}),n.Container=n.DisplayObject.extend({ctor:function(){this._super(),this.children=[],this.baseInstanceof="Container"},add:function(t){var e=arguments.length;if(e>1)for(var i=0;e>i;i++){var n=arguments[i];n&&(this.children.push(n),n.parent=this)}else t&&(this.children.push(t),t.parent=this)},remove:function(t){var e=arguments.length,i=this.children.length;if(e>1){for(var n=0;e>n;n++)for(var s=arguments[n],r=i;--r>=0;)if(s&&this.children[r].id==s.id){s.parent=null,this.children.splice(r,1);break}}else for(var a=i;--a>=0;)if(t&&this.children[a].id==t.id){t.parent=null,this.children.splice(a,1);break}},clone:function(){var t=new n.Container;this.cloneProps(t);for(var e=t.children=[],i=this.children.length-1;i>-1;i--){var s=this.children[i].clone();e.unshift(s)}return t},removeAll:function(){for(var t=this.children;t.length;)t.pop().parent=null},destroy:function(){this._super();for(var t=this.children;t.length;){var e=t.pop();e.destroy()}},swapChildrenAt:function(t,e){var i=this.children,n=i[t],s=i[e];n&&s&&(i[t]=s,i[e]=n)},swapChildren:function(t,e){for(var i,n,s=this.children,r=0,a=s.length;a>r&&(s[r]==t&&(i=r),s[r]==e&&(n=r),null==i||null==n);r++);r!=a&&(s[i]=e,s[n]=t)},swapToTop:function(t){this.swapChildren(t,this.children[this.children.length-1])}}),n.Graphics=n.DisplayObject.extend({ctor:function(){this._super(),this.cmds=[],this.assMethod=["fillStyle","strokeStyle","lineWidth"]},draw:function(t){for(var e=0,i=this.cmds.length;i>e;e++){var n=this.cmds[e];this.assMethod.join("-").match(new RegExp("\\b"+n[0]+"\\b","g"))?t[n[0]]=n[1][0]:t[n[0]].apply(t,Array.prototype.slice.call(n[1]))}},clearRect:function(t,e,i,n){return this.cmds.push(["clearRect",arguments]),this},clear:function(){return this.cmds.length=0,this},strokeRect:function(){return this.cmds.push(["strokeRect",arguments]),this},fillRect:function(){return this.cmds.push(["fillRect",arguments]),this},beginPath:function(){return this.cmds.push(["beginPath",arguments]),this},arc:function(){return this.cmds.push(["arc",arguments]),this},closePath:function(){return this.cmds.push(["closePath",arguments]),this},fillStyle:function(){return this.cmds.push(["fillStyle",arguments]),this},fill:function(){return this.cmds.push(["fill",arguments]),this},strokeStyle:function(){return this.cmds.push(["strokeStyle",arguments]),this},lineWidth:function(){return this.cmds.push(["lineWidth",arguments]),this},stroke:function(){return this.cmds.push(["stroke",arguments]),this},moveTo:function(){return this.cmds.push(["moveTo",arguments]),this},lineTo:function(){return this.cmds.push(["lineTo",arguments]),this},bezierCurveTo:function(){return this.cmds.push(["bezierCurveTo",arguments]),this},clone:function(){}}),n.Label=n.DisplayObject.extend({ctor:function(t){this._super(),this.value=t.value,this.fontSize=t.fontSize,this.fontFamily=t.fontFamily,this.color=t.color,this.textAlign="center",this.textBaseline="top",this.fontWeight=t.fontWeight||"",this.maxWidth=t.maxWidth||2e3,this.square=t.square||!1,this.txtCanvas=document.createElement("canvas"),this.txtCtx=this.txtCanvas.getContext("2d"),this.setDrawOption(),this._watch(this,["value","fontSize","color","fontFamily"],function(t,e){this.setDrawOption()})},setDrawOption:function(){var t=this.getDrawOption({txt:this.value,maxWidth:this.maxWidth,square:this.square,size:this.fontSize,alignment:this.textAlign,color:this.color||"black",fontFamily:this.fontFamily,fontWeight:this.fontWeight});this.cacheID=n.UID.getCacheID(),this.width=t.calculatedWidth,this.height=t.calculatedHeight},getDrawOption:function(t){{var e,i,n,s,r=this.txtCanvas,a=this.txtCtx,o=[],h=t.txt,c=t.maxWidth,u=t.square,l=t.size,f=t.alignment,d=t.color,p=t.fontFamily,m=t.fontWeight;t.backgroundColour}switch(a.font=l+"px "+p,c&&this.measureText(a,h)>c?(c=this.createMultilineText(a,h,c,o),e=this.getPowerOfTwo(c)):(o.push(h),e=this.getPowerOfTwo(a.measureText(h).width)),i=this.getPowerOfTwo(l*(o.length+1)),u&&(e>i?i=e:e=i),t.calculatedWidth=e,t.calculatedHeight=i,r.width=e,r.height=i,f){case"left":n=0;break;case"center":n=e/2;break;case"right":n=e}s=i/2,a.fillStyle=d,a.textAlign=f,a.textBaseline="middle",a.font=m+" "+l+"px "+p;var g=.5*(i-l*(o.length+1));t.cmd=[];for(var v=0;v<o.length;v++)o.length>1&&(s=(v+1)*l+g),t.cmd.push({text:o[v],x:n,y:s}),a.fillText(o[v],n,s);return t},getPowerOfTwo:function(t,e){for(var e=e||1;t>e;)e*=2;return e},measureText:function(t,e){return t.measureText(e).width},createMultilineText:function(t,e,i,n){e=e.replace("\n"," ");var s,r,a,o=e,h=0,c=0,u=e.split(" ");for(r=a=u.length;this.measureText(t,o)>i&&r>1;){r--;o=s="";for(var l=0;a>l;l++)r>l?(o+=u[l],r>l+1&&(o+=" ")):(s+=u[l],a>l+1&&(s+=" "))}return n.push(o),c=this.measureText(t,o),s&&(h=this.createMultilineText(t,s,i,n),h>c&&(c=h)),c},draw:function(t){t.fillStyle=this.color,t.font=this.font,t.textAlign=this.textAlign||"left",t.textBaseline=this.textBaseline||"top",t.fillText(this.text,0,0)}}),n.Particle=n.Bitmap.extend({ctor:function(t){this._super(t.texture),this.originX=.5,this.originY=.5,this.position=t.position,this.x=this.position.x,this.y=this.position.y,this.rotation=t.rotation||0,this.velocity=t.velocity,this.acceleration=t.acceleration||new n.Vector2(0,0),this.rotatingSpeed=t.rotatingSpeed||0,this.rotatingAcceleration=t.rotatingAcceleration||0,this.hideSpeed=t.hideSpeed||.01,this.zoomSpeed=t.hideSpeed||.01,this.isAlive=!0,this.img=t.texture,this.img.src=""},tick:function(){this.velocity.add(this.acceleration),this.position.add(this.velocity.multiply(.1)),this.rotatingSpeed+=this.rotatingAcceleration,this.rotation+=this.rotatingSpeed,this.alpha-=this.hideSpeed,this.x=this.position.x,this.y=this.position.y,this.alpha=this.alpha}}),n.ParticleSystem=n.Container.extend({ctor:function(t){this._super(),this.speed=t.speed,this.angle=t.angle,this.angleRange=t.angleRange,this.emitArea=t.emitArea,this.gravity=t.gravity||{x:0,y:0},this.filter=t.filter,this.compositeOperation="lighter",this.emitCount=t.emitCount,this.maxCount=t.maxCount||1e3,this.emitX=t.emitX,this.emitY=t.emitY;"string"==typeof t.texture?n.Bitmap[t.texture]?(this.texture=n.Bitmap[t.texture],this.generateFilterTexture(this.texture)):(this.bitmap=new n.Bitmap,this.bitmap._parent=this,this.bitmap.onImageLoad(function(){this._parent.texture=this.img,this._parent.generateFilterTexture(this.img),delete this._parent}),this.bitmap.useImage(t.texture)):(this.texture=t.texture,this.generateFilterTexture(t.texture)),this.totalCount=t.totalCount,this.emittedCount=0,this.tickFPS=60,this.hideSpeed=t.hideSpeed||.01},generateFilterTexture:function(t){var e=new n.Bitmap(t);e.filter=this.filter,this.filterTexture=e.cacheCanvas},emit:function(){var t=(this.angle+n.Util.random(-this.angleRange/2,this.angleRange/2))*Math.PI/180,e=this.emitArea[0]/2,i=this.emitArea[1]/2,s=new n.Particle({position:new n.Vector2(this.emitX+n.Util.random(-e,e),this.emitY+n.Util.random(-i,i)),velocity:new n.Vector2(this.speed*Math.cos(t),this.speed*Math.sin(t)),texture:this.filterTexture,acceleration:this.gravity,hideSpeed:this.hideSpeed});this.add(s),this.emittedCount++},tick:function(){if(this.filterTexture){var t=this.children.length;if(this.totalCount&&this.emittedCount>this.totalCount)0===t&&this.destroy();else if(t<this.maxCount)for(var e=0;e<this.emitCount;e++)this.emit();for(var i=0;t>i;i++){var n=this.children[i];n.isVisible()?n.tick():(this.remove(n),i--,t--)}}}}),n.ParticleExplosion=n.Container.extend({ctor:function(t,e){this._super(),this.ps=t,this.add(t),this.callback=e,this.tickFPS=0,setTimeout(function(){this.ps.maxCount=0,this.tickFPS=60}.bind(this),1e3)},tick:function(){0===this.ps.children.length&&(this.tickFPS=0,this.parent.remove(this),this.callback())}}),n.RectAdjust=i.extend({ctor:function(t){this.min=t.min,this.max=t.max,this.value=t.value,this.change=t.change,this.renderTo=t.renderTo,this.fillStyle=t.fillStyle,this.canvas=document.createElement("canvas"),this.canvas.width=140,this.canvas.height=16,this.canvas.style.cssText="border:1px solid black;",this.ctx=this.canvas.getContext("2d"),this.renderTo.appendChild(this.canvas),this.render(160*(this.value-this.min)/(this.max-this.min)),this.offset=this.canvas.getBoundingClientRect();var e=this,i=!1;this.canvas.addEventListener("mousedown",function(t){i=!0;{var n=t.pageX-e.offset.left;t.pageY-e.offset.top}e.value=e.min+(e.max-e.min)*n/140,e.value>e.max&&(e.value=e.max),e.value<e.min&&(e.value=e.min),e.change(e.value),e.render(n),t.preventDefault(),t.stopPropagation()},!1),this.canvas.addEventListener("mousemove",function(t){if(i){{var n=t.pageX-e.offset.left;t.pageY-e.offset.top}e.value=e.min+(e.max-e.min)*n/140,e.value>e.max&&(e.value=e.max),e.value<e.min&&(e.value=e.min),e.change(e.value),e.render(n),t.preventDefault(),t.stopPropagation()}},!1),document.addEventListener("mouseup",function(t){i=!1},!1)},render:function(t){this.ctx.fillStyle=this.fillStyle,this.ctx.clearRect(0,0,500,500),this.ctx.beginPath(),this.ctx.fillRect(0,0,t,60)}}),n.RectShape=n.DisplayObject.extend({ctor:function(t,e,i,s){this._super(),this.color=i||"black",this.isHollow=s,this.width=t,this.height=e,this.originX=this.originY=.5,this.shapeCanvas=document.createElement("canvas"),this.shapeCanvas.width=this.width,this.shapeCanvas.height=this.height,this.shapeCtx=this.shapeCanvas.getContext("2d"),this.draw(),this.cacheID=n.UID.getCacheID()},draw:function(t){var t=this.shapeCtx;t.beginPath(),t.arc(this.r,this.r,this.r,0,2*Math.PI),this.isHollow?(t.strokeStyle=this.color,t.strokeRect(0,0,this.width,this.height)):(t.fillStyle=this.color,t.fillRect(0,0,this.width,this.height))}}),n.Shape=n.DisplayObject.extend({ctor:function(t,e,i){this._super(),this.cmds=[],this.assMethod=["fillStyle","strokeStyle","lineWidth"],this.width=t,this.height=e,this._width=t,this._height=e,this.shapeCanvas=document.createElement("canvas"),this.shapeCanvas.width=this.width,this.shapeCanvas.height=this.height,this.shapeCtx=this.shapeCanvas.getContext("2d"),i&&(this.fillStyle("red"),this.fillRect(0,0,t,e)),this._watch(this,"scaleX",function(t,e){this.width=this._width*e,this.height=this._height*this.scaleY,this.originX=this.originX,this.shapeCanvas.width=this.width,this.shapeCanvas.height=this.height,this.shapeCtx.scale(e,this.scaleY),this.end()}),this._watch(this,"scaleY",function(t,e){this.width=this._width*this.scaleX,this.height=this._height*e,this.originY=this.originY,this.shapeCanvas.width=this.width,this.shapeCanvas.height=this.height,this.shapeCtx.scale(this.scaleX,e),this.end()})},end:function(){this._preCacheId=this.cacheID,this.cacheID=n.UID.getCacheID();for(var t=this.shapeCtx,e=0,i=this.cmds.length;i>e;e++){var s=this.cmds[e];this.assMethod.join("-").match(new RegExp("\\b"+s[0]+"\\b","g"))?t[s[0]]=s[1][0]:t[s[0]].apply(t,Array.prototype.slice.call(s[1]))}},clearRect:function(t,e,i,s){this.cacheID=n.UID.getCacheID(),this.shapeCtx.clearRect(t,e,i,s)},clear:function(){this.cacheID=n.UID.getCacheID(),this.shapeCtx.clearRect(0,0,this.width,this.height)},strokeRect:function(){return this.cmds.push(["strokeRect",arguments]),this},fillRect:function(){return this.cmds.push(["fillRect",arguments]),this},beginPath:function(){return this.cmds.push(["beginPath",arguments]),this},arc:function(){return this.cmds.push(["arc",arguments]),this},closePath:function(){return this.cmds.push(["closePath",arguments]),this},fillStyle:function(){return this.cmds.push(["fillStyle",arguments]),this},fill:function(){return this.cmds.push(["fill",arguments]),this},strokeStyle:function(){return this.cmds.push(["strokeStyle",arguments]),this},lineWidth:function(){return this.cmds.push(["lineWidth",arguments]),this},stroke:function(){return this.cmds.push(["stroke",arguments]),this},moveTo:function(){return this.cmds.push(["moveTo",arguments]),this},lineTo:function(){return this.cmds.push(["lineTo",arguments]),this},bezierCurveTo:function(){return this.cmds.push(["bezierCurveTo",arguments]),this},clone:function(){}}),n.Sprite=n.DisplayObject.extend({ctor:function(t){this._super(),this.option=t,this.x=t.x||0,this.y=t.y||0,this.currentFrameIndex=0,this.animationFrameIndex=0,this.currentAnimation=t.currentAnimation||null,this.rect=[0,0,10,10],this.visible=!1,this.bitmaps=[],this._loadedCount=0;for(var e=this.option.imgs.length,i=0;e>i;i++){var s=this.option.imgs[i];if("string"==typeof s)if(n.Bitmap[s])this.bitmaps.push(new n.Bitmap(n.Bitmap[s])),this._loadedCount++;else{var r=new n.Bitmap;r._sprite=this,r.onImageLoad(function(){r._sprite._loadedCount++,r._sprite._loadedCount===e&&(r._sprite.visible=!0,delete r._sprite)}),r.useImage(this.option.imgs[i]),this.bitmaps.push(r)}else this._loadedCount++,this.bitmaps.push(new n.Bitmap(s))}this._loadedCount===e&&(this.visible=!0),this.img=this.bitmaps[0].img,this.interval=1e3/t.framerate,
this.loop=null,this.paused=!1,this.animationEnd=t.animationEnd||null,this.currentAnimation&&this.gotoAndPlay(this.currentAnimation),this.tickAnimationEnd=t.tickAnimationEnd||null},play:function(){this.paused=!1},pause:function(){this.paused=!0},reset:function(){this.currentFrameIndex=0,this.animationFrameIndex=0},gotoAndPlay:function(t,e){this.paused=!1,this.reset(),clearInterval(this.loop),this.currentAnimation=t;var i=this,n=0;this.loop=setInterval(function(){if(!i.paused){var t=i.option,s=t.animations[i.currentAnimation].frames,r=s.length;i.animationFrameIndex++,i.animationFrameIndex>r-1&&(n++,i.animationFrameIndex=0,i.tickAnimationEnd&&i.tickAnimationEnd(),e&&n==e&&(i.animationEnd&&i.animationEnd(),i.paused=!0,clearInterval(i.loop),i.parent.remove(i))),i.rect=t.frames[s[i.animationFrameIndex]],i.width=i.rect[2],i.height=i.rect[3];var a=i.rect,o=a.length;o>4&&(i.regX=a[2]*a[4]),o>5&&(i.regY=a[3]*a[5]),o>6&&(i.img=i.bitmaps[a[6]].img)}},this.interval)},gotoAndStop:function(t){this.reset(),clearInterval(this.loop);var e=this;e.currentAnimation=t;{var i=e.option,n=i.animations[e.currentAnimation].frames;n.length}e.rect=i.frames[n[e.animationFrameIndex]],e.width=e.rect[2],e.height=e.rect[3];var s=e.rect,r=s.length;r>4&&(e.regX=s[2]*s[4]),r>5&&(e.regY=s[3]*s[5]),r>6&&(e.img=e.bitmaps[s[6]].img)}}),n.Stage=n.Container.extend({ctor:function(t,e){this._super(),this.canvas="string"==typeof t?document.querySelector(t):t,this.width=this.canvas.width,this.height=this.canvas.height,this.AABB=[0,0,this.width,this.height],this.hitAABB=!0,this.hitRenderer=new n.CanvasRenderer,this.hitCanvas=document.createElement("canvas"),this.hitCanvas.width=1,this.hitCanvas.height=1,this.stageRenderer=new n.Renderer(this,e),this.hitCtx=this.hitCanvas.getContext("2d"),this._scaleX=this._scaleY=null,this.offset=this._getXY(this.canvas),this.overObj=null,this._paused=!1,this.fps=63,this.interval=Math.floor(1e3/this.fps),this.toList=[],this.tickFns=[];var i=this;i.loop=setInterval(function(){i._paused||i._tick(i)},i.interval),Object.defineProperty(this,"useRequestAnimFrame",{set:function(t){this._useRequestAnimFrame=t,t?(clearInterval(i.loop),i.loop=n.RAF.requestInterval(function(){i._tick(i)},i.interval)):(n.RAF.clearRequestInterval(i.loop),i.loop=setInterval(function(){i._tick(i)},i.interval))},get:function(){return this._useRequestAnimFrame}}),this._watch(this,"fps",function(t,e){this.interval=Math.floor(1e3/e);var i=this;if(this.useRequestAnimFrame){clearInterval(this.loop);try{n.RAF.clearRequestInterval(this.loop)}catch(s){}this.loop=n.RAF.requestInterval(function(){i._tick(i)},this.interval)}else{n.RAF.clearRequestInterval(this.loop);try{clearInterval(this.loop)}catch(s){}this.loop=setInterval(function(){i._tick(i)},this.interval)}}),this._initDebug(),this._pressmoveObjs=null,this.baseInstanceof="Stage",this.overObj=null,this._moveInterval=16,this._preMoveTime=new Date,this._currentMoveTime=new Date,Object.defineProperty(this,"moveFPS",{set:function(t){this._moveFPS=t,this._moveInterval=1e3/t},get:function(){return this._moveFPS}}),this.canvas.addEventListener("mousemove",this._handleMouseMove.bind(this),!1),this.canvas.addEventListener("click",this._handleClick.bind(this),!1),this.canvas.addEventListener("mousedown",this._handleMouseDown.bind(this),!1),this.canvas.addEventListener("mouseup",this._handleMouseUp.bind(this),!1),this.canvas.addEventListener("dblclick",this._handleDblClick.bind(this),!1),this.addEvent(this.canvas,"mousewheel",this._handleMouseWheel.bind(this)),this.canvas.addEventListener("touchmove",this._handleMouseMove.bind(this),!1),this.canvas.addEventListener("touchstart",this._handleMouseDown.bind(this),!1),this.canvas.addEventListener("touchend",this._handleMouseUp.bind(this),!1),document.addEventListener("DOMContentLoaded",this.adjustLayout.bind(this),!1),window.addEventListener("load",this.adjustLayout.bind(this),!1),window.addEventListener("resize",this.adjustLayout.bind(this),!1),this.autoUpdate=!0},adjustLayout:function(){this.offset=this._getXY(this.canvas),this._scaleX&&this.scaleToScreen(this._scaleX,this._scaleY)},pause:function(){this._paused=!0,this._pauseSprite(this),this._pauseTween()},play:function(){this._paused=!1,this._playSprite(this),this._playTween()},_pauseSprite:function(t){for(var e=0,i=t.children.length;i>e;e++){var s=t.children[e];s instanceof n.Container?this._pauseSprite(s):s instanceof n.Sprite&&s.pause()}},_pauseTween:function(){for(var t=0,e=this.toList.length;e>t;t++)this.toList[t].pause()},_playSprite:function(t){for(var e=0,i=t.children.length;i>e;e++){var s=t.children[e];s instanceof n.Container?this._playSprite(s):s instanceof n.Sprite&&s.play()}},_playTween:function(){for(var t=0,e=this.toList.length;e>t;t++)this.toList[t].play()},toggle:function(){this._paused?this.play():this.pause()},openDebug:function(){},closeDebug:function(){},_initDebug:function(){this.debugDiv=document.createElement("div"),this.debugDiv.style.cssText="display:none;position:absolute;z-index:2000;left:0;top:0;background-color:yellow;font-size:16px;",document.body.appendChild(this.debugDiv),Object.defineProperty(this,"debug",{set:function(t){this._debug=t,this.debugDiv.style.display=this._debug?"block":"none"},get:function(){return this._debug}})},_handleMouseWheel:function(t){this._correctionEvent(t,t.type);var e=this.events.mousewheel;if(e)for(var i=0,n=e.length;n>i;i++){var s=e[i];s(t)}this.overObj&&this.hitRenderer._bubbleEvent(this.overObj,"mousewheel",t)},update:function(){this.stageRenderer.update()},_correctionEvent:function(t,e){if(this.adjustLayout(),t.touches){var i=t.touches[0];i&&(t.stageX=i.pageX-this.offset[0],t.stageY=i.pageY-this.offset[1])}else t.stageX=t.pageX-this.offset[0],t.stageY=t.pageY-this.offset[1];if(this._scaleX){var n=this.correctingXY(t.stageX,t.stageY);t.stageX=Math.round(n.x),t.stageY=Math.round(n.y)}var s=this.events[e];if(s)for(var r=0,a=s.length;a>r;r++){var o=s[r];o(t)}},_handleClick:function(t){this._correctionEvent(t,t.type),this._getObjectUnderPoint(t,t.type)},_handleMouseMove:function(t){if(this._currentMoveTime=new Date,this._currentMoveTime-this._preMoveTime>this._moveInterval/2){if(this._correctionEvent(t,t.type),this._pressmoveObjs){var e=this._pressmoveObjs.events.pressmove;e&&this._pressmoveObjs.execEvent("pressmove",t)}var i=this._getObjectUnderPoint(t,"mousemove");i?this.overObj?(i.id!=this.overObj.id?(this.hitRenderer._bubbleEvent(this.overObj,"mouseout",t),this.hitRenderer._bubbleEvent(i,"mouseover",t),this.overObj=i):this.hitRenderer._bubbleEvent(i,"mousemove",t),this._setCursorByOverObject(i)):(this.overObj=i,this.hitRenderer._bubbleEvent(i,"mouseover",t)):this.overObj&&(this.hitRenderer._bubbleEvent(this.overObj,"mouseout",t),this.overObj=null),this._preMoveTime=this._currentMoveTime}},_getPressmoveTarget:function(t){t.events.pressmove&&(this._pressmoveObjs=t),t.parent&&this._getPressmoveTarget(t.parent)},_handleMouseDown:function(t){this._correctionEvent(t,"pressdown");var e=this._getObjectUnderPoint(t,"pressdown");e&&this._getPressmoveTarget(e)},_handleMouseUp:function(t){this._pressmoveObjs=null,this._correctionEvent(t,"pressup"),this._getObjectUnderPoint(t,"pressup")},_handleDblClick:function(t){this._correctionEvent(t,t.type),this._getObjectUnderPoint(t,t.type)},_getObjectUnderPoint:function(t,e){return this.hitAABB?this.hitRenderer.hitAABB(this.hitCtx,this,t,e):this.hitRenderer.hitRender(this.hitCtx,this,t,e)},_getXY:function(t){var e=0,i=0;if(!document.documentElement.getBoundingClientRect||!t.getBoundingClientRect){for(;t.offsetParent;)e+=t.offsetTop,i+=t.offsetLeft,t=t.offsetParent;return[i,e]}var n=t.getBoundingClientRect();return i=n.left,e=n.top,[i+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),e+Math.max(document.documentElement.scrollTop,document.body.scrollTop)]},_tick:function(t){if(t&&t.tick&&t.tickFPS>0)if(this._initInterval(t),t.hasOwnProperty("_tickInterval")){t._tickIntervalCurrent=new Date,t._tickIntervalLast||(t._tickIntervalLast=new Date,t._tickIntervalPrev=new Date);var e=t._tickIntervalCurrent-t._tickIntervalLast+(t._tickIntervalCurrent-t._tickIntervalPrev);e>t._tickInterval&&(t.tick(),t._tickIntervalLast=t._tickIntervalCurrent),t._tickIntervalPrev=new Date}else t.tick();for(var i=t.children,n=i.length,s=0;n>s;s++){var r=i[s];if(r){if(r.tick&&r.tickFPS>0)if(this._initInterval(r),r.hasOwnProperty("_tickInterval")){r._tickIntervalCurrent=new Date,r._tickIntervalLast||(r._tickIntervalLast=new Date,r._tickIntervalPrev=new Date);var e=r._tickIntervalCurrent-r._tickIntervalLast+(r._tickIntervalCurrent-r._tickIntervalPrev);e>r._tickInterval&&(r.tick(),r._tickIntervalLast=r._tickIntervalCurrent),r._tickIntervalPrev=new Date}else r.tick();"Container"==r.baseInstanceof&&this._tick(r)}}},_initInterval:function(t){t.hasOwnProperty("tickFPS")&&(t._tickInterval=1e3/t.tickFPS)},tick:function(){for(var t=0,e=this.tickFns.length;e>t;t++){var i=this.tickFns[t];if(i.hasOwnProperty("_ARE_PrevDate")){i._ARE_CurrentDate=new Date;var n=i._ARE_CurrentDate-i._ARE_PrevDate+(i._ARE_CurrentDate-i._ARE_LastDate);n>i._ARE_Interval&&(i(),i._ARE_PrevDate=i._ARE_CurrentDate),i._ARE_LastDate=i._ARE_CurrentDate}else i()}this.autoUpdate&&this.update(),this.debug&&(this.getFPS(),this.debugDiv.innerHTML="fps : "+this.fpsValue+" <br/>average fps : "+this.averageFPS+" <br/>object count : "+this.getTotalCount()+" <br/>rendering mode : "+this.getRenderingMode()+" <br/>inner object count  : "+this.stageRenderer.objs.length)},onTick:function(t,e){this.tickFns.push(t),void 0!==e&&(t._ARE_PrevDate=new Date,t._ARE_CurrentDate=new Date,t._ARE_LastDate=new Date,t._ARE_Interval=e)},setFPS:function(t){this.interval=Math.floor(1e3/t)},onKeyboard:function(t,e,i){n.Keyboard.on(t,e,i)},getActiveKeys:function(){return n.Keyboard.getActiveKeys()},scaleToScreen:function(t,e){1===t&&1===e&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),document.body.style.margin=0,document.documentElement.style.margin=0,document.body.style.border=0,document.documentElement.style.border=0,document.body.style.padding=0,document.documentElement.style.padding=0,document.body.style.width="100%",document.documentElement.style.width="100%",document.body.style.height="100%",document.documentElement.style.height="100%",this._scaleX=t,this._scaleY=e;var i=this.canvas;i.style.position="absolute",i.style.width=100*t+"%",i.style.height=100*e+"%",i.style.left=100*(1-t)/2+"%",i.style.top=100*(1-e)/2+"%",i.style.border="0px solid #ccc",this.offset=this._getXY(this.canvas)},correctingXY:function(t,e){return{x:t*this.width/(window.innerWidth*this._scaleX),y:e*this.height/(window.innerHeight*this._scaleY)}},getTotalCount:function(){function t(i){if("Container"==i.baseInstanceof||"Stage"==i.baseInstanceof)for(var s=0,r=i.children.length;r>s;s++){var a=i.children[s];a instanceof n.Container?t(a):e++}else e++}var e=0;return t(this),e},getRenderingMode:function(){return this.stageRenderer.renderingEngine instanceof n.CanvasRenderer?"Canvas":"WebGL"},getFPS:function(){var t=n.FPS.get();this.fpsValue=t.value,this.averageFPS=t.averageFPS},addEvent:function(t,e,i,n){"mousewheel"===e&&void 0!==document.mozHidden&&(e="DOMMouseScroll"),t.addEventListener(e,function(t){var e=t.type;("DOMMouseScroll"==e||"mousewheel"==e)&&(t.delta=t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3),i.call(this,t)},n||!1)},setCursor:function(t){this.canvas.style.cursor=t},_setCursorByOverObject:function(t){"default"!==t.cursor?this.setCursor(t.cursor):t.parent&&this._setCursorByOverObject(t.parent)}}),n.Text=n.DisplayObject.extend({ctor:function(t,e,i){this._super(),this.value=t,this.font=e,this.color=i,this.textAlign="left",this.textBaseline="top"},draw:function(t){t.fillStyle=this.color,t.font=this.font,t.textAlign=this.textAlign||"left",t.textBaseline=this.textBaseline||"top",t.fillText(this.value,0,0)},clone:function(){var t=new n.Text(this.text,this.font,this.color);return this.cloneProps(t),t}}),n});